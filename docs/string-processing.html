<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to Data Science</title>
  <meta name="description" content="This book introduces concepts and skills that can help you tackle real-world data analysis challenges. It covers concepts from probability, statistical inference, linear regression and machine learning and helps you develop skills such as R programming, data wrangling with dplyr, data visualization with ggplot2, file organization with UNIX/Linux shell, version control with GitHub, and reproducible document preparation with R markdown.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces concepts and skills that can help you tackle real-world data analysis challenges. It covers concepts from probability, statistical inference, linear regression and machine learning and helps you develop skills such as R programming, data wrangling with dplyr, data visualization with ggplot2, file organization with UNIX/Linux shell, version control with GitHub, and reproducible document preparation with R markdown." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to Data Science" />
  
  <meta name="twitter:description" content="This book introduces concepts and skills that can help you tackle real-world data analysis challenges. It covers concepts from probability, statistical inference, linear regression and machine learning and helps you develop skills such as R programming, data wrangling with dplyr, data visualization with ggplot2, file organization with UNIX/Linux shell, version control with GitHub, and reproducible document preparation with R markdown." />
  

<meta name="author" content="Rafael A. Irizarry">


<meta name="date" content="2018-10-29">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="web-scraping.html">
<link rel="next" href="parsing-dates-and-times.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.3.1/str_view.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#case-studies"><i class="fa fa-check"></i><b>1.1</b> Case studies</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#who-will-find-this-book-useful"><i class="fa fa-check"></i><b>1.2</b> Who will find this book useful?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-does-this-book-cover"><i class="fa fa-check"></i><b>1.3</b> What does this book cover?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-is-not-covered-by-this-book"><i class="fa fa-check"></i><b>1.4</b> What is not covered by this book?</a></li>
</ul></li>
<li class="part"><span><b>I R Basics</b></span></li>
<li class="chapter" data-level="2" data-path="case-study-us-gun-murders.html"><a href="case-study-us-gun-murders.html"><i class="fa fa-check"></i><b>2</b> Case study: US Gun Murders</a></li>
<li class="chapter" data-level="3" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>3</b> Getting Started</a><ul>
<li class="chapter" data-level="3.1" data-path="getting-started.html"><a href="getting-started.html#why-r"><i class="fa fa-check"></i><b>3.1</b> Why R?</a></li>
<li class="chapter" data-level="3.2" data-path="getting-started.html"><a href="getting-started.html#installing-r"><i class="fa fa-check"></i><b>3.2</b> Installing R</a></li>
<li class="chapter" data-level="3.3" data-path="getting-started.html"><a href="getting-started.html#the-r-console"><i class="fa fa-check"></i><b>3.3</b> The R console</a></li>
<li class="chapter" data-level="3.4" data-path="getting-started.html"><a href="getting-started.html#scripts"><i class="fa fa-check"></i><b>3.4</b> Scripts</a></li>
<li class="chapter" data-level="3.5" data-path="getting-started.html"><a href="getting-started.html#installing-rstudio"><i class="fa fa-check"></i><b>3.5</b> Installing RStudio</a></li>
<li class="chapter" data-level="3.6" data-path="getting-started.html"><a href="getting-started.html#the-r-ecosystem"><i class="fa fa-check"></i><b>3.6</b> The R ecosystem</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="the-very-basics.html"><a href="the-very-basics.html"><i class="fa fa-check"></i><b>4</b> The very basics</a><ul>
<li class="chapter" data-level="4.1" data-path="the-very-basics.html"><a href="the-very-basics.html#objects"><i class="fa fa-check"></i><b>4.1</b> Objects</a></li>
<li class="chapter" data-level="4.2" data-path="the-very-basics.html"><a href="the-very-basics.html#the-workspace"><i class="fa fa-check"></i><b>4.2</b> The workspace</a></li>
<li class="chapter" data-level="4.3" data-path="the-very-basics.html"><a href="the-very-basics.html#functions"><i class="fa fa-check"></i><b>4.3</b> Functions</a></li>
<li class="chapter" data-level="4.4" data-path="the-very-basics.html"><a href="the-very-basics.html#other-prebuilt-objects"><i class="fa fa-check"></i><b>4.4</b> Other prebuilt objects</a></li>
<li class="chapter" data-level="4.5" data-path="the-very-basics.html"><a href="the-very-basics.html#variable-names"><i class="fa fa-check"></i><b>4.5</b> Variable names</a></li>
<li class="chapter" data-level="4.6" data-path="the-very-basics.html"><a href="the-very-basics.html#saving-your-workspace"><i class="fa fa-check"></i><b>4.6</b> Saving your workspace</a></li>
<li class="chapter" data-level="4.7" data-path="the-very-basics.html"><a href="the-very-basics.html#scripts-1"><i class="fa fa-check"></i><b>4.7</b> Scripts</a></li>
<li class="chapter" data-level="4.8" data-path="the-very-basics.html"><a href="the-very-basics.html#comments"><i class="fa fa-check"></i><b>4.8</b> Comments</a></li>
<li class="chapter" data-level="" data-path="the-very-basics.html"><a href="the-very-basics.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>5</b> Data types</a><ul>
<li class="chapter" data-level="5.1" data-path="data-types.html"><a href="data-types.html#data-frames"><i class="fa fa-check"></i><b>5.1</b> Data frames</a></li>
<li class="chapter" data-level="5.2" data-path="data-types.html"><a href="data-types.html#examining-an-object"><i class="fa fa-check"></i><b>5.2</b> Examining an object</a></li>
<li class="chapter" data-level="5.3" data-path="data-types.html"><a href="data-types.html#the-accessor"><i class="fa fa-check"></i><b>5.3</b> The accessor: <code>$</code></a></li>
<li class="chapter" data-level="5.4" data-path="data-types.html"><a href="data-types.html#vectors-numerics-characters-and-logical"><i class="fa fa-check"></i><b>5.4</b> Vectors: numerics, characters, and logical</a></li>
<li class="chapter" data-level="5.5" data-path="data-types.html"><a href="data-types.html#factors"><i class="fa fa-check"></i><b>5.5</b> Factors</a></li>
<li class="chapter" data-level="5.6" data-path="data-types.html"><a href="data-types.html#lists"><i class="fa fa-check"></i><b>5.6</b> Lists</a></li>
<li class="chapter" data-level="5.7" data-path="data-types.html"><a href="data-types.html#matrices"><i class="fa fa-check"></i><b>5.7</b> Matrices</a></li>
<li class="chapter" data-level="" data-path="data-types.html"><a href="data-types.html#exercises-1"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="vectors.html"><a href="vectors.html"><i class="fa fa-check"></i><b>6</b> Vectors</a><ul>
<li class="chapter" data-level="6.1" data-path="vectors.html"><a href="vectors.html#creating-vectors"><i class="fa fa-check"></i><b>6.1</b> Creating vectors</a></li>
<li class="chapter" data-level="6.2" data-path="vectors.html"><a href="vectors.html#names"><i class="fa fa-check"></i><b>6.2</b> Names</a></li>
<li class="chapter" data-level="6.3" data-path="vectors.html"><a href="vectors.html#sequences"><i class="fa fa-check"></i><b>6.3</b> Sequences</a></li>
<li class="chapter" data-level="6.4" data-path="vectors.html"><a href="vectors.html#subsetting"><i class="fa fa-check"></i><b>6.4</b> Subsetting</a></li>
<li class="chapter" data-level="6.5" data-path="vectors.html"><a href="vectors.html#coercion"><i class="fa fa-check"></i><b>6.5</b> Coercion</a></li>
<li class="chapter" data-level="6.6" data-path="vectors.html"><a href="vectors.html#not-availables-na"><i class="fa fa-check"></i><b>6.6</b> Not availables (NA)</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercises-2"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sorting.html"><a href="sorting.html"><i class="fa fa-check"></i><b>7</b> Sorting</a><ul>
<li class="chapter" data-level="7.1" data-path="sorting.html"><a href="sorting.html#sort"><i class="fa fa-check"></i><b>7.1</b> <code>sort</code></a></li>
<li class="chapter" data-level="7.2" data-path="sorting.html"><a href="sorting.html#order"><i class="fa fa-check"></i><b>7.2</b> <code>order</code></a></li>
<li class="chapter" data-level="7.3" data-path="sorting.html"><a href="sorting.html#max-and-which.max"><i class="fa fa-check"></i><b>7.3</b> <code>max</code> and <code>which.max</code></a></li>
<li class="chapter" data-level="7.4" data-path="sorting.html"><a href="sorting.html#rank"><i class="fa fa-check"></i><b>7.4</b> <code>rank</code></a></li>
<li class="chapter" data-level="7.5" data-path="sorting.html"><a href="sorting.html#beware-of-recycling"><i class="fa fa-check"></i><b>7.5</b> Beware of recycling</a></li>
<li class="chapter" data-level="" data-path="sorting.html"><a href="sorting.html#exercise"><i class="fa fa-check"></i>Exercise</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="vector-arithmetics.html"><a href="vector-arithmetics.html"><i class="fa fa-check"></i><b>8</b> Vector arithmetics</a><ul>
<li class="chapter" data-level="8.1" data-path="vector-arithmetics.html"><a href="vector-arithmetics.html#rescaling"><i class="fa fa-check"></i><b>8.1</b> Rescaling</a></li>
<li class="chapter" data-level="8.2" data-path="vector-arithmetics.html"><a href="vector-arithmetics.html#two-vectors"><i class="fa fa-check"></i><b>8.2</b> Two vectors</a></li>
<li class="chapter" data-level="" data-path="vector-arithmetics.html"><a href="vector-arithmetics.html#exercises-3"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="indexing.html"><a href="indexing.html"><i class="fa fa-check"></i><b>9</b> Indexing</a><ul>
<li class="chapter" data-level="9.1" data-path="indexing.html"><a href="indexing.html#subsetting-with-logicals"><i class="fa fa-check"></i><b>9.1</b> Subsetting with logicals</a></li>
<li class="chapter" data-level="9.2" data-path="indexing.html"><a href="indexing.html#logical-operators"><i class="fa fa-check"></i><b>9.2</b> Logical operators</a></li>
<li class="chapter" data-level="9.3" data-path="indexing.html"><a href="indexing.html#which"><i class="fa fa-check"></i><b>9.3</b> <code>which</code></a></li>
<li class="chapter" data-level="9.4" data-path="indexing.html"><a href="indexing.html#match"><i class="fa fa-check"></i><b>9.4</b> <code>match</code></a></li>
<li class="chapter" data-level="9.5" data-path="indexing.html"><a href="indexing.html#in"><i class="fa fa-check"></i><b>9.5</b> <code>%in%</code></a></li>
<li class="chapter" data-level="" data-path="indexing.html"><a href="indexing.html#exercises-4"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="basic-data-wrangling.html"><a href="basic-data-wrangling.html"><i class="fa fa-check"></i><b>10</b> Basic data wrangling</a><ul>
<li class="chapter" data-level="10.1" data-path="basic-data-wrangling.html"><a href="basic-data-wrangling.html#adding-a-column-with-mutate"><i class="fa fa-check"></i><b>10.1</b> Adding a column with <code>mutate</code></a></li>
<li class="chapter" data-level="10.2" data-path="basic-data-wrangling.html"><a href="basic-data-wrangling.html#subsetting-with-filter"><i class="fa fa-check"></i><b>10.2</b> Subsetting with <code>filter</code></a></li>
<li class="chapter" data-level="10.3" data-path="basic-data-wrangling.html"><a href="basic-data-wrangling.html#selecting-columns-with-select"><i class="fa fa-check"></i><b>10.3</b> Selecting columns with <code>select</code></a></li>
<li class="chapter" data-level="10.4" data-path="basic-data-wrangling.html"><a href="basic-data-wrangling.html#the-pipe"><i class="fa fa-check"></i><b>10.4</b> The pipe: <code>%&gt;%</code></a></li>
<li class="chapter" data-level="10.5" data-path="basic-data-wrangling.html"><a href="basic-data-wrangling.html#creating-a-data-frame"><i class="fa fa-check"></i><b>10.5</b> Creating a data frame</a></li>
<li class="chapter" data-level="" data-path="basic-data-wrangling.html"><a href="basic-data-wrangling.html#exercises-5"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="basic-plots.html"><a href="basic-plots.html"><i class="fa fa-check"></i><b>11</b> Basic plots</a><ul>
<li class="chapter" data-level="11.1" data-path="basic-plots.html"><a href="basic-plots.html#scatterplots"><i class="fa fa-check"></i><b>11.1</b> Scatterplots</a></li>
<li class="chapter" data-level="11.2" data-path="basic-plots.html"><a href="basic-plots.html#histograms"><i class="fa fa-check"></i><b>11.2</b> Histograms</a></li>
<li class="chapter" data-level="11.3" data-path="basic-plots.html"><a href="basic-plots.html#boxplot"><i class="fa fa-check"></i><b>11.3</b> Boxplot</a></li>
<li class="chapter" data-level="" data-path="basic-plots.html"><a href="basic-plots.html#exercises-6"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="importing-data.html"><a href="importing-data.html"><i class="fa fa-check"></i><b>12</b> Importing data</a><ul>
<li class="chapter" data-level="12.1" data-path="importing-data.html"><a href="importing-data.html#paths-and-the-working-directory"><i class="fa fa-check"></i><b>12.1</b> Paths and the working directory</a></li>
<li class="chapter" data-level="12.2" data-path="importing-data.html"><a href="importing-data.html#read.csv"><i class="fa fa-check"></i><b>12.2</b> <code>read.csv</code></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="programming-basics.html"><a href="programming-basics.html"><i class="fa fa-check"></i><b>13</b> Programming basics</a><ul>
<li class="chapter" data-level="13.1" data-path="programming-basics.html"><a href="programming-basics.html#conditionals-expressions"><i class="fa fa-check"></i><b>13.1</b> Conditionals expressions</a></li>
<li class="chapter" data-level="13.2" data-path="programming-basics.html"><a href="programming-basics.html#defining-functions"><i class="fa fa-check"></i><b>13.2</b> Defining functions</a></li>
<li class="chapter" data-level="13.3" data-path="programming-basics.html"><a href="programming-basics.html#namespaces"><i class="fa fa-check"></i><b>13.3</b> Namespaces</a></li>
<li class="chapter" data-level="13.4" data-path="programming-basics.html"><a href="programming-basics.html#for-loops"><i class="fa fa-check"></i><b>13.4</b> For-loops</a></li>
<li class="chapter" data-level="13.5" data-path="programming-basics.html"><a href="programming-basics.html#vectorization-and-functionals"><i class="fa fa-check"></i><b>13.5</b> Vectorization and functionals</a></li>
<li class="chapter" data-level="13.6" data-path="programming-basics.html"><a href="programming-basics.html#map"><i class="fa fa-check"></i><b>13.6</b> map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exercises-7.html"><a href="exercises-7.html"><i class="fa fa-check"></i>Exercises</a></li>
<li class="part"><span><b>II Data Visualization</b></span></li>
<li class="chapter" data-level="14" data-path="distributions.html"><a href="distributions.html"><i class="fa fa-check"></i><b>14</b> Distributions</a><ul>
<li class="chapter" data-level="14.1" data-path="distributions.html"><a href="distributions.html#variable-types"><i class="fa fa-check"></i><b>14.1</b> Variable types</a></li>
<li class="chapter" data-level="" data-path="distributions.html"><a href="distributions.html#exercises-8"><i class="fa fa-check"></i>Exercises</a></li>
<li class="chapter" data-level="14.2" data-path="distributions.html"><a href="distributions.html#case-study-student-heights"><i class="fa fa-check"></i><b>14.2</b> Case study: Student heights</a></li>
<li class="chapter" data-level="14.3" data-path="distributions.html"><a href="distributions.html#distribution-function"><i class="fa fa-check"></i><b>14.3</b> Distribution function</a></li>
<li class="chapter" data-level="14.4" data-path="distributions.html"><a href="distributions.html#cumulative-distribution-functions"><i class="fa fa-check"></i><b>14.4</b> Cumulative distribution functions</a></li>
<li class="chapter" data-level="14.5" data-path="distributions.html"><a href="distributions.html#histograms-1"><i class="fa fa-check"></i><b>14.5</b> Histograms</a></li>
<li class="chapter" data-level="14.6" data-path="distributions.html"><a href="distributions.html#smoothed-density"><i class="fa fa-check"></i><b>14.6</b> Smoothed density</a><ul>
<li class="chapter" data-level="" data-path="distributions.html"><a href="distributions.html#interpreting-the-y-axis"><i class="fa fa-check"></i>Interpreting the y-axis</a></li>
<li class="chapter" data-level="" data-path="distributions.html"><a href="distributions.html#densities-permit-stratification"><i class="fa fa-check"></i>Densities permit stratification</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="distributions.html"><a href="distributions.html#exercises-9"><i class="fa fa-check"></i>Exercises</a></li>
<li class="chapter" data-level="14.7" data-path="distributions.html"><a href="distributions.html#the-normal-distribution"><i class="fa fa-check"></i><b>14.7</b> The normal distribution</a></li>
<li class="chapter" data-level="14.8" data-path="distributions.html"><a href="distributions.html#standardized-units"><i class="fa fa-check"></i><b>14.8</b> Standardized units</a></li>
<li class="chapter" data-level="14.9" data-path="distributions.html"><a href="distributions.html#quantile-quantile-qq-plots"><i class="fa fa-check"></i><b>14.9</b> Quantile-quantile QQ plots</a></li>
<li class="chapter" data-level="14.10" data-path="distributions.html"><a href="distributions.html#percentiles"><i class="fa fa-check"></i><b>14.10</b> Percentiles</a></li>
<li class="chapter" data-level="14.11" data-path="distributions.html"><a href="distributions.html#case-study-student-heights-continued"><i class="fa fa-check"></i><b>14.11</b> Case study: Student heights (continued)</a></li>
<li class="chapter" data-level="14.12" data-path="distributions.html"><a href="distributions.html#boxplots"><i class="fa fa-check"></i><b>14.12</b> Boxplots</a></li>
<li class="chapter" data-level="14.13" data-path="distributions.html"><a href="distributions.html#case-study-student-heights-continued-1"><i class="fa fa-check"></i><b>14.13</b> Case study: Student heights (continued)</a></li>
<li class="chapter" data-level="" data-path="distributions.html"><a href="distributions.html#exercises-10"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="robust-summaries.html"><a href="robust-summaries.html"><i class="fa fa-check"></i><b>15</b> Robust summaries</a><ul>
<li class="chapter" data-level="15.1" data-path="robust-summaries.html"><a href="robust-summaries.html#outliers"><i class="fa fa-check"></i><b>15.1</b> Outliers</a></li>
<li class="chapter" data-level="15.2" data-path="robust-summaries.html"><a href="robust-summaries.html#median"><i class="fa fa-check"></i><b>15.2</b> Median</a></li>
<li class="chapter" data-level="15.3" data-path="robust-summaries.html"><a href="robust-summaries.html#the-inter-quartile-range-iqr"><i class="fa fa-check"></i><b>15.3</b> The inter quartile range (IQR)</a></li>
<li class="chapter" data-level="15.4" data-path="robust-summaries.html"><a href="robust-summaries.html#tukeys-definition-of-an-outlier"><i class="fa fa-check"></i><b>15.4</b> Tukey’s definition of an outlier</a></li>
<li class="chapter" data-level="15.5" data-path="robust-summaries.html"><a href="robust-summaries.html#median-absolute-deviation"><i class="fa fa-check"></i><b>15.5</b> Median absolute deviation</a></li>
<li class="chapter" data-level="" data-path="robust-summaries.html"><a href="robust-summaries.html#exercises-11"><i class="fa fa-check"></i>Exercises</a></li>
<li class="chapter" data-level="15.6" data-path="robust-summaries.html"><a href="robust-summaries.html#case-study-self-reported-student-heights"><i class="fa fa-check"></i><b>15.6</b> Case study: Self-reported student heights</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="summarizing-data-with-dplyr.html"><a href="summarizing-data-with-dplyr.html"><i class="fa fa-check"></i><b>16</b> Summarizing data with dplyr</a><ul>
<li class="chapter" data-level="16.1" data-path="summarizing-data-with-dplyr.html"><a href="summarizing-data-with-dplyr.html#summarize"><i class="fa fa-check"></i><b>16.1</b> Summarize</a></li>
<li class="chapter" data-level="16.2" data-path="summarizing-data-with-dplyr.html"><a href="summarizing-data-with-dplyr.html#the-dot-operator"><i class="fa fa-check"></i><b>16.2</b> The dot operator</a></li>
<li class="chapter" data-level="16.3" data-path="summarizing-data-with-dplyr.html"><a href="summarizing-data-with-dplyr.html#group-then-summarize"><i class="fa fa-check"></i><b>16.3</b> Group then summarize</a></li>
<li class="chapter" data-level="16.4" data-path="summarizing-data-with-dplyr.html"><a href="summarizing-data-with-dplyr.html#sorting-data-frames"><i class="fa fa-check"></i><b>16.4</b> Sorting data frames</a><ul>
<li class="chapter" data-level="" data-path="summarizing-data-with-dplyr.html"><a href="summarizing-data-with-dplyr.html#nested-sorting"><i class="fa fa-check"></i>Nested sorting</a></li>
<li><a href="summarizing-data-with-dplyr.html#the-top-n">The top <span class="math inline">\(n\)</span></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="summarizing-data-with-dplyr.html"><a href="summarizing-data-with-dplyr.html#exercises-12"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>17</b> ggplot2</a><ul>
<li class="chapter" data-level="17.1" data-path="ggplot2.html"><a href="ggplot2.html#the-cheat-sheet"><i class="fa fa-check"></i><b>17.1</b> The cheat sheet</a></li>
<li class="chapter" data-level="17.2" data-path="ggplot2.html"><a href="ggplot2.html#the-components-of-a-graph"><i class="fa fa-check"></i><b>17.2</b> The components of a graph</a></li>
<li class="chapter" data-level="17.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot-objects-a-blank-slate"><i class="fa fa-check"></i><b>17.3</b> <code>ggplot</code> objects: a blank slate</a></li>
<li class="chapter" data-level="17.4" data-path="ggplot2.html"><a href="ggplot2.html#geometries"><i class="fa fa-check"></i><b>17.4</b> Geometries</a></li>
<li class="chapter" data-level="17.5" data-path="ggplot2.html"><a href="ggplot2.html#aesthetic-mappings"><i class="fa fa-check"></i><b>17.5</b> Aesthetic mappings</a></li>
<li class="chapter" data-level="17.6" data-path="ggplot2.html"><a href="ggplot2.html#layers"><i class="fa fa-check"></i><b>17.6</b> Layers</a></li>
<li class="chapter" data-level="17.7" data-path="ggplot2.html"><a href="ggplot2.html#tinkering-with-arguments"><i class="fa fa-check"></i><b>17.7</b> Tinkering with arguments</a></li>
<li class="chapter" data-level="17.8" data-path="ggplot2.html"><a href="ggplot2.html#global-versus-local-aesthetic-mappings"><i class="fa fa-check"></i><b>17.8</b> Global versus local aesthetic mappings</a></li>
<li class="chapter" data-level="17.9" data-path="ggplot2.html"><a href="ggplot2.html#scales"><i class="fa fa-check"></i><b>17.9</b> Scales</a></li>
<li class="chapter" data-level="17.10" data-path="ggplot2.html"><a href="ggplot2.html#labels-and-titles"><i class="fa fa-check"></i><b>17.10</b> Labels and titles</a></li>
<li class="chapter" data-level="17.11" data-path="ggplot2.html"><a href="ggplot2.html#categories-as-colors"><i class="fa fa-check"></i><b>17.11</b> Categories as colors</a></li>
<li class="chapter" data-level="17.12" data-path="ggplot2.html"><a href="ggplot2.html#annotation-and-shapes"><i class="fa fa-check"></i><b>17.12</b> Annotation and shapes</a></li>
<li class="chapter" data-level="17.13" data-path="ggplot2.html"><a href="ggplot2.html#adjustments"><i class="fa fa-check"></i><b>17.13</b> Adjustments</a></li>
<li class="chapter" data-level="17.14" data-path="ggplot2.html"><a href="ggplot2.html#add-on-packages"><i class="fa fa-check"></i><b>17.14</b> Add-on packages</a></li>
<li class="chapter" data-level="17.15" data-path="ggplot2.html"><a href="ggplot2.html#putting-it-all-together"><i class="fa fa-check"></i><b>17.15</b> Putting it all together</a></li>
<li class="chapter" data-level="17.16" data-path="ggplot2.html"><a href="ggplot2.html#other-geometries"><i class="fa fa-check"></i><b>17.16</b> Other geometries</a><ul>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#histogram"><i class="fa fa-check"></i>Histogram</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#density"><i class="fa fa-check"></i>Density</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#qq-plots"><i class="fa fa-check"></i>QQ-plots</a></li>
</ul></li>
<li class="chapter" data-level="17.17" data-path="ggplot2.html"><a href="ggplot2.html#grids-of-plots"><i class="fa fa-check"></i><b>17.17</b> Grids of plots</a></li>
<li class="chapter" data-level="17.18" data-path="ggplot2.html"><a href="ggplot2.html#quick-plots-with-qplot"><i class="fa fa-check"></i><b>17.18</b> Quick plots with <code>qplot</code></a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#exercises-13"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html"><i class="fa fa-check"></i><b>18</b> Case study: Trends in world health and economics</a><ul>
<li class="chapter" data-level="18.1" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#example-1-life-expectancy-and-fertility-rates"><i class="fa fa-check"></i><b>18.1</b> Example 1: Life expectancy and fertility rates</a><ul>
<li class="chapter" data-level="" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#hans-roslings-quiz"><i class="fa fa-check"></i>Hans Rosling’s quiz</a></li>
<li class="chapter" data-level="" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#a-scatterplot"><i class="fa fa-check"></i>A scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#faceting"><i class="fa fa-check"></i><b>18.2</b> Faceting</a><ul>
<li><a href="case-study-trends-in-world-health-and-economics.html#facet_wrap"><code>facet_wrap</code></a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#fixed-scales-for-better-comparisons"><i class="fa fa-check"></i><b>18.3</b> Fixed scales for better comparisons</a></li>
<li class="chapter" data-level="18.4" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#time-series-plots"><i class="fa fa-check"></i><b>18.4</b> Time series plots</a></li>
<li class="chapter" data-level="18.5" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#labels-for-legends"><i class="fa fa-check"></i><b>18.5</b> Labels for legends</a></li>
<li class="chapter" data-level="18.6" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#example-2-income-distribution"><i class="fa fa-check"></i><b>18.6</b> Example 2: Income distribution</a></li>
<li class="chapter" data-level="18.7" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#transformations"><i class="fa fa-check"></i><b>18.7</b> Transformations</a><ul>
<li class="chapter" data-level="" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#country-income-distribution"><i class="fa fa-check"></i>Country income distribution</a></li>
<li class="chapter" data-level="" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#which-base"><i class="fa fa-check"></i>Which base?</a></li>
<li class="chapter" data-level="" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#transform-the-values-or-the-scale"><i class="fa fa-check"></i>Transform the values or the scale?</a></li>
</ul></li>
<li class="chapter" data-level="18.8" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#modes"><i class="fa fa-check"></i><b>18.8</b> Modes</a></li>
<li class="chapter" data-level="18.9" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#stratify-and-boxplot"><i class="fa fa-check"></i><b>18.9</b> Stratify and boxplot</a><ul>
<li class="chapter" data-level="" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#do-not-order-alphabetically"><i class="fa fa-check"></i>Do not order alphabetically</a></li>
<li class="chapter" data-level="" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#show-the-data"><i class="fa fa-check"></i>Show the data</a></li>
</ul></li>
<li class="chapter" data-level="18.10" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#comparing-distributions"><i class="fa fa-check"></i><b>18.10</b> Comparing distributions</a><ul>
<li class="chapter" data-level="" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#density-plots"><i class="fa fa-check"></i>Density plots</a></li>
<li class="chapter" data-level="" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#accessing-computed-variables"><i class="fa fa-check"></i>Accessing computed variables</a></li>
<li class="chapter" data-level="18.10.1" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#case_when"><i class="fa fa-check"></i><b>18.10.1</b> ‘case_when’</a></li>
<li class="chapter" data-level="" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#weighted-densities"><i class="fa fa-check"></i>Weighted densities</a></li>
</ul></li>
<li class="chapter" data-level="18.11" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#ecological-fallacy"><i class="fa fa-check"></i><b>18.11</b> Ecological fallacy</a><ul>
<li class="chapter" data-level="" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#logistic-transformation"><i class="fa fa-check"></i>Logistic transformation</a></li>
<li class="chapter" data-level="" data-path="case-study-trends-in-world-health-and-economics.html"><a href="case-study-trends-in-world-health-and-economics.html#show-the-data-1"><i class="fa fa-check"></i>Show the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html"><i class="fa fa-check"></i><b>19</b> Data visualization principles</a><ul>
<li class="chapter" data-level="19.1" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#encoding-data-using-visual-cues"><i class="fa fa-check"></i><b>19.1</b> Encoding data using visual cues</a></li>
<li class="chapter" data-level="19.2" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#know-when-to-include-0"><i class="fa fa-check"></i><b>19.2</b> Know when to include 0</a></li>
<li class="chapter" data-level="19.3" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#do-not-distort-quantities"><i class="fa fa-check"></i><b>19.3</b> Do not distort quantities</a></li>
<li class="chapter" data-level="19.4" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#order-by-a-meaningful-value"><i class="fa fa-check"></i><b>19.4</b> Order by a meaningful value</a></li>
<li class="chapter" data-level="19.5" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#show-the-data-2"><i class="fa fa-check"></i><b>19.5</b> Show the data</a></li>
<li class="chapter" data-level="19.6" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#ease-comparisons-use-common-axes"><i class="fa fa-check"></i><b>19.6</b> Ease comparisons: use common axes</a></li>
<li class="chapter" data-level="19.7" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#ease-comparisons-align-plots-vertically-to-see-horizontal-changes-and-horizontally-to-see-vertical-changes"><i class="fa fa-check"></i><b>19.7</b> Ease comparisons: align plots vertically to see horizontal changes and horizontally to see vertical changes</a></li>
<li class="chapter" data-level="19.8" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#consider-transformations"><i class="fa fa-check"></i><b>19.8</b> Consider transformations</a></li>
<li class="chapter" data-level="19.9" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#ease-comparisons-visual-cues-to-be-compared-should-be-adjacent"><i class="fa fa-check"></i><b>19.9</b> Ease comparisons: visual cues to be compared should be adjacent</a></li>
<li class="chapter" data-level="19.10" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#ease-comparison-use-color"><i class="fa fa-check"></i><b>19.10</b> Ease comparison: use color</a></li>
<li class="chapter" data-level="19.11" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#think-of-the-color-blind"><i class="fa fa-check"></i><b>19.11</b> Think of the color blind</a></li>
<li class="chapter" data-level="19.12" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#use-scatterplots-to-examine-the-relationship-between-two-variables"><i class="fa fa-check"></i><b>19.12</b> Use scatterplots to examine the relationship between two variables</a><ul>
<li class="chapter" data-level="19.12.1" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#slope-charts"><i class="fa fa-check"></i><b>19.12.1</b> Slope charts</a></li>
<li class="chapter" data-level="19.12.2" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#bland-altman-plot"><i class="fa fa-check"></i><b>19.12.2</b> Bland-Altman plot</a></li>
</ul></li>
<li class="chapter" data-level="19.13" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#encoding-a-third-variable"><i class="fa fa-check"></i><b>19.13</b> Encoding a third variable</a></li>
<li class="chapter" data-level="19.14" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#avoid-pseudo-three-dimensional-plots"><i class="fa fa-check"></i><b>19.14</b> Avoid pseudo three dimensional plots</a></li>
<li class="chapter" data-level="19.15" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#avoid-gratuitous-three-dimensional-plots"><i class="fa fa-check"></i><b>19.15</b> Avoid gratuitous three dimensional plots</a></li>
<li class="chapter" data-level="19.16" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#avoid-too-many-significant-digits"><i class="fa fa-check"></i><b>19.16</b> Avoid too many significant digits</a></li>
<li class="chapter" data-level="19.17" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#know-your-audience"><i class="fa fa-check"></i><b>19.17</b> Know your audience</a></li>
<li class="chapter" data-level="19.18" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#further-reading"><i class="fa fa-check"></i><b>19.18</b> Further reading:</a></li>
<li class="chapter" data-level="" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#exercises-14"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="case-study-the-impact-of-vaccines-on-battling-infectious-diseases.html"><a href="case-study-the-impact-of-vaccines-on-battling-infectious-diseases.html"><i class="fa fa-check"></i><b>20</b> Case study: The impact of vaccines on battling infectious diseases</a><ul>
<li class="chapter" data-level="" data-path="case-study-the-impact-of-vaccines-on-battling-infectious-diseases.html"><a href="case-study-the-impact-of-vaccines-on-battling-infectious-diseases.html#exercises-15"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="part"><span><b>III Probability</b></span></li>
<li class="chapter" data-level="21" data-path="discrete-probability.html"><a href="discrete-probability.html"><i class="fa fa-check"></i><b>21</b> Discrete probability</a><ul>
<li class="chapter" data-level="21.1" data-path="discrete-probability.html"><a href="discrete-probability.html#relative-frequency"><i class="fa fa-check"></i><b>21.1</b> Relative frequency</a></li>
<li class="chapter" data-level="21.2" data-path="discrete-probability.html"><a href="discrete-probability.html#notation"><i class="fa fa-check"></i><b>21.2</b> Notation</a></li>
<li class="chapter" data-level="21.3" data-path="discrete-probability.html"><a href="discrete-probability.html#monte-carlo-simulations"><i class="fa fa-check"></i><b>21.3</b> Monte Carlo simulations</a></li>
<li class="chapter" data-level="21.4" data-path="discrete-probability.html"><a href="discrete-probability.html#setting-the-random-seed"><i class="fa fa-check"></i><b>21.4</b> Setting the random seed</a><ul>
<li class="chapter" data-level="" data-path="discrete-probability.html"><a href="discrete-probability.html#with-and-without-replacement"><i class="fa fa-check"></i>With and without replacement</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="discrete-probability.html"><a href="discrete-probability.html#probability-distributions"><i class="fa fa-check"></i><b>21.5</b> Probability distributions</a></li>
<li class="chapter" data-level="21.6" data-path="discrete-probability.html"><a href="discrete-probability.html#independence"><i class="fa fa-check"></i><b>21.6</b> Independence</a></li>
<li class="chapter" data-level="21.7" data-path="discrete-probability.html"><a href="discrete-probability.html#conditional-probabilities"><i class="fa fa-check"></i><b>21.7</b> Conditional probabilities</a></li>
<li class="chapter" data-level="21.8" data-path="discrete-probability.html"><a href="discrete-probability.html#multiplication-rule"><i class="fa fa-check"></i><b>21.8</b> Multiplication rule</a><ul>
<li class="chapter" data-level="" data-path="discrete-probability.html"><a href="discrete-probability.html#multiplication-rule-under-indepedence"><i class="fa fa-check"></i>Multiplication rule under indepedence</a></li>
</ul></li>
<li class="chapter" data-level="21.9" data-path="discrete-probability.html"><a href="discrete-probability.html#combinations-and-permutations"><i class="fa fa-check"></i><b>21.9</b> Combinations and permutations</a><ul>
<li class="chapter" data-level="" data-path="discrete-probability.html"><a href="discrete-probability.html#monte-carlo-example"><i class="fa fa-check"></i>Monte Carlo example</a></li>
</ul></li>
<li class="chapter" data-level="21.10" data-path="discrete-probability.html"><a href="discrete-probability.html#birthday-problem"><i class="fa fa-check"></i><b>21.10</b> Birthday problem</a></li>
<li class="chapter" data-level="21.11" data-path="discrete-probability.html"><a href="discrete-probability.html#how-many-monte-carlo-experiments-are-enough"><i class="fa fa-check"></i><b>21.11</b> How many Monte Carlo experiments are enough</a></li>
<li class="chapter" data-level="21.12" data-path="discrete-probability.html"><a href="discrete-probability.html#addition-rule"><i class="fa fa-check"></i><b>21.12</b> Addition rule</a></li>
<li class="chapter" data-level="21.13" data-path="discrete-probability.html"><a href="discrete-probability.html#monty-hall-problem"><i class="fa fa-check"></i><b>21.13</b> Monty Hall problem</a></li>
<li class="chapter" data-level="" data-path="discrete-probability.html"><a href="discrete-probability.html#exercises-16"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="continuous-probability.html"><a href="continuous-probability.html"><i class="fa fa-check"></i><b>22</b> Continuous probability</a><ul>
<li class="chapter" data-level="22.1" data-path="continuous-probability.html"><a href="continuous-probability.html#theoretical-distribution"><i class="fa fa-check"></i><b>22.1</b> Theoretical distribution</a></li>
<li class="chapter" data-level="22.2" data-path="continuous-probability.html"><a href="continuous-probability.html#approximations"><i class="fa fa-check"></i><b>22.2</b> Approximations</a></li>
<li class="chapter" data-level="22.3" data-path="continuous-probability.html"><a href="continuous-probability.html#the-probability-density"><i class="fa fa-check"></i><b>22.3</b> The probability density</a></li>
<li class="chapter" data-level="22.4" data-path="continuous-probability.html"><a href="continuous-probability.html#monte-carlo-simulations-1"><i class="fa fa-check"></i><b>22.4</b> Monte Carlo simulations</a></li>
<li class="chapter" data-level="22.5" data-path="continuous-probability.html"><a href="continuous-probability.html#other-continuous-distributions"><i class="fa fa-check"></i><b>22.5</b> Other continuous distributions</a></li>
<li class="chapter" data-level="" data-path="continuous-probability.html"><a href="continuous-probability.html#exercise-1"><i class="fa fa-check"></i>Exercise</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="random-variables.html"><a href="random-variables.html"><i class="fa fa-check"></i><b>23</b> Random variables</a><ul>
<li class="chapter" data-level="23.1" data-path="random-variables.html"><a href="random-variables.html#sampling-models"><i class="fa fa-check"></i><b>23.1</b> Sampling models</a></li>
<li class="chapter" data-level="23.2" data-path="random-variables.html"><a href="random-variables.html#the-probability-distribution-of-a-random-variable"><i class="fa fa-check"></i><b>23.2</b> The probability distribution of a random variable</a></li>
<li class="chapter" data-level="23.3" data-path="random-variables.html"><a href="random-variables.html#distributions-versus-probability-distributions"><i class="fa fa-check"></i><b>23.3</b> Distributions versus probability distributions</a></li>
<li class="chapter" data-level="23.4" data-path="random-variables.html"><a href="random-variables.html#notation-for-random-variables"><i class="fa fa-check"></i><b>23.4</b> Notation for random variables</a></li>
<li class="chapter" data-level="23.5" data-path="random-variables.html"><a href="random-variables.html#central-limit-theorem"><i class="fa fa-check"></i><b>23.5</b> Central Limit Theorem</a></li>
<li class="chapter" data-level="23.6" data-path="random-variables.html"><a href="random-variables.html#the-expected-value-and-standard-error"><i class="fa fa-check"></i><b>23.6</b> The expected value and standard error</a></li>
<li class="chapter" data-level="23.7" data-path="random-variables.html"><a href="random-variables.html#central-limit-theorem-approximation"><i class="fa fa-check"></i><b>23.7</b> Central Limit Theorem approximation</a></li>
<li class="chapter" data-level="23.8" data-path="random-variables.html"><a href="random-variables.html#statistical-properties-of-averages"><i class="fa fa-check"></i><b>23.8</b> Statistical properties of averages</a><ul>
<li><a href="random-variables.html#why-we-use-mu-and-sigma">Why we use <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span></a></li>
</ul></li>
<li class="chapter" data-level="23.9" data-path="random-variables.html"><a href="random-variables.html#law-of-large-numbers"><i class="fa fa-check"></i><b>23.9</b> Law of large numbers</a><ul>
<li class="chapter" data-level="23.9.1" data-path="random-variables.html"><a href="random-variables.html#misinterpreting-law-of-averages"><i class="fa fa-check"></i><b>23.9.1</b> Misinterpreting law of averages</a></li>
</ul></li>
<li class="chapter" data-level="23.10" data-path="random-variables.html"><a href="random-variables.html#how-large-is-large-in-clt"><i class="fa fa-check"></i><b>23.10</b> How large is large in CLT?</a></li>
<li class="chapter" data-level="23.11" data-path="random-variables.html"><a href="random-variables.html#population-sd-versus-the-sample-sd"><i class="fa fa-check"></i><b>23.11</b> Population SD versus the sample SD</a></li>
<li class="chapter" data-level="" data-path="random-variables.html"><a href="random-variables.html#exercises-17"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="case-study-the-big-short.html"><a href="case-study-the-big-short.html"><i class="fa fa-check"></i><b>24</b> Case study: The Big Short</a><ul>
<li class="chapter" data-level="24.1" data-path="case-study-the-big-short.html"><a href="case-study-the-big-short.html#interest-rates-explained-with-chance-model"><i class="fa fa-check"></i><b>24.1</b> Interest rates explained with chance model</a></li>
<li class="chapter" data-level="24.2" data-path="case-study-the-big-short.html"><a href="case-study-the-big-short.html#the-big-short"><i class="fa fa-check"></i><b>24.2</b> The Big Short</a></li>
<li class="chapter" data-level="" data-path="case-study-the-big-short.html"><a href="case-study-the-big-short.html#exercises-18"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="part"><span><b>IV Inference and modeling</b></span></li>
<li class="chapter" data-level="25" data-path="polls.html"><a href="polls.html"><i class="fa fa-check"></i><b>25</b> Polls</a><ul>
<li class="chapter" data-level="25.1" data-path="polls.html"><a href="polls.html#opinion-polls"><i class="fa fa-check"></i><b>25.1</b> Opinion polls</a></li>
<li class="chapter" data-level="25.2" data-path="polls.html"><a href="polls.html#the-sampling-model-for-polls"><i class="fa fa-check"></i><b>25.2</b> The sampling model for polls</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="populations-samples-parameters-and-estimates.html"><a href="populations-samples-parameters-and-estimates.html"><i class="fa fa-check"></i><b>26</b> Populations, samples, parameters and estimates</a><ul>
<li class="chapter" data-level="26.1" data-path="populations-samples-parameters-and-estimates.html"><a href="populations-samples-parameters-and-estimates.html#the-sample-average"><i class="fa fa-check"></i><b>26.1</b> The sample average</a></li>
<li class="chapter" data-level="26.2" data-path="populations-samples-parameters-and-estimates.html"><a href="populations-samples-parameters-and-estimates.html#parameters"><i class="fa fa-check"></i><b>26.2</b> Parameters</a></li>
<li class="chapter" data-level="26.3" data-path="populations-samples-parameters-and-estimates.html"><a href="populations-samples-parameters-and-estimates.html#polling-versus-forecasting"><i class="fa fa-check"></i><b>26.3</b> Polling versus forecasting</a></li>
<li class="chapter" data-level="26.4" data-path="populations-samples-parameters-and-estimates.html"><a href="populations-samples-parameters-and-estimates.html#properties-of-our-estimate-expected-value-and-standard-error"><i class="fa fa-check"></i><b>26.4</b> Properties of our estimate: expected value and standard error</a></li>
<li class="chapter" data-level="" data-path="populations-samples-parameters-and-estimates.html"><a href="populations-samples-parameters-and-estimates.html#exercises-19"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="central-limit-theorem-in-practice.html"><a href="central-limit-theorem-in-practice.html"><i class="fa fa-check"></i><b>27</b> Central Limit Theorem in practice</a><ul>
<li class="chapter" data-level="27.1" data-path="central-limit-theorem-in-practice.html"><a href="central-limit-theorem-in-practice.html#a-monte-carlo-simulation"><i class="fa fa-check"></i><b>27.1</b> A Monte Carlo simulation</a></li>
<li class="chapter" data-level="27.2" data-path="central-limit-theorem-in-practice.html"><a href="central-limit-theorem-in-practice.html#the-spread"><i class="fa fa-check"></i><b>27.2</b> The spread</a></li>
<li class="chapter" data-level="27.3" data-path="central-limit-theorem-in-practice.html"><a href="central-limit-theorem-in-practice.html#bias-why-not-run-a-very-large-poll"><i class="fa fa-check"></i><b>27.3</b> Bias: why not run a very large poll?</a></li>
<li class="chapter" data-level="" data-path="central-limit-theorem-in-practice.html"><a href="central-limit-theorem-in-practice.html#exercises-20"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="confidence-intervals.html"><a href="confidence-intervals.html"><i class="fa fa-check"></i><b>28</b> Confidence intervals</a><ul>
<li class="chapter" data-level="28.1" data-path="confidence-intervals.html"><a href="confidence-intervals.html#a-monte-carlo-simulation-1"><i class="fa fa-check"></i><b>28.1</b> A Monte Carlo simulation</a></li>
<li class="chapter" data-level="28.2" data-path="confidence-intervals.html"><a href="confidence-intervals.html#the-correct-language"><i class="fa fa-check"></i><b>28.2</b> The correct language</a></li>
<li class="chapter" data-level="28.3" data-path="confidence-intervals.html"><a href="confidence-intervals.html#power"><i class="fa fa-check"></i><b>28.3</b> Power</a></li>
<li class="chapter" data-level="28.4" data-path="confidence-intervals.html"><a href="confidence-intervals.html#p-values"><i class="fa fa-check"></i><b>28.4</b> p-values</a></li>
<li class="chapter" data-level="" data-path="confidence-intervals.html"><a href="confidence-intervals.html#exercises-21"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>29</b> Statistical models</a><ul>
<li class="chapter" data-level="29.1" data-path="statistical-models.html"><a href="statistical-models.html#poll-aggregators"><i class="fa fa-check"></i><b>29.1</b> Poll aggregators</a></li>
<li class="chapter" data-level="29.2" data-path="statistical-models.html"><a href="statistical-models.html#poll-data"><i class="fa fa-check"></i><b>29.2</b> Poll data</a></li>
<li class="chapter" data-level="29.3" data-path="statistical-models.html"><a href="statistical-models.html#pollster-bias"><i class="fa fa-check"></i><b>29.3</b> Pollster bias</a></li>
<li class="chapter" data-level="29.4" data-path="statistical-models.html"><a href="statistical-models.html#data-driven-model"><i class="fa fa-check"></i><b>29.4</b> Data driven model</a></li>
<li class="chapter" data-level="" data-path="statistical-models.html"><a href="statistical-models.html#exercises-22"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="bayesian-statistics.html"><a href="bayesian-statistics.html"><i class="fa fa-check"></i><b>30</b> Bayesian statistics</a><ul>
<li class="chapter" data-level="30.1" data-path="bayesian-statistics.html"><a href="bayesian-statistics.html#bayes-theorem"><i class="fa fa-check"></i><b>30.1</b> Bayes theorem</a></li>
<li class="chapter" data-level="30.2" data-path="bayesian-statistics.html"><a href="bayesian-statistics.html#bayes-theorem-simulation"><i class="fa fa-check"></i><b>30.2</b> Bayes Theorem simulation</a></li>
<li class="chapter" data-level="30.3" data-path="bayesian-statistics.html"><a href="bayesian-statistics.html#bayes-in-practice"><i class="fa fa-check"></i><b>30.3</b> Bayes in practice</a></li>
<li class="chapter" data-level="30.4" data-path="bayesian-statistics.html"><a href="bayesian-statistics.html#the-hierarchical-model"><i class="fa fa-check"></i><b>30.4</b> The hierarchical model</a></li>
<li class="chapter" data-level="" data-path="bayesian-statistics.html"><a href="bayesian-statistics.html#exercises-23"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="case-study-election-forecasting.html"><a href="case-study-election-forecasting.html"><i class="fa fa-check"></i><b>31</b> Case study: Election forecasting</a><ul>
<li class="chapter" data-level="31.1" data-path="case-study-election-forecasting.html"><a href="case-study-election-forecasting.html#bayesian-approach"><i class="fa fa-check"></i><b>31.1</b> Bayesian approach</a></li>
<li class="chapter" data-level="31.2" data-path="case-study-election-forecasting.html"><a href="case-study-election-forecasting.html#the-general-bias"><i class="fa fa-check"></i><b>31.2</b> The general bias</a></li>
<li class="chapter" data-level="31.3" data-path="case-study-election-forecasting.html"><a href="case-study-election-forecasting.html#mathematical-representations-of-models"><i class="fa fa-check"></i><b>31.3</b> Mathematical representations of models</a></li>
<li class="chapter" data-level="31.4" data-path="case-study-election-forecasting.html"><a href="case-study-election-forecasting.html#predicting-the-electoral-college"><i class="fa fa-check"></i><b>31.4</b> Predicting the electoral college</a></li>
<li class="chapter" data-level="31.5" data-path="case-study-election-forecasting.html"><a href="case-study-election-forecasting.html#forecasting"><i class="fa fa-check"></i><b>31.5</b> Forecasting</a></li>
<li class="chapter" data-level="" data-path="case-study-election-forecasting.html"><a href="case-study-election-forecasting.html#exercise-2"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="" data-path="case-study-election-forecasting.html"><a href="case-study-election-forecasting.html#exercises-24"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="association-tests.html"><a href="association-tests.html"><i class="fa fa-check"></i><b>32</b> Association Tests</a><ul>
<li class="chapter" data-level="32.1" data-path="association-tests.html"><a href="association-tests.html#lady-tasting-tea"><i class="fa fa-check"></i><b>32.1</b> Lady Tasting Tea</a></li>
<li class="chapter" data-level="32.2" data-path="association-tests.html"><a href="association-tests.html#two-by-two-tables"><i class="fa fa-check"></i><b>32.2</b> Two-by-two tables</a></li>
<li class="chapter" data-level="32.3" data-path="association-tests.html"><a href="association-tests.html#chi-square-test"><i class="fa fa-check"></i><b>32.3</b> Chi-square Test</a></li>
<li class="chapter" data-level="32.4" data-path="association-tests.html"><a href="association-tests.html#the-odds-ratio"><i class="fa fa-check"></i><b>32.4</b> The Odds Ratio</a></li>
<li class="chapter" data-level="32.5" data-path="association-tests.html"><a href="association-tests.html#large-samples-small-p-values"><i class="fa fa-check"></i><b>32.5</b> Large samples, small p-values</a></li>
<li class="chapter" data-level="32.6" data-path="association-tests.html"><a href="association-tests.html#confidence-intervals-for-the-odds-ratio"><i class="fa fa-check"></i><b>32.6</b> Confidence intervals for the odds ratio</a></li>
<li class="chapter" data-level="" data-path="association-tests.html"><a href="association-tests.html#exercises-25"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="part"><span><b>V Data Wrangling</b></span></li>
<li class="chapter" data-level="33" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>33</b> Tidy data</a><ul>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercises-26"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="reshaping-data.html"><a href="reshaping-data.html"><i class="fa fa-check"></i><b>34</b> Reshaping data</a><ul>
<li class="chapter" data-level="34.1" data-path="reshaping-data.html"><a href="reshaping-data.html#gather"><i class="fa fa-check"></i><b>34.1</b> <code>gather</code></a></li>
<li class="chapter" data-level="34.2" data-path="reshaping-data.html"><a href="reshaping-data.html#spread"><i class="fa fa-check"></i><b>34.2</b> <code>spread</code></a></li>
<li class="chapter" data-level="34.3" data-path="reshaping-data.html"><a href="reshaping-data.html#separate"><i class="fa fa-check"></i><b>34.3</b> <code>separate</code></a></li>
<li class="chapter" data-level="34.4" data-path="reshaping-data.html"><a href="reshaping-data.html#unite"><i class="fa fa-check"></i><b>34.4</b> <code>unite</code></a></li>
<li class="chapter" data-level="" data-path="reshaping-data.html"><a href="reshaping-data.html#exercises-27"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="combining-tables.html"><a href="combining-tables.html"><i class="fa fa-check"></i><b>35</b> Combining tables</a><ul>
<li class="chapter" data-level="35.1" data-path="combining-tables.html"><a href="combining-tables.html#joins"><i class="fa fa-check"></i><b>35.1</b> Joins</a><ul>
<li class="chapter" data-level="35.1.1" data-path="combining-tables.html"><a href="combining-tables.html#left-join"><i class="fa fa-check"></i><b>35.1.1</b> Left join</a></li>
<li class="chapter" data-level="35.1.2" data-path="combining-tables.html"><a href="combining-tables.html#right-join"><i class="fa fa-check"></i><b>35.1.2</b> Right join</a></li>
<li class="chapter" data-level="35.1.3" data-path="combining-tables.html"><a href="combining-tables.html#inner-join"><i class="fa fa-check"></i><b>35.1.3</b> Inner join</a></li>
<li class="chapter" data-level="35.1.4" data-path="combining-tables.html"><a href="combining-tables.html#full-join"><i class="fa fa-check"></i><b>35.1.4</b> Full join</a></li>
<li class="chapter" data-level="35.1.5" data-path="combining-tables.html"><a href="combining-tables.html#semi-join"><i class="fa fa-check"></i><b>35.1.5</b> Semi join</a></li>
<li class="chapter" data-level="35.1.6" data-path="combining-tables.html"><a href="combining-tables.html#anti-join"><i class="fa fa-check"></i><b>35.1.6</b> Anti join</a></li>
</ul></li>
<li class="chapter" data-level="35.2" data-path="combining-tables.html"><a href="combining-tables.html#binding"><i class="fa fa-check"></i><b>35.2</b> Binding</a><ul>
<li class="chapter" data-level="35.2.1" data-path="combining-tables.html"><a href="combining-tables.html#binding-columns"><i class="fa fa-check"></i><b>35.2.1</b> Binding columns</a></li>
<li class="chapter" data-level="35.2.2" data-path="combining-tables.html"><a href="combining-tables.html#binding-by-rows"><i class="fa fa-check"></i><b>35.2.2</b> Binding by rows</a></li>
</ul></li>
<li class="chapter" data-level="35.3" data-path="combining-tables.html"><a href="combining-tables.html#set-operators"><i class="fa fa-check"></i><b>35.3</b> Set operators</a><ul>
<li class="chapter" data-level="35.3.1" data-path="combining-tables.html"><a href="combining-tables.html#intersect"><i class="fa fa-check"></i><b>35.3.1</b> Intersect</a></li>
<li class="chapter" data-level="35.3.2" data-path="combining-tables.html"><a href="combining-tables.html#union"><i class="fa fa-check"></i><b>35.3.2</b> Union</a></li>
<li class="chapter" data-level="35.3.3" data-path="combining-tables.html"><a href="combining-tables.html#setdiff"><i class="fa fa-check"></i><b>35.3.3</b> <code>setdiff</code></a></li>
<li class="chapter" data-level="35.3.4" data-path="combining-tables.html"><a href="combining-tables.html#setequal"><i class="fa fa-check"></i><b>35.3.4</b> <code>setequal</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="combining-tables.html"><a href="combining-tables.html#exercises-28"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="36" data-path="data-import.html"><a href="data-import.html"><i class="fa fa-check"></i><b>36</b> Data import</a><ul>
<li class="chapter" data-level="36.1" data-path="data-import.html"><a href="data-import.html#text-versus-binary-files"><i class="fa fa-check"></i><b>36.1</b> Text versus binary files</a></li>
<li class="chapter" data-level="36.2" data-path="data-import.html"><a href="data-import.html#unicode-versus-ascii"><i class="fa fa-check"></i><b>36.2</b> Unicode versus ASCII</a></li>
<li class="chapter" data-level="36.3" data-path="data-import.html"><a href="data-import.html#importing-spreadsheets"><i class="fa fa-check"></i><b>36.3</b> Importing spreadsheets</a></li>
<li class="chapter" data-level="36.4" data-path="data-import.html"><a href="data-import.html#paths-and-the-working-directory-1"><i class="fa fa-check"></i><b>36.4</b> Paths and the Working Directory</a></li>
<li class="chapter" data-level="36.5" data-path="data-import.html"><a href="data-import.html#the-readr-and-readxl-packages"><i class="fa fa-check"></i><b>36.5</b> The readr and readxl packages</a></li>
<li class="chapter" data-level="36.6" data-path="data-import.html"><a href="data-import.html#r-base-functions"><i class="fa fa-check"></i><b>36.6</b> R-base functions</a><ul>
<li class="chapter" data-level="36.6.1" data-path="data-import.html"><a href="data-import.html#downloading-files"><i class="fa fa-check"></i><b>36.6.1</b> Downloading files</a></li>
</ul></li>
<li class="chapter" data-level="36.7" data-path="data-import.html"><a href="data-import.html#nuances"><i class="fa fa-check"></i><b>36.7</b> Nuances</a></li>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercises-29"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="37" data-path="web-scraping.html"><a href="web-scraping.html"><i class="fa fa-check"></i><b>37</b> Web Scraping</a><ul>
<li class="chapter" data-level="37.1" data-path="web-scraping.html"><a href="web-scraping.html#html"><i class="fa fa-check"></i><b>37.1</b> HTML</a></li>
<li class="chapter" data-level="37.2" data-path="web-scraping.html"><a href="web-scraping.html#the-rvest-package"><i class="fa fa-check"></i><b>37.2</b> The rvest package</a></li>
<li class="chapter" data-level="37.3" data-path="web-scraping.html"><a href="web-scraping.html#css-selectors"><i class="fa fa-check"></i><b>37.3</b> CSS selectors</a></li>
<li class="chapter" data-level="37.4" data-path="web-scraping.html"><a href="web-scraping.html#json"><i class="fa fa-check"></i><b>37.4</b> JSON</a></li>
<li class="chapter" data-level="" data-path="web-scraping.html"><a href="web-scraping.html#exercises-30"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="38" data-path="string-processing.html"><a href="string-processing.html"><i class="fa fa-check"></i><b>38</b> String Processing</a><ul>
<li class="chapter" data-level="38.1" data-path="string-processing.html"><a href="string-processing.html#defining-strings-single-and-double-quotes-and-how-to-escape"><i class="fa fa-check"></i><b>38.1</b> Defining strings: single and double quotes and how to escape</a></li>
<li class="chapter" data-level="38.2" data-path="string-processing.html"><a href="string-processing.html#the-stringr-package"><i class="fa fa-check"></i><b>38.2</b> The stringr package</a><ul>
<li class="chapter" data-level="38.2.1" data-path="string-processing.html"><a href="string-processing.html#the-str_-functions"><i class="fa fa-check"></i><b>38.2.1</b> The <code>str_</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="38.3" data-path="string-processing.html"><a href="string-processing.html#case-study-1-us-murders-data"><i class="fa fa-check"></i><b>38.3</b> Case study 1: US murders data</a></li>
<li class="chapter" data-level="38.4" data-path="string-processing.html"><a href="string-processing.html#case-study-2-reported-heights"><i class="fa fa-check"></i><b>38.4</b> Case study 2: Reported heights</a></li>
<li class="chapter" data-level="38.5" data-path="string-processing.html"><a href="string-processing.html#regular-expressions"><i class="fa fa-check"></i><b>38.5</b> Regular expressions</a><ul>
<li class="chapter" data-level="38.5.1" data-path="string-processing.html"><a href="string-processing.html#a-string"><i class="fa fa-check"></i><b>38.5.1</b> A string</a></li>
<li class="chapter" data-level="38.5.2" data-path="string-processing.html"><a href="string-processing.html#special-characters"><i class="fa fa-check"></i><b>38.5.2</b> Special characters</a></li>
<li class="chapter" data-level="38.5.3" data-path="string-processing.html"><a href="string-processing.html#testing"><i class="fa fa-check"></i><b>38.5.3</b> Testing</a></li>
<li class="chapter" data-level="38.5.4" data-path="string-processing.html"><a href="string-processing.html#character-classes"><i class="fa fa-check"></i><b>38.5.4</b> Character classes</a></li>
<li class="chapter" data-level="38.5.5" data-path="string-processing.html"><a href="string-processing.html#anchors"><i class="fa fa-check"></i><b>38.5.5</b> Anchors</a></li>
<li class="chapter" data-level="38.5.6" data-path="string-processing.html"><a href="string-processing.html#quantifiers"><i class="fa fa-check"></i><b>38.5.6</b> Quantifiers</a></li>
<li class="chapter" data-level="38.5.7" data-path="string-processing.html"><a href="string-processing.html#not"><i class="fa fa-check"></i><b>38.5.7</b> Not</a></li>
<li class="chapter" data-level="38.5.8" data-path="string-processing.html"><a href="string-processing.html#search-and-replace-with-regex"><i class="fa fa-check"></i><b>38.5.8</b> Search and replace with regex</a></li>
<li class="chapter" data-level="38.5.9" data-path="string-processing.html"><a href="string-processing.html#white-space-s"><i class="fa fa-check"></i><b>38.5.9</b> White space <code>\s</code></a></li>
<li class="chapter" data-level="38.5.10" data-path="string-processing.html"><a href="string-processing.html#quantifiers-1"><i class="fa fa-check"></i><b>38.5.10</b> Quantifiers: <code>*</code>, <code>?</code>, <code>+</code></a></li>
<li class="chapter" data-level="38.5.11" data-path="string-processing.html"><a href="string-processing.html#groups"><i class="fa fa-check"></i><b>38.5.11</b> Groups</a></li>
<li class="chapter" data-level="38.5.12" data-path="string-processing.html"><a href="string-processing.html#search-and-replace-using-groups"><i class="fa fa-check"></i><b>38.5.12</b> Search and replace using groups</a></li>
<li class="chapter" data-level="38.5.13" data-path="string-processing.html"><a href="string-processing.html#testing-and-improving"><i class="fa fa-check"></i><b>38.5.13</b> Testing and improving</a></li>
<li class="chapter" data-level="38.5.14" data-path="string-processing.html"><a href="string-processing.html#using-groups-and-quantifiers"><i class="fa fa-check"></i><b>38.5.14</b> Using groups and quantifiers</a></li>
</ul></li>
<li class="chapter" data-level="38.6" data-path="string-processing.html"><a href="string-processing.html#stringr-package-continued"><i class="fa fa-check"></i><b>38.6</b> Stringr package (continued)</a><ul>
<li class="chapter" data-level="38.6.1" data-path="string-processing.html"><a href="string-processing.html#trimming"><i class="fa fa-check"></i><b>38.6.1</b> Trimming</a></li>
<li class="chapter" data-level="38.6.2" data-path="string-processing.html"><a href="string-processing.html#to-uppercase-and-to-lowercase"><i class="fa fa-check"></i><b>38.6.2</b> To uppercase and to lowercase</a></li>
</ul></li>
<li class="chapter" data-level="38.7" data-path="string-processing.html"><a href="string-processing.html#case-study-2-reported-heights-continued"><i class="fa fa-check"></i><b>38.7</b> Case study 2: Reported heights (continued)</a></li>
<li class="chapter" data-level="38.8" data-path="string-processing.html"><a href="string-processing.html#separate-1"><i class="fa fa-check"></i><b>38.8</b> <code>separate</code></a></li>
<li class="chapter" data-level="38.9" data-path="string-processing.html"><a href="string-processing.html#case-study-2-reported-heights-continued-1"><i class="fa fa-check"></i><b>38.9</b> Case study 2: Reported heights (continued)</a></li>
<li class="chapter" data-level="38.10" data-path="string-processing.html"><a href="string-processing.html#string-splitting"><i class="fa fa-check"></i><b>38.10</b> String splitting</a></li>
<li class="chapter" data-level="38.11" data-path="string-processing.html"><a href="string-processing.html#case-study-3-extracting-tables-from-a-pdf"><i class="fa fa-check"></i><b>38.11</b> Case study 3: Extracting tables from a PDF</a></li>
<li class="chapter" data-level="38.12" data-path="string-processing.html"><a href="string-processing.html#re-coding"><i class="fa fa-check"></i><b>38.12</b> Re-coding</a></li>
<li class="chapter" data-level="" data-path="string-processing.html"><a href="string-processing.html#exercises-31"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="parsing-dates-and-times.html"><a href="parsing-dates-and-times.html"><i class="fa fa-check"></i><b>39</b> Parsing Dates and Times</a><ul>
<li class="chapter" data-level="39.1" data-path="parsing-dates-and-times.html"><a href="parsing-dates-and-times.html#the-date-data-type"><i class="fa fa-check"></i><b>39.1</b> The date data type</a></li>
<li class="chapter" data-level="39.2" data-path="parsing-dates-and-times.html"><a href="parsing-dates-and-times.html#the-lubridate-package"><i class="fa fa-check"></i><b>39.2</b> The lubridate package</a></li>
<li class="chapter" data-level="" data-path="parsing-dates-and-times.html"><a href="parsing-dates-and-times.html#exercises-32"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="40" data-path="text-mining.html"><a href="text-mining.html"><i class="fa fa-check"></i><b>40</b> Text mining</a><ul>
<li class="chapter" data-level="40.1" data-path="text-mining.html"><a href="text-mining.html#case-study-trump-tweets"><i class="fa fa-check"></i><b>40.1</b> Case study: Trump tweets</a></li>
<li class="chapter" data-level="40.2" data-path="text-mining.html"><a href="text-mining.html#text-as-data"><i class="fa fa-check"></i><b>40.2</b> Text as data</a></li>
<li class="chapter" data-level="40.3" data-path="text-mining.html"><a href="text-mining.html#sentiment-analysis"><i class="fa fa-check"></i><b>40.3</b> Sentiment analysis</a></li>
<li class="chapter" data-level="" data-path="text-mining.html"><a href="text-mining.html#exercises-33"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="41" data-path="organizing-data-with-spreadsheets.html"><a href="organizing-data-with-spreadsheets.html"><i class="fa fa-check"></i><b>41</b> Organizing Data with Spreadsheets</a><ul>
<li class="chapter" data-level="" data-path="organizing-data-with-spreadsheets.html"><a href="organizing-data-with-spreadsheets.html#exercises-34"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="part"><span><b>VI Regression</b></span></li>
<li class="chapter" data-level="42" data-path="case-study-is-height-hereditary.html"><a href="case-study-is-height-hereditary.html"><i class="fa fa-check"></i><b>42</b> Case study: Is height hereditary?</a></li>
<li class="chapter" data-level="43" data-path="correlation-and-the-regression-line.html"><a href="correlation-and-the-regression-line.html"><i class="fa fa-check"></i><b>43</b> Correlation and the regression line</a><ul>
<li class="chapter" data-level="43.1" data-path="correlation-and-the-regression-line.html"><a href="correlation-and-the-regression-line.html#the-correlation-coefficient"><i class="fa fa-check"></i><b>43.1</b> The correlation coefficient</a></li>
<li class="chapter" data-level="43.2" data-path="correlation-and-the-regression-line.html"><a href="correlation-and-the-regression-line.html#sample-correlation-is-a-random-variable"><i class="fa fa-check"></i><b>43.2</b> Sample correlation is a random variable</a></li>
<li class="chapter" data-level="43.3" data-path="correlation-and-the-regression-line.html"><a href="correlation-and-the-regression-line.html#when-is-correlation-a-useful-summary"><i class="fa fa-check"></i><b>43.3</b> When is correlation a useful summary?</a></li>
<li class="chapter" data-level="43.4" data-path="correlation-and-the-regression-line.html"><a href="correlation-and-the-regression-line.html#prediction-based-on-stratification"><i class="fa fa-check"></i><b>43.4</b> Prediction based on stratification</a></li>
<li class="chapter" data-level="43.5" data-path="correlation-and-the-regression-line.html"><a href="correlation-and-the-regression-line.html#the-regression-line"><i class="fa fa-check"></i><b>43.5</b> The regression line</a></li>
<li class="chapter" data-level="43.6" data-path="correlation-and-the-regression-line.html"><a href="correlation-and-the-regression-line.html#regression-improves-precision"><i class="fa fa-check"></i><b>43.6</b> Regression improves precision</a></li>
<li class="chapter" data-level="43.7" data-path="correlation-and-the-regression-line.html"><a href="correlation-and-the-regression-line.html#bivariate-normal-distribution-advanced"><i class="fa fa-check"></i><b>43.7</b> Bivariate normal distribution (advanced)</a></li>
<li class="chapter" data-level="43.8" data-path="correlation-and-the-regression-line.html"><a href="correlation-and-the-regression-line.html#variance-explained"><i class="fa fa-check"></i><b>43.8</b> Variance explained</a></li>
<li class="chapter" data-level="43.9" data-path="correlation-and-the-regression-line.html"><a href="correlation-and-the-regression-line.html#warning-there-are-two-regression-lines"><i class="fa fa-check"></i><b>43.9</b> Warning: there are two regression lines</a></li>
<li class="chapter" data-level="" data-path="correlation-and-the-regression-line.html"><a href="correlation-and-the-regression-line.html#exercises-35"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="44" data-path="case-study-moneyball.html"><a href="case-study-moneyball.html"><i class="fa fa-check"></i><b>44</b> Case Study: Moneyball</a><ul>
<li class="chapter" data-level="44.1" data-path="case-study-moneyball.html"><a href="case-study-moneyball.html#sabermetics"><i class="fa fa-check"></i><b>44.1</b> Sabermetics</a></li>
<li class="chapter" data-level="44.2" data-path="case-study-moneyball.html"><a href="case-study-moneyball.html#baseball-basics"><i class="fa fa-check"></i><b>44.2</b> Baseball basics</a></li>
<li class="chapter" data-level="44.3" data-path="case-study-moneyball.html"><a href="case-study-moneyball.html#no-awards-for-bb"><i class="fa fa-check"></i><b>44.3</b> No awards for BB</a></li>
<li class="chapter" data-level="44.4" data-path="case-study-moneyball.html"><a href="case-study-moneyball.html#base-on-ball-or-stolen-bases"><i class="fa fa-check"></i><b>44.4</b> Base on Ball or Stolen Bases?</a></li>
<li class="chapter" data-level="44.5" data-path="case-study-moneyball.html"><a href="case-study-moneyball.html#regression-applied-to-baseball-statistics"><i class="fa fa-check"></i><b>44.5</b> Regression applied to baseball statistics</a></li>
</ul></li>
<li class="chapter" data-level="45" data-path="confounding.html"><a href="confounding.html"><i class="fa fa-check"></i><b>45</b> Confounding</a><ul>
<li class="chapter" data-level="45.1" data-path="confounding.html"><a href="confounding.html#understanding-confounding-through-stratification"><i class="fa fa-check"></i><b>45.1</b> Understanding confounding through stratification</a></li>
<li class="chapter" data-level="45.2" data-path="confounding.html"><a href="confounding.html#multivariate-regression"><i class="fa fa-check"></i><b>45.2</b> Multivariate regression</a></li>
</ul></li>
<li class="chapter" data-level="46" data-path="linear-models-and-least-squared-estimates.html"><a href="linear-models-and-least-squared-estimates.html"><i class="fa fa-check"></i><b>46</b> Linear Models and Least Squared Estimates</a><ul>
<li class="chapter" data-level="46.1" data-path="linear-models-and-least-squared-estimates.html"><a href="linear-models-and-least-squared-estimates.html#interpreting-linear-models"><i class="fa fa-check"></i><b>46.1</b> Interpreting linear models</a></li>
<li class="chapter" data-level="46.2" data-path="linear-models-and-least-squared-estimates.html"><a href="linear-models-and-least-squared-estimates.html#least-squares-estimates-lse"><i class="fa fa-check"></i><b>46.2</b> Least Squares Estimates (LSE)</a></li>
<li class="chapter" data-level="46.3" data-path="linear-models-and-least-squared-estimates.html"><a href="linear-models-and-least-squared-estimates.html#the-lm-function"><i class="fa fa-check"></i><b>46.3</b> The <code>lm</code> function</a></li>
<li class="chapter" data-level="46.4" data-path="linear-models-and-least-squared-estimates.html"><a href="linear-models-and-least-squared-estimates.html#lse-are-random-variables"><i class="fa fa-check"></i><b>46.4</b> LSE are random variables</a></li>
<li class="chapter" data-level="46.5" data-path="linear-models-and-least-squared-estimates.html"><a href="linear-models-and-least-squared-estimates.html#lse-are-correlated-advanced"><i class="fa fa-check"></i><b>46.5</b> LSE are correlated (advanced)</a></li>
<li class="chapter" data-level="46.6" data-path="linear-models-and-least-squared-estimates.html"><a href="linear-models-and-least-squared-estimates.html#predicted-values-are-random-variables"><i class="fa fa-check"></i><b>46.6</b> Predicted values are random variables</a></li>
<li class="chapter" data-level="" data-path="linear-models-and-least-squared-estimates.html"><a href="linear-models-and-least-squared-estimates.html#exercises-36"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="47" data-path="advanced-tidyverse-tibbles-and-do.html"><a href="advanced-tidyverse-tibbles-and-do.html"><i class="fa fa-check"></i><b>47</b> Advanced tidyverse: tibbles and <code>do</code></a><ul>
<li class="chapter" data-level="47.1" data-path="advanced-tidyverse-tibbles-and-do.html"><a href="advanced-tidyverse-tibbles-and-do.html#tibbles"><i class="fa fa-check"></i><b>47.1</b> Tibbles</a><ul>
<li class="chapter" data-level="47.1.1" data-path="advanced-tidyverse-tibbles-and-do.html"><a href="advanced-tidyverse-tibbles-and-do.html#tibbles-display-better"><i class="fa fa-check"></i><b>47.1.1</b> Tibbles display better</a></li>
<li class="chapter" data-level="47.1.2" data-path="advanced-tidyverse-tibbles-and-do.html"><a href="advanced-tidyverse-tibbles-and-do.html#subsets-of-tibbles-are-tibbles"><i class="fa fa-check"></i><b>47.1.2</b> Subsets of tibbles are tibbles</a></li>
<li class="chapter" data-level="47.1.3" data-path="advanced-tidyverse-tibbles-and-do.html"><a href="advanced-tidyverse-tibbles-and-do.html#tibbles-can-have-complex-entries"><i class="fa fa-check"></i><b>47.1.3</b> Tibbles can have complex entries</a></li>
<li class="chapter" data-level="47.1.4" data-path="advanced-tidyverse-tibbles-and-do.html"><a href="advanced-tidyverse-tibbles-and-do.html#tibbles-can-be-grouped"><i class="fa fa-check"></i><b>47.1.4</b> Tibbles can be grouped</a></li>
</ul></li>
<li class="chapter" data-level="47.2" data-path="advanced-tidyverse-tibbles-and-do.html"><a href="advanced-tidyverse-tibbles-and-do.html#do"><i class="fa fa-check"></i><b>47.2</b> <code>do</code></a></li>
</ul></li>
<li class="chapter" data-level="48" data-path="the-broom-package.html"><a href="the-broom-package.html"><i class="fa fa-check"></i><b>48</b> The broom package</a><ul>
<li class="chapter" data-level="" data-path="the-broom-package.html"><a href="the-broom-package.html#exercises-37"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="49" data-path="case-study-money-ball-continued.html"><a href="case-study-money-ball-continued.html"><i class="fa fa-check"></i><b>49</b> Case study: Money Ball continued</a><ul>
<li class="chapter" data-level="49.1" data-path="case-study-money-ball-continued.html"><a href="case-study-money-ball-continued.html#adding-salary-and-position-information"><i class="fa fa-check"></i><b>49.1</b> Adding salary and position information</a></li>
<li class="chapter" data-level="49.2" data-path="case-study-money-ball-continued.html"><a href="case-study-money-ball-continued.html#picking-9-players"><i class="fa fa-check"></i><b>49.2</b> Picking 9 players</a></li>
<li class="chapter" data-level="" data-path="case-study-money-ball-continued.html"><a href="case-study-money-ball-continued.html#exercises-38"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="50" data-path="regression-fallacy.html"><a href="regression-fallacy.html"><i class="fa fa-check"></i><b>50</b> Regression fallacy</a></li>
<li class="chapter" data-level="51" data-path="measurement-error-models.html"><a href="measurement-error-models.html"><i class="fa fa-check"></i><b>51</b> Measurement error models</a></li>
<li class="chapter" data-level="52" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html"><i class="fa fa-check"></i><b>52</b> Association is not causation</a><ul>
<li class="chapter" data-level="52.1" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#spurious-correlation"><i class="fa fa-check"></i><b>52.1</b> Spurious correlation</a></li>
<li class="chapter" data-level="52.2" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#outliers-1"><i class="fa fa-check"></i><b>52.2</b> Outliers</a></li>
<li class="chapter" data-level="52.3" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#reversing-cause-and-effect"><i class="fa fa-check"></i><b>52.3</b> Reversing cause and effect</a></li>
<li class="chapter" data-level="52.4" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#confounders"><i class="fa fa-check"></i><b>52.4</b> Confounders</a><ul>
<li class="chapter" data-level="52.4.1" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#example-uc-berkeley-admissions"><i class="fa fa-check"></i><b>52.4.1</b> Example: UC Berkeley admissions</a></li>
<li class="chapter" data-level="52.4.2" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#confounding-explained-graphically"><i class="fa fa-check"></i><b>52.4.2</b> Confounding explained graphically</a></li>
<li class="chapter" data-level="52.4.3" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#average-after-stratifying"><i class="fa fa-check"></i><b>52.4.3</b> Average after stratifying</a></li>
</ul></li>
<li class="chapter" data-level="52.5" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#simpsons-paradox"><i class="fa fa-check"></i><b>52.5</b> Simpson’s Paradox</a></li>
<li class="chapter" data-level="" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#exercises-39"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="part"><span><b>VII Machine Learning</b></span></li>
<li class="chapter" data-level="53" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html"><i class="fa fa-check"></i><b>53</b> Introduction to Machine Learning</a><ul>
<li class="chapter" data-level="53.1" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#notation-1"><i class="fa fa-check"></i><b>53.1</b> Notation</a></li>
<li class="chapter" data-level="53.2" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#categorical-versus-continuous"><i class="fa fa-check"></i><b>53.2</b> Categorical versus continuous</a></li>
<li class="chapter" data-level="53.3" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#an-example"><i class="fa fa-check"></i><b>53.3</b> An example</a></li>
<li class="chapter" data-level="" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#exercises-40"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="54" data-path="the-confusion-matrix-prevalence-sensitivity-and-specificity.html"><a href="the-confusion-matrix-prevalence-sensitivity-and-specificity.html"><i class="fa fa-check"></i><b>54</b> The confusion matrix, prevalence, sensitivity and specificity</a><ul>
<li class="chapter" data-level="54.1" data-path="the-confusion-matrix-prevalence-sensitivity-and-specificity.html"><a href="the-confusion-matrix-prevalence-sensitivity-and-specificity.html#training-and-test-sets"><i class="fa fa-check"></i><b>54.1</b> Training and test sets</a></li>
<li class="chapter" data-level="54.2" data-path="the-confusion-matrix-prevalence-sensitivity-and-specificity.html"><a href="the-confusion-matrix-prevalence-sensitivity-and-specificity.html#overall-accuracy"><i class="fa fa-check"></i><b>54.2</b> Overall accuracy</a></li>
<li class="chapter" data-level="54.3" data-path="the-confusion-matrix-prevalence-sensitivity-and-specificity.html"><a href="the-confusion-matrix-prevalence-sensitivity-and-specificity.html#the-confusion-matrix"><i class="fa fa-check"></i><b>54.3</b> The confusion matrix</a></li>
<li class="chapter" data-level="54.4" data-path="the-confusion-matrix-prevalence-sensitivity-and-specificity.html"><a href="the-confusion-matrix-prevalence-sensitivity-and-specificity.html#sensitivity-and-specificity"><i class="fa fa-check"></i><b>54.4</b> Sensitivity and specificity</a></li>
<li class="chapter" data-level="54.5" data-path="the-confusion-matrix-prevalence-sensitivity-and-specificity.html"><a href="the-confusion-matrix-prevalence-sensitivity-and-specificity.html#balanced-accuracy-and-f_1-score"><i class="fa fa-check"></i><b>54.5</b> Balanced accuracy and <span class="math inline">\(F_1\)</span> score</a></li>
<li class="chapter" data-level="54.6" data-path="the-confusion-matrix-prevalence-sensitivity-and-specificity.html"><a href="the-confusion-matrix-prevalence-sensitivity-and-specificity.html#prevalence-matters-in-practice"><i class="fa fa-check"></i><b>54.6</b> Prevalence matters in practice</a></li>
<li class="chapter" data-level="54.7" data-path="the-confusion-matrix-prevalence-sensitivity-and-specificity.html"><a href="the-confusion-matrix-prevalence-sensitivity-and-specificity.html#roc-and-precision-recall-curves"><i class="fa fa-check"></i><b>54.7</b> ROC and precision-recall curves</a></li>
<li class="chapter" data-level="" data-path="the-confusion-matrix-prevalence-sensitivity-and-specificity.html"><a href="the-confusion-matrix-prevalence-sensitivity-and-specificity.html#exercises-41"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="55" data-path="conditional-probabilities-and-expectations.html"><a href="conditional-probabilities-and-expectations.html"><i class="fa fa-check"></i><b>55</b> Conditional probabilities and expectations</a><ul>
<li class="chapter" data-level="55.1" data-path="conditional-probabilities-and-expectations.html"><a href="conditional-probabilities-and-expectations.html#conditional-probabilities-1"><i class="fa fa-check"></i><b>55.1</b> Conditional probabilities</a></li>
<li class="chapter" data-level="55.2" data-path="conditional-probabilities-and-expectations.html"><a href="conditional-probabilities-and-expectations.html#conditional-expectations"><i class="fa fa-check"></i><b>55.2</b> Conditional expectations</a></li>
<li class="chapter" data-level="55.3" data-path="conditional-probabilities-and-expectations.html"><a href="conditional-probabilities-and-expectations.html#the-loss-function"><i class="fa fa-check"></i><b>55.3</b> The loss function</a></li>
<li class="chapter" data-level="55.4" data-path="conditional-probabilities-and-expectations.html"><a href="conditional-probabilities-and-expectations.html#conditional-expectation-minimizes-squared-loss-function"><i class="fa fa-check"></i><b>55.4</b> Conditional expectation minimizes squared loss function</a></li>
<li class="chapter" data-level="" data-path="conditional-probabilities-and-expectations.html"><a href="conditional-probabilities-and-expectations.html#exercises-42"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="56" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>56</b> Logistic Regression</a><ul>
<li class="chapter" data-level="56.1" data-path="logistic-regression.html"><a href="logistic-regression.html#linear-regression-for-prediction"><i class="fa fa-check"></i><b>56.1</b> Linear regression for prediction</a></li>
<li class="chapter" data-level="56.2" data-path="logistic-regression.html"><a href="logistic-regression.html#the-predict-function"><i class="fa fa-check"></i><b>56.2</b> The <code>predict</code> function</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#exercises-43"><i class="fa fa-check"></i>Exercises</a></li>
<li class="chapter" data-level="56.3" data-path="logistic-regression.html"><a href="logistic-regression.html#logistic-regression-1"><i class="fa fa-check"></i><b>56.3</b> Logistic regression</a></li>
<li class="chapter" data-level="56.4" data-path="logistic-regression.html"><a href="logistic-regression.html#generalized-linear-models"><i class="fa fa-check"></i><b>56.4</b> Generalized Linear Models</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#exercises-44"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="57" data-path="case-study-is-it-a-2-or-a-7.html"><a href="case-study-is-it-a-2-or-a-7.html"><i class="fa fa-check"></i><b>57</b> Case study: is it a 2 or a 7?</a></li>
<li class="chapter" data-level="58" data-path="smoothing.html"><a href="smoothing.html"><i class="fa fa-check"></i><b>58</b> Smoothing</a><ul>
<li class="chapter" data-level="58.1" data-path="smoothing.html"><a href="smoothing.html#bin-smoothing"><i class="fa fa-check"></i><b>58.1</b> Bin smoothing</a></li>
<li class="chapter" data-level="58.2" data-path="smoothing.html"><a href="smoothing.html#kernels"><i class="fa fa-check"></i><b>58.2</b> Kernels</a></li>
<li class="chapter" data-level="58.3" data-path="smoothing.html"><a href="smoothing.html#local-weighted-regression-loess"><i class="fa fa-check"></i><b>58.3</b> Local weighted regression (loess)</a></li>
<li class="chapter" data-level="58.4" data-path="smoothing.html"><a href="smoothing.html#fitting-parabolas"><i class="fa fa-check"></i><b>58.4</b> Fitting parabolas</a></li>
<li class="chapter" data-level="58.5" data-path="smoothing.html"><a href="smoothing.html#beware-of-ggplot-defaults"><i class="fa fa-check"></i><b>58.5</b> Beware of <code>ggplot</code> defaults</a></li>
<li class="chapter" data-level="" data-path="smoothing.html"><a href="smoothing.html#exercises-45"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="59" data-path="matrices-1.html"><a href="matrices-1.html"><i class="fa fa-check"></i><b>59</b> Matrices</a><ul>
<li class="chapter" data-level="59.1" data-path="matrices-1.html"><a href="matrices-1.html#notation-2"><i class="fa fa-check"></i><b>59.1</b> Notation</a></li>
<li class="chapter" data-level="59.2" data-path="matrices-1.html"><a href="matrices-1.html#matrix-operations"><i class="fa fa-check"></i><b>59.2</b> Matrix operations</a><ul>
<li class="chapter" data-level="59.2.1" data-path="matrices-1.html"><a href="matrices-1.html#converting-a-vector-to-a-matrix"><i class="fa fa-check"></i><b>59.2.1</b> Converting a vector to a matrix</a></li>
<li class="chapter" data-level="59.2.2" data-path="matrices-1.html"><a href="matrices-1.html#row-and-column-summaries"><i class="fa fa-check"></i><b>59.2.2</b> Row and column summaries</a></li>
<li class="chapter" data-level="59.2.3" data-path="matrices-1.html"><a href="matrices-1.html#apply"><i class="fa fa-check"></i><b>59.2.3</b> <code>apply</code></a></li>
<li class="chapter" data-level="59.2.4" data-path="matrices-1.html"><a href="matrices-1.html#filtering-columns-based-on-summaries"><i class="fa fa-check"></i><b>59.2.4</b> Filtering columns based on summaries</a></li>
<li class="chapter" data-level="59.2.5" data-path="matrices-1.html"><a href="matrices-1.html#indexing-with-matrices"><i class="fa fa-check"></i><b>59.2.5</b> Indexing with matrices</a></li>
<li class="chapter" data-level="59.2.6" data-path="matrices-1.html"><a href="matrices-1.html#binarizing-the-data"><i class="fa fa-check"></i><b>59.2.6</b> Binarizing the data</a></li>
<li class="chapter" data-level="59.2.7" data-path="matrices-1.html"><a href="matrices-1.html#vectorization-for-matrices"><i class="fa fa-check"></i><b>59.2.7</b> Vectorization for matrices</a></li>
</ul></li>
<li class="chapter" data-level="59.3" data-path="matrices-1.html"><a href="matrices-1.html#matrix-algebra-operations"><i class="fa fa-check"></i><b>59.3</b> Matrix algebra operations</a></li>
<li class="chapter" data-level="" data-path="matrices-1.html"><a href="matrices-1.html#exercises-46"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="60" data-path="distance.html"><a href="distance.html"><i class="fa fa-check"></i><b>60</b> Distance</a><ul>
<li class="chapter" data-level="60.1" data-path="distance.html"><a href="distance.html#euclidean-distance"><i class="fa fa-check"></i><b>60.1</b> Euclidean distance</a></li>
<li class="chapter" data-level="60.2" data-path="distance.html"><a href="distance.html#distance-in-higher-dimensions"><i class="fa fa-check"></i><b>60.2</b> Distance in higher dimensions</a></li>
<li class="chapter" data-level="60.3" data-path="distance.html"><a href="distance.html#example"><i class="fa fa-check"></i><b>60.3</b> Example</a></li>
<li class="chapter" data-level="60.4" data-path="distance.html"><a href="distance.html#distance-between-predictors"><i class="fa fa-check"></i><b>60.4</b> Distance between predictors</a></li>
<li class="chapter" data-level="" data-path="distance.html"><a href="distance.html#exercises-47"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="61" data-path="nearest-neighbors.html"><a href="nearest-neighbors.html"><i class="fa fa-check"></i><b>61</b> Nearest neighbors</a><ul>
<li class="chapter" data-level="61.1" data-path="nearest-neighbors.html"><a href="nearest-neighbors.html#over-training"><i class="fa fa-check"></i><b>61.1</b> Over training</a></li>
<li class="chapter" data-level="61.2" data-path="nearest-neighbors.html"><a href="nearest-neighbors.html#over-smoothing"><i class="fa fa-check"></i><b>61.2</b> Over-smoothing</a></li>
<li class="chapter" data-level="61.3" data-path="nearest-neighbors.html"><a href="nearest-neighbors.html#picking-the-k-in-knn"><i class="fa fa-check"></i><b>61.3</b> Picking the <span class="math inline">\(k\)</span> in kNN</a></li>
<li class="chapter" data-level="" data-path="nearest-neighbors.html"><a href="nearest-neighbors.html#exercises-48"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="62" data-path="the-caret-package.html"><a href="the-caret-package.html"><i class="fa fa-check"></i><b>62</b> The caret package</a><ul>
<li class="chapter" data-level="62.1" data-path="the-caret-package.html"><a href="the-caret-package.html#the-train-functon"><i class="fa fa-check"></i><b>62.1</b> The <code>train</code> functon</a></li>
<li class="chapter" data-level="62.2" data-path="the-caret-package.html"><a href="the-caret-package.html#cross-validation"><i class="fa fa-check"></i><b>62.2</b> Cross validation</a></li>
<li class="chapter" data-level="62.3" data-path="the-caret-package.html"><a href="the-caret-package.html#example-fitting-with-loess"><i class="fa fa-check"></i><b>62.3</b> Example: fitting with loess</a></li>
</ul></li>
<li class="chapter" data-level="63" data-path="cross-validation-1.html"><a href="cross-validation-1.html"><i class="fa fa-check"></i><b>63</b> Cross validation</a><ul>
<li class="chapter" data-level="63.1" data-path="cross-validation-1.html"><a href="cross-validation-1.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>63.1</b> K-fold cross validation</a></li>
<li class="chapter" data-level="" data-path="cross-validation-1.html"><a href="cross-validation-1.html#exercises-49"><i class="fa fa-check"></i>Exercises</a></li>
<li class="chapter" data-level="63.2" data-path="cross-validation-1.html"><a href="cross-validation-1.html#bootstrap"><i class="fa fa-check"></i><b>63.2</b> Bootstrap</a></li>
<li class="chapter" data-level="" data-path="cross-validation-1.html"><a href="cross-validation-1.html#exercises-50"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="64" data-path="generative-models.html"><a href="generative-models.html"><i class="fa fa-check"></i><b>64</b> Generative models</a><ul>
<li class="chapter" data-level="64.1" data-path="generative-models.html"><a href="generative-models.html#naive-bayes"><i class="fa fa-check"></i><b>64.1</b> Naive Bayes</a></li>
<li class="chapter" data-level="64.2" data-path="generative-models.html"><a href="generative-models.html#controlling-prevalence"><i class="fa fa-check"></i><b>64.2</b> Controlling prevalence</a></li>
<li class="chapter" data-level="64.3" data-path="generative-models.html"><a href="generative-models.html#quadratic-discriminant-analysis"><i class="fa fa-check"></i><b>64.3</b> Quadratic Discriminant Analysis</a></li>
<li class="chapter" data-level="64.4" data-path="generative-models.html"><a href="generative-models.html#linear-discriminant-analysis"><i class="fa fa-check"></i><b>64.4</b> Linear discriminant analysis</a></li>
<li class="chapter" data-level="64.5" data-path="generative-models.html"><a href="generative-models.html#connection-distance"><i class="fa fa-check"></i><b>64.5</b> Connection distance</a></li>
<li class="chapter" data-level="64.6" data-path="generative-models.html"><a href="generative-models.html#case-study-more-than-three-classes"><i class="fa fa-check"></i><b>64.6</b> Case study: more than three classes</a></li>
<li class="chapter" data-level="" data-path="generative-models.html"><a href="generative-models.html#exercises-51"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="65" data-path="trees-and-random-forests.html"><a href="trees-and-random-forests.html"><i class="fa fa-check"></i><b>65</b> Trees and Random Forests</a><ul>
<li class="chapter" data-level="65.1" data-path="trees-and-random-forests.html"><a href="trees-and-random-forests.html#the-curse-of-dimensionality"><i class="fa fa-check"></i><b>65.1</b> The curse of dimensionality</a></li>
<li class="chapter" data-level="65.2" data-path="trees-and-random-forests.html"><a href="trees-and-random-forests.html#classification-and-regression-trees-cart"><i class="fa fa-check"></i><b>65.2</b> Classification and Regression Trees (CART)</a></li>
<li class="chapter" data-level="65.3" data-path="trees-and-random-forests.html"><a href="trees-and-random-forests.html#regression-tree"><i class="fa fa-check"></i><b>65.3</b> Regression tree</a></li>
<li class="chapter" data-level="65.4" data-path="trees-and-random-forests.html"><a href="trees-and-random-forests.html#classification-decision-trees"><i class="fa fa-check"></i><b>65.4</b> Classification (decision) trees</a></li>
<li class="chapter" data-level="65.5" data-path="trees-and-random-forests.html"><a href="trees-and-random-forests.html#random-forests"><i class="fa fa-check"></i><b>65.5</b> Random Forests</a></li>
<li class="chapter" data-level="" data-path="trees-and-random-forests.html"><a href="trees-and-random-forests.html#exercises-52"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="66" data-path="case-study-mnist.html"><a href="case-study-mnist.html"><i class="fa fa-check"></i><b>66</b> Case study: MNIST</a><ul>
<li class="chapter" data-level="66.1" data-path="case-study-mnist.html"><a href="case-study-mnist.html#preprocessing"><i class="fa fa-check"></i><b>66.1</b> Preprocessing</a></li>
<li class="chapter" data-level="66.2" data-path="case-study-mnist.html"><a href="case-study-mnist.html#knn"><i class="fa fa-check"></i><b>66.2</b> kNN</a></li>
<li class="chapter" data-level="66.3" data-path="case-study-mnist.html"><a href="case-study-mnist.html#variable-importance"><i class="fa fa-check"></i><b>66.3</b> Variable importance</a></li>
<li class="chapter" data-level="66.4" data-path="case-study-mnist.html"><a href="case-study-mnist.html#visual-assessments"><i class="fa fa-check"></i><b>66.4</b> Visual assessments</a></li>
</ul></li>
<li class="chapter" data-level="67" data-path="ensembles.html"><a href="ensembles.html"><i class="fa fa-check"></i><b>67</b> Ensembles</a><ul>
<li class="chapter" data-level="" data-path="ensembles.html"><a href="ensembles.html#exercises-53"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="68" data-path="dimension-reduction.html"><a href="dimension-reduction.html"><i class="fa fa-check"></i><b>68</b> Dimension Reduction</a><ul>
<li class="chapter" data-level="68.1" data-path="dimension-reduction.html"><a href="dimension-reduction.html#preserving-distance"><i class="fa fa-check"></i><b>68.1</b> Preserving distance</a></li>
<li class="chapter" data-level="68.2" data-path="dimension-reduction.html"><a href="dimension-reduction.html#linear-transformations-advnced"><i class="fa fa-check"></i><b>68.2</b> Linear transformations (advnced)</a></li>
<li class="chapter" data-level="68.3" data-path="dimension-reduction.html"><a href="dimension-reduction.html#orthogogal-transformations-advaced"><i class="fa fa-check"></i><b>68.3</b> Orthogogal transformations (advaced)</a></li>
<li class="chapter" data-level="68.4" data-path="dimension-reduction.html"><a href="dimension-reduction.html#principal-component-analysis"><i class="fa fa-check"></i><b>68.4</b> Principal Component Analysis</a></li>
<li class="chapter" data-level="68.5" data-path="dimension-reduction.html"><a href="dimension-reduction.html#iris-example"><i class="fa fa-check"></i><b>68.5</b> Iris Example</a></li>
<li class="chapter" data-level="68.6" data-path="dimension-reduction.html"><a href="dimension-reduction.html#mnist"><i class="fa fa-check"></i><b>68.6</b> MNIST</a></li>
<li class="chapter" data-level="" data-path="dimension-reduction.html"><a href="dimension-reduction.html#exercises-54"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="69" data-path="recommendation-systems.html"><a href="recommendation-systems.html"><i class="fa fa-check"></i><b>69</b> Recommendation systems</a><ul>
<li class="chapter" data-level="69.1" data-path="recommendation-systems.html"><a href="recommendation-systems.html#movielens-data"><i class="fa fa-check"></i><b>69.1</b> Movielens data</a></li>
<li class="chapter" data-level="69.2" data-path="recommendation-systems.html"><a href="recommendation-systems.html#recommendation-systems-as-a-machine-learning-challenge"><i class="fa fa-check"></i><b>69.2</b> Recommendation systems as a machine learning challenge</a><ul>
<li class="chapter" data-level="69.2.1" data-path="recommendation-systems.html"><a href="recommendation-systems.html#loss-function"><i class="fa fa-check"></i><b>69.2.1</b> Loss function</a></li>
<li class="chapter" data-level="69.2.2" data-path="recommendation-systems.html"><a href="recommendation-systems.html#a-first-model"><i class="fa fa-check"></i><b>69.2.2</b> A first model</a></li>
</ul></li>
<li class="chapter" data-level="69.3" data-path="recommendation-systems.html"><a href="recommendation-systems.html#modeling-movie-effects"><i class="fa fa-check"></i><b>69.3</b> Modeling movie effects</a><ul>
<li class="chapter" data-level="69.3.1" data-path="recommendation-systems.html"><a href="recommendation-systems.html#user-effects"><i class="fa fa-check"></i><b>69.3.1</b> User effects</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="recommendation-systems.html"><a href="recommendation-systems.html#exercises-55"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="70" data-path="regularization.html"><a href="regularization.html"><i class="fa fa-check"></i><b>70</b> Regularization</a><ul>
<li class="chapter" data-level="70.1" data-path="regularization.html"><a href="regularization.html#motivation"><i class="fa fa-check"></i><b>70.1</b> Motivation</a></li>
<li class="chapter" data-level="70.2" data-path="regularization.html"><a href="regularization.html#penalized-least-squares"><i class="fa fa-check"></i><b>70.2</b> Penalized Least Squares</a></li>
<li class="chapter" data-level="70.3" data-path="regularization.html"><a href="regularization.html#choosing-the-penalty-terms"><i class="fa fa-check"></i><b>70.3</b> Choosing the penalty terms</a></li>
<li class="chapter" data-level="" data-path="regularization.html"><a href="regularization.html#exercises-56"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="71" data-path="matrix-factorization.html"><a href="matrix-factorization.html"><i class="fa fa-check"></i><b>71</b> Matrix factorization</a><ul>
<li class="chapter" data-level="71.1" data-path="matrix-factorization.html"><a href="matrix-factorization.html#factors-1"><i class="fa fa-check"></i><b>71.1</b> Factors</a></li>
<li class="chapter" data-level="71.2" data-path="matrix-factorization.html"><a href="matrix-factorization.html#connection-to-svd-and-pca"><i class="fa fa-check"></i><b>71.2</b> Connection to SVD and PCA</a></li>
<li class="chapter" data-level="" data-path="matrix-factorization.html"><a href="matrix-factorization.html#exercises-57"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="72" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>72</b> Clustering</a><ul>
<li class="chapter" data-level="72.1" data-path="clustering.html"><a href="clustering.html#hierarchical-clustering"><i class="fa fa-check"></i><b>72.1</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="72.2" data-path="clustering.html"><a href="clustering.html#k-means"><i class="fa fa-check"></i><b>72.2</b> k-means</a></li>
<li class="chapter" data-level="72.3" data-path="clustering.html"><a href="clustering.html#heatmaps"><i class="fa fa-check"></i><b>72.3</b> Heatmaps</a></li>
<li class="chapter" data-level="72.4" data-path="clustering.html"><a href="clustering.html#filtering-features"><i class="fa fa-check"></i><b>72.4</b> Filtering features</a></li>
<li class="chapter" data-level="" data-path="clustering.html"><a href="clustering.html#exercises-58"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="part"><span><b>VIII Productivity tools</b></span></li>
<li class="chapter" data-level="73" data-path="installing-r-rstudio-and-git.html"><a href="installing-r-rstudio-and-git.html"><i class="fa fa-check"></i><b>73</b> Installing R, RStudio and Git</a><ul>
<li class="chapter" data-level="73.1" data-path="installing-r-rstudio-and-git.html"><a href="installing-r-rstudio-and-git.html#installing-r-1"><i class="fa fa-check"></i><b>73.1</b> Installing R</a></li>
<li class="chapter" data-level="73.2" data-path="installing-r-rstudio-and-git.html"><a href="installing-r-rstudio-and-git.html#installing-rstudio-1"><i class="fa fa-check"></i><b>73.2</b> Installing RStudio</a></li>
<li class="chapter" data-level="73.3" data-path="installing-r-rstudio-and-git.html"><a href="installing-r-rstudio-and-git.html#installing-git"><i class="fa fa-check"></i><b>73.3</b> Installing Git</a><ul>
<li class="chapter" data-level="73.3.1" data-path="installing-r-rstudio-and-git.html"><a href="installing-r-rstudio-and-git.html#installing-git-and-git-bash-on-windows"><i class="fa fa-check"></i><b>73.3.1</b> Installing Git and Git Bash on Windows</a></li>
<li class="chapter" data-level="73.3.2" data-path="installing-r-rstudio-and-git.html"><a href="installing-r-rstudio-and-git.html#installing-git-on-the-mac"><i class="fa fa-check"></i><b>73.3.2</b> Installing Git on the Mac</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="74" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>74</b> GitHub</a><ul>
<li class="chapter" data-level="74.1" data-path="github.html"><a href="github.html#github-accounts"><i class="fa fa-check"></i><b>74.1</b> GitHub Accounts</a></li>
<li class="chapter" data-level="74.2" data-path="github.html"><a href="github.html#github-repositories"><i class="fa fa-check"></i><b>74.2</b> GitHub repositories</a></li>
</ul></li>
<li class="chapter" data-level="75" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>75</b> RStudio</a><ul>
<li class="chapter" data-level="75.1" data-path="rstudio.html"><a href="rstudio.html#the-panes"><i class="fa fa-check"></i><b>75.1</b> The panes</a></li>
<li class="chapter" data-level="75.2" data-path="rstudio.html"><a href="rstudio.html#key-bindings"><i class="fa fa-check"></i><b>75.2</b> Key bindings</a></li>
<li class="chapter" data-level="75.3" data-path="rstudio.html"><a href="rstudio.html#installing-r-packages"><i class="fa fa-check"></i><b>75.3</b> Installing R packages</a></li>
<li class="chapter" data-level="75.4" data-path="rstudio.html"><a href="rstudio.html#running-commands-while-editing-scripts"><i class="fa fa-check"></i><b>75.4</b> Running commands while editing scripts</a></li>
<li class="chapter" data-level="75.5" data-path="rstudio.html"><a href="rstudio.html#global-options"><i class="fa fa-check"></i><b>75.5</b> Global options</a></li>
<li class="chapter" data-level="75.6" data-path="rstudio.html"><a href="rstudio.html#keeping-organized-with-rstudio-projects"><i class="fa fa-check"></i><b>75.6</b> Keeping organized with RStudio projects</a></li>
<li class="chapter" data-level="75.7" data-path="rstudio.html"><a href="rstudio.html#using-git-and-github-in-rstudio"><i class="fa fa-check"></i><b>75.7</b> Using Git and GitHub in RStudio</a></li>
<li class="chapter" data-level="75.8" data-path="rstudio.html"><a href="rstudio.html#running-r-without-rstudio"><i class="fa fa-check"></i><b>75.8</b> Running R without RStudio</a></li>
</ul></li>
<li class="chapter" data-level="76" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html"><i class="fa fa-check"></i><b>76</b> Organizing with Unix</a><ul>
<li class="chapter" data-level="76.1" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#the-terminal"><i class="fa fa-check"></i><b>76.1</b> The terminal</a></li>
<li class="chapter" data-level="76.2" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#the-filesystem"><i class="fa fa-check"></i><b>76.2</b> The filesystem</a><ul>
<li class="chapter" data-level="76.2.1" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#directories-and-subdirectories"><i class="fa fa-check"></i><b>76.2.1</b> Directories and subdirectories</a></li>
<li class="chapter" data-level="76.2.2" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#the-home-directory"><i class="fa fa-check"></i><b>76.2.2</b> The home directory</a></li>
<li class="chapter" data-level="76.2.3" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#working-directory"><i class="fa fa-check"></i><b>76.2.3</b> Working directory</a></li>
<li class="chapter" data-level="76.2.4" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#paths"><i class="fa fa-check"></i><b>76.2.4</b> Paths</a></li>
</ul></li>
<li class="chapter" data-level="76.3" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#unix-commands"><i class="fa fa-check"></i><b>76.3</b> Unix commands</a><ul>
<li class="chapter" data-level="76.3.1" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#ls-listing-directory-content"><i class="fa fa-check"></i><b>76.3.1</b> <code>ls</code>: Listing directory content</a></li>
<li class="chapter" data-level="76.3.2" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#mkdir-and-rmdir-make-and-remove-a-directory"><i class="fa fa-check"></i><b>76.3.2</b> <code>mkdir</code> and <code>rmdir</code>: make and remove a directory</a></li>
<li class="chapter" data-level="76.3.3" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#cd-navigating-the-filesystem-by-changing-directories"><i class="fa fa-check"></i><b>76.3.3</b> <code>cd</code>: Navigating the filesystem by changing directories</a></li>
</ul></li>
<li class="chapter" data-level="76.4" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#some-examples"><i class="fa fa-check"></i><b>76.4</b> Some examples</a></li>
<li class="chapter" data-level="76.5" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#more-unix-commands"><i class="fa fa-check"></i><b>76.5</b> More Unix commands</a><ul>
<li class="chapter" data-level="76.5.1" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#mv-moving-files"><i class="fa fa-check"></i><b>76.5.1</b> <code>mv</code>: moving files</a></li>
<li class="chapter" data-level="76.5.2" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#cp-copying-files"><i class="fa fa-check"></i><b>76.5.2</b> <code>cp</code>: copying files</a></li>
<li class="chapter" data-level="76.5.3" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#rm-removing-files"><i class="fa fa-check"></i><b>76.5.3</b> <code>rm</code>: removing files</a></li>
<li class="chapter" data-level="76.5.4" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#less-looking-at-a-file"><i class="fa fa-check"></i><b>76.5.4</b> <code>less</code>: looking at a file</a></li>
</ul></li>
<li class="chapter" data-level="76.6" data-path="organizing-with-unix.html"><a href="organizing-with-unix.html#preparing-for-a-data-science-project"><i class="fa fa-check"></i><b>76.6</b> Preparing for a data science project</a></li>
</ul></li>
<li class="chapter" data-level="77" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>77</b> Git</a><ul>
<li class="chapter" data-level="77.1" data-path="git.html"><a href="git.html#why-use-git-and-github"><i class="fa fa-check"></i><b>77.1</b> Why use Git and GitHub?</a></li>
<li class="chapter" data-level="77.2" data-path="git.html"><a href="git.html#overview-of-git"><i class="fa fa-check"></i><b>77.2</b> Overview of Git</a><ul>
<li class="chapter" data-level="77.2.1" data-path="git.html"><a href="git.html#clone"><i class="fa fa-check"></i><b>77.2.1</b> Clone</a></li>
</ul></li>
<li class="chapter" data-level="77.3" data-path="git.html"><a href="git.html#initilazing-a-git-directory"><i class="fa fa-check"></i><b>77.3</b> Initilazing a Git directory</a></li>
</ul></li>
<li class="chapter" data-level="78" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html"><i class="fa fa-check"></i><b>78</b> Reproducible reports with R Markdown</a><ul>
<li class="chapter" data-level="78.1" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html#r-markdown"><i class="fa fa-check"></i><b>78.1</b> R Markdown</a><ul>
<li class="chapter" data-level="78.1.1" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html#the-header"><i class="fa fa-check"></i><b>78.1.1</b> The header</a></li>
<li class="chapter" data-level="78.1.2" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html#r-code-chunks"><i class="fa fa-check"></i><b>78.1.2</b> R code chunks</a></li>
<li class="chapter" data-level="78.1.3" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html#global-options-1"><i class="fa fa-check"></i><b>78.1.3</b> Global options</a></li>
</ul></li>
<li class="chapter" data-level="78.2" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html#knitr"><i class="fa fa-check"></i><b>78.2</b> knitR</a></li>
<li class="chapter" data-level="78.3" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html#more-on-r-markdown"><i class="fa fa-check"></i><b>78.3</b> More on R markdown</a></li>
</ul></li>
<li class="chapter" data-level="79" data-path="advanced-unix.html"><a href="advanced-unix.html"><i class="fa fa-check"></i><b>79</b> Advanced Unix</a><ul>
<li class="chapter" data-level="79.1" data-path="advanced-unix.html"><a href="advanced-unix.html#arguments"><i class="fa fa-check"></i><b>79.1</b> Arguments</a></li>
<li class="chapter" data-level="79.2" data-path="advanced-unix.html"><a href="advanced-unix.html#getting-help"><i class="fa fa-check"></i><b>79.2</b> Getting help</a></li>
<li class="chapter" data-level="79.3" data-path="advanced-unix.html"><a href="advanced-unix.html#pipes"><i class="fa fa-check"></i><b>79.3</b> Pipes</a></li>
<li class="chapter" data-level="79.4" data-path="advanced-unix.html"><a href="advanced-unix.html#wild-cards"><i class="fa fa-check"></i><b>79.4</b> Wild cards</a></li>
<li class="chapter" data-level="79.5" data-path="advanced-unix.html"><a href="advanced-unix.html#environment-variables"><i class="fa fa-check"></i><b>79.5</b> Environment variables</a></li>
<li class="chapter" data-level="79.6" data-path="advanced-unix.html"><a href="advanced-unix.html#shells"><i class="fa fa-check"></i><b>79.6</b> Shells</a></li>
<li class="chapter" data-level="79.7" data-path="advanced-unix.html"><a href="advanced-unix.html#executables"><i class="fa fa-check"></i><b>79.7</b> Executables</a></li>
<li class="chapter" data-level="79.8" data-path="advanced-unix.html"><a href="advanced-unix.html#permissions-and-file-types"><i class="fa fa-check"></i><b>79.8</b> Permissions and file types</a></li>
<li class="chapter" data-level="79.9" data-path="advanced-unix.html"><a href="advanced-unix.html#commands-you-should-learn"><i class="fa fa-check"></i><b>79.9</b> Commands you should learn</a></li>
<li class="chapter" data-level="79.10" data-path="advanced-unix.html"><a href="advanced-unix.html#file-manipulation-in-r"><i class="fa fa-check"></i><b>79.10</b> File manipulation in R</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="string-processing" class="section level1">
<h1><span class="header-section-number">Chapter 38</span> String Processing</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(rvest)</code></pre></div>
<p>One of the most common data wrangling challenges involves converting or extracting numeric data, contained in character strings, into the numeric representations required to make plots, summarize or fit models in R. Also common is processing unorganized text into meaningful variable names or categorical variables.</p>
<p>In the Web Scraping Section, we encountered an example related to creating the <code>murders</code> dataset we explored in the R chapter. After successfully extracting the raw data from a webpage into a table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;https://en.wikipedia.org/w/index.php?title=&quot;</span>,
              <span class="st">&quot;Gun_violence_in_the_United_States_by_state&amp;direction=prev&amp;oldid=810166167&quot;</span>)
murders_raw &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_table</span>() <span class="op">%&gt;%</span>
<span class="st">  </span>.[[<span class="dv">2</span>]] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;population&quot;</span>, <span class="st">&quot;total&quot;</span>, <span class="st">&quot;murder_rate&quot;</span>))
<span class="kw">head</span>(murders_raw)
<span class="co">#&gt;        state population total murder_rate</span>
<span class="co">#&gt; 1    Alabama  4,853,875   348         7.2</span>
<span class="co">#&gt; 2     Alaska    737,709    59         8.0</span>
<span class="co">#&gt; 3    Arizona  6,817,565   309         4.5</span>
<span class="co">#&gt; 4   Arkansas  2,977,853   181         6.1</span>
<span class="co">#&gt; 5 California 38,993,940 1,861         4.8</span>
<span class="co">#&gt; 6   Colorado  5,448,819   176         3.2</span></code></pre></div>
<p>We realized that two of the columns that we expected to contain numbers actually contained characters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(murders_raw<span class="op">$</span>population)
<span class="co">#&gt; [1] &quot;character&quot;</span>
<span class="kw">class</span>(murders_raw<span class="op">$</span>total)
<span class="co">#&gt; [1] &quot;character&quot;</span></code></pre></div>
<p>This is a very common occurrence when web scraping since webpages and other formal documents use commas in numbers to improve readability; for example <code>4,853,875</code> is easier to read than <code>4853875</code>. Because this is such a common task, there is already a function, <code>parse_number</code> that readily does the conversion. However, many of the string processing challenges a data scientist faces are unique and often unexpected. It is therefore quite ambitious to write a comprehensive section on this topic. Here we use case studies that help us demonstrate how string processing is a powerful tool necessary for many data wrangling challenges. Specifically, we show the original <em>raw</em> data used to create the data frames we have studied in this book and describe the string processing that was needed.</p>
<p>By going over these cases studies, we will cover some of the most common tasks in string processing including:</p>
<ul>
<li>removing unwanted characters from text</li>
<li>extracting numeric values from text</li>
<li>finding and replacing characters</li>
<li>extracting specific parts of strings</li>
<li>converting free form text to more uniform formats</li>
<li>splitting strings into multiple values</li>
</ul>
<div id="defining-strings-single-and-double-quotes-and-how-to-escape" class="section level2">
<h2><span class="header-section-number">38.1</span> Defining strings: single and double quotes and how to escape</h2>
<p>To define strings in R, we can use either double quotes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> &quot;Hello!&quot;</span></code></pre></div>
<p>or single quotes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> &#39;Hello!&#39;</span></code></pre></div>
<p>Make sure you choose the correct single quote since using the back quote will give you an error:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> `</span><span class="dt">Hello</span><span class="st">`</span></code></pre></div>
<p>Now, what happens if our string includes double quotes? For example, if we want to write 10 inches like this <code>10&quot;</code>? You can’t use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> &quot;10&quot;&quot;</span></code></pre></div>
<p>because this is just the string <code>10</code> followed by a double quote. If you type this into R, you get an error because you have an <em>unclosed</em> double quote. To avoid this, we can use the single quotes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> &#39;10&quot;&#39;</span></code></pre></div>
<p>In R, the function <code>cat</code> lets us see what the string actually looks like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(s)
<span class="co">#&gt; 10&quot;</span></code></pre></div>
<p>Now, what if we want our string to be 5 feet written like this <code>5'</code>? In this case, we can use the double quotes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> &quot;5&#39;&quot;</span>
<span class="kw">cat</span>(s)
<span class="co">#&gt; 5&#39;</span></code></pre></div>
<p>So we’ve learned how to write 5 feet and 10 inches separately, but what if we want to write them together to represent <em>5 feet and 10 inches</em> like this <code>5'10&quot;</code>? In this case, neither the single nor double quotes will work. This:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> &#39;5&#39;</span><span class="dv">10</span><span class="st">&quot;&#39;</span></code></pre></div>
<p>closes the string after 5 and this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> &quot;5&#39;10&quot;&quot;</span></code></pre></div>
<p>closes the string after 10. Keep in mind that if we type one of the above code snippets into R, it will get stuck waiting for you to close the open quote and you will have to escape with the <em>esc</em> button.</p>
<p>In this situation, we need to <em>escape</em> the function of the quotes. This is done with the backslash <code>\</code>. You can escape either character like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> &#39;5</span><span class="ch">\&#39;</span><span class="st">10&quot;&#39;</span>
<span class="kw">cat</span>(s)
<span class="co">#&gt; 5&#39;10&quot;</span></code></pre></div>
<p>or:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> &quot;5&#39;10</span><span class="ch">\&quot;</span><span class="st">&quot;</span>
<span class="kw">cat</span>(s)
<span class="co">#&gt; 5&#39;10&quot;</span></code></pre></div>
<p>Escaping character is something we often have to use when processing strings.</p>
</div>
<div id="the-stringr-package" class="section level2">
<h2><span class="header-section-number">38.2</span> The stringr package</h2>
<p>In general, string processing involves a string and a pattern. In R, we usually store strings in a character vector such as <code>murders$population</code>. Above, we scraped the web to obtain the <code>murders_raw</code> data. The first three strings in this vector defined by the population variable are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">murders_raw<span class="op">$</span>population[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]
<span class="co">#&gt; [1] &quot;4,853,875&quot; &quot;737,709&quot;   &quot;6,817,565&quot;</span></code></pre></div>
<p>The usual coercion does not work here:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(murders_raw<span class="op">$</span>population[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])
<span class="co">#&gt; Warning: NAs introduced by coercion</span>
<span class="co">#&gt; [1] NA NA NA</span></code></pre></div>
<p>This is because of the commas <code>,</code>. The string processing we want to do here is remove the <strong>pattern</strong> <code>,</code> from the <strong>strings</strong> in <code>murders_raw$population</code> and then coerce to numbers.</p>
<p>In general, string processing tasks can be divided into <strong>detecting</strong>, <strong>locating</strong>, <strong>extracting</strong> or <strong>replacing</strong> patterns in strings. In our example, we need to <strong>locate</strong> the <code>,</code> and <strong>replace</strong> them with the empty characters <code>&quot;&quot;</code>.</p>
<p>Base R includes functions to perform all these tasks. However, they don’t follow a unifying convention which makes it a bit hard to memorize and use. The <strong>stringr</strong> package basically repackages this functionality, but uses a more consistent approach of naming functions and ordering their arguments. For example, in <strong>stringr</strong>, all the string processing functions start with <code>str_</code>. This means that if you type <code>str_</code> and hit tab, R will auto-complete and show all the available functions. As a result, we don’t necessarily have to memorize all the function names. Another advantage is that the string is always the first argument, which means we can more easily use the pipe. We therefore will be focusing on the <strong>stringr</strong> package. However, because the R-base equivalents are so widely used, below we include a table describing the <strong>stringr</strong> functions and include R-base equivalent when available.</p>
<div id="the-str_-functions" class="section level3">
<h3><span class="header-section-number">38.2.1</span> The <code>str_</code> functions</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)</code></pre></div>
<p>The table below includes the functions available to you in the <strong>stringr</strong> package. We split them by task. We also include the R-base equivalent when available.</p>
<p>All these functions take a character vector as first argument. Also, for each function, operations are vectorized: the operation gets applied to each string in the vector.</p>
<p>Finally, note that in this table we mention <em>groups</em>. These will be explained later.</p>
<table>
<colgroup>
<col width="13%" />
<col width="55%" />
<col width="20%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th>Task</th>
<th>Description</th>
<th><code>stringr</code></th>
<th>R-base</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Detect</td>
<td>Is the pattern in the string?</td>
<td><code>str_detect</code></td>
<td><code>grepl</code></td>
</tr>
<tr class="even">
<td>Detect</td>
<td>Returns the index of entries that contain the pattern.</td>
<td><code>str_which</code></td>
<td><code>grep</code></td>
</tr>
<tr class="odd">
<td>Detect</td>
<td>Returns the subset of strings that contain the pattern.</td>
<td><code>str_subset</code></td>
<td><code>grep</code> with <code>value = TRUE</code></td>
</tr>
<tr class="even">
<td>Locate</td>
<td>Returns positions of first occurrence of pattern in a string.</td>
<td><code>str_locate</code></td>
<td><code>regexpr</code></td>
</tr>
<tr class="odd">
<td>Locate</td>
<td>Returns position of all occurrences of pattern in a string.</td>
<td><code>str_locate_all</code></td>
<td><code>gregexpr</code></td>
</tr>
<tr class="even">
<td>Locate</td>
<td>Show the first part of the string that matches pattern.</td>
<td><code>str_view</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Locate</td>
<td>Show me all the parts of the string that match the pattern.</td>
<td><code>str_view_all</code></td>
<td></td>
</tr>
<tr class="even">
<td>Extract</td>
<td>Extract the first part of the string that matches the pattern.</td>
<td><code>str_extract</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Extract</td>
<td>Extract all parts of the string that match the pattern.</td>
<td><code>str_extract_all</code></td>
<td></td>
</tr>
<tr class="even">
<td>Extract</td>
<td>Extract first part of the string that matches the groups and the patterns defined by the groups.</td>
<td><code>str_match</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Extract</td>
<td>Extract all parts of the string that matches the groups and the patterns defined by the groups.</td>
<td><code>str_match_all</code></td>
<td></td>
</tr>
<tr class="even">
<td>Extract</td>
<td>Extract a substring.</td>
<td><code>str_sub</code></td>
<td><code>substring</code></td>
</tr>
<tr class="odd">
<td>Extract</td>
<td>Split a string into a list with parts separated by pattern.</td>
<td><code>str_split</code></td>
<td><code>strsplit</code></td>
</tr>
<tr class="even">
<td>Extract</td>
<td>Split a string into a matrix with parts separated by pattern.</td>
<td><code>str_split_fixed</code></td>
<td><code>strsplit</code> with <code>fixed = TRUE</code></td>
</tr>
<tr class="odd">
<td>Describe</td>
<td>Count number of times a pattern appears in a string</td>
<td><code>str_count</code></td>
<td></td>
</tr>
<tr class="even">
<td>Describe</td>
<td>Number of character in string.</td>
<td><code>str_length</code></td>
<td><code>nchar</code></td>
</tr>
<tr class="odd">
<td>Replace</td>
<td>Replace first part of a string matching a pattern with another.</td>
<td><code>str_replace</code></td>
<td></td>
</tr>
<tr class="even">
<td>Replace</td>
<td>Replace all parts of a string matching a pattern with another.</td>
<td><code>str_replace_all</code></td>
<td><code>gsub</code></td>
</tr>
<tr class="odd">
<td>Replace</td>
<td>Change all characters to upper case.</td>
<td><code>str_to_upper</code></td>
<td><code>toupper</code></td>
</tr>
<tr class="even">
<td>Replace</td>
<td>Change all characters to lower case.</td>
<td><code>str_to_lower</code></td>
<td><code>tolower</code></td>
</tr>
<tr class="odd">
<td>Replace</td>
<td>Change first character to upper and rest to lower.</td>
<td><code>str_to_title</code></td>
<td></td>
</tr>
<tr class="even">
<td>Replace</td>
<td>Replace all <code>NA</code>s to a new value.</td>
<td><code>str_replace_na</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Replace</td>
<td>Remove white space from start and end of string.</td>
<td><code>str_trim</code></td>
<td></td>
</tr>
<tr class="even">
<td>Manipulate</td>
<td>Join multiple strings.</td>
<td><code>str_c</code></td>
<td><code>paste0</code></td>
</tr>
<tr class="odd">
<td>Manipulate</td>
<td>Change the encoding of the string.</td>
<td><code>str_conv</code></td>
<td></td>
</tr>
<tr class="even">
<td>Manipulate</td>
<td>Sort the vector in alphabetical order.</td>
<td><code>str_sort</code></td>
<td><code>sort</code></td>
</tr>
<tr class="odd">
<td>Manipulate</td>
<td>Index needed to order the vector in alphabetical order.</td>
<td><code>str_order</code></td>
<td><code>order</code></td>
</tr>
<tr class="even">
<td>Manipulate</td>
<td>Truncate a string to a fixed size.</td>
<td><code>str_trunc</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Manipulate</td>
<td>Add white space to string to make it a fixed size.</td>
<td><code>str_pad</code></td>
<td></td>
</tr>
<tr class="even">
<td>Manipulate</td>
<td>Repeat a string.</td>
<td><code>str_dup</code></td>
<td><code>rep</code> then <code>paste</code></td>
</tr>
<tr class="odd">
<td>Manipulate</td>
<td>Wrap things into formatted paragraphs.</td>
<td><code>str_wrap</code></td>
<td></td>
</tr>
<tr class="even">
<td>Manipulate</td>
<td>String interpolation.</td>
<td><code>str_interp</code></td>
<td><code>sprintf</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="case-study-1-us-murders-data" class="section level2">
<h2><span class="header-section-number">38.3</span> Case study 1: US murders data</h2>
<p>Above we used used code to scrape the web and create the <code>murders_raw</code> table. We noted that three columns need to be parsed from characters into numbers, but that commas were making it hard. We can use the <code>str_detect</code> function to see that two of the three columns have commas in the entries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">commas &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">any</span>(<span class="kw">str_detect</span>(x, <span class="st">&quot;,&quot;</span>))
murders_raw <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(<span class="kw">funs</span>(commas))
<span class="co">#&gt;   state population total murder_rate</span>
<span class="co">#&gt; 1 FALSE       TRUE  TRUE       FALSE</span></code></pre></div>
<p>We can then use the <code>str_replace_all</code> function to remove them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(murders_raw<span class="op">$</span>population, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>)
test_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(test_<span class="dv">1</span>)</code></pre></div>
<p>We can then use <code>mutate_all</code> to apply this operation to each column, since it won’t affect the columns without commas.</p>
<p>It turns out that this operation is so common, that <code>readr</code> includes the function <code>parse_number</code> specifically meant to remove non-numeric characters before coercing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">parse_number</span>(murders_raw<span class="op">$</span>population)
<span class="kw">identical</span>(test_<span class="dv">1</span>, test_<span class="dv">2</span>)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>So we can obtain our desired table using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">murders_new &lt;-<span class="st"> </span>murders_raw <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>, parse_number)
murders_new <span class="op">%&gt;%</span><span class="st"> </span>head
<span class="co">#&gt;        state population total murder_rate</span>
<span class="co">#&gt; 1    Alabama    4853875   348         7.2</span>
<span class="co">#&gt; 2     Alaska     737709    59         8.0</span>
<span class="co">#&gt; 3    Arizona    6817565   309         4.5</span>
<span class="co">#&gt; 4   Arkansas    2977853   181         6.1</span>
<span class="co">#&gt; 5 California   38993940  1861         4.8</span>
<span class="co">#&gt; 6   Colorado    5448819   176         3.2</span></code></pre></div>
<p>This case is relatively simple compared to the string processing challenges that we typically face in data science. The next example is a rather complex one.</p>
</div>
<div id="case-study-2-reported-heights" class="section level2">
<h2><span class="header-section-number">38.4</span> Case study 2: Reported heights</h2>
<p>The <strong>dslabs</strong> package includes the raw data from which the heights dataset was obtained. You can load it like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dslabs)
<span class="kw">data</span>(reported_heights)</code></pre></div>
<p>These heights were obtained using a web form in which students were asked to enter their heights. They could enter anything, but the instructions asked for <em>height in inches</em>, a number. We compiled 1095 submissions, but unfortunately the column vector with the reported heights had several non-numeric entries and as a result became a character vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(reported_heights<span class="op">$</span>height)
<span class="co">#&gt; [1] &quot;character&quot;</span></code></pre></div>
<p>If we try to parse it into numbers, we get a warning:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(reported_heights<span class="op">$</span>height)
<span class="co">#&gt; Warning: NAs introduced by coercion</span></code></pre></div>
<p>Although most values appear to be height in inches as requested:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(x)
<span class="co">#&gt; [1] 75 70 68 74 61 65</span></code></pre></div>
<p>we do end up with many <code>NA</code>s:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">is.na</span>(x))
<span class="co">#&gt; [1] 81</span></code></pre></div>
<p>We can see some of the entries that are not successfully converted by <code>filter</code> to keep only the entries resulting in <code>NA</code>s:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">reported_heights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">new_height =</span> <span class="kw">as.numeric</span>(height)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(new_height)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">head</span>(<span class="dt">n=</span><span class="dv">10</span>)
<span class="co">#&gt;             time_stamp    sex                 height new_height</span>
<span class="co">#&gt; 1  2014-09-02 15:16:28   Male                  5&#39; 4&quot;         NA</span>
<span class="co">#&gt; 2  2014-09-02 15:16:37 Female                  165cm         NA</span>
<span class="co">#&gt; 3  2014-09-02 15:16:52   Male                    5&#39;7         NA</span>
<span class="co">#&gt; 4  2014-09-02 15:16:56   Male                  &gt;9000         NA</span>
<span class="co">#&gt; 5  2014-09-02 15:16:56   Male                   5&#39;7&quot;         NA</span>
<span class="co">#&gt; 6  2014-09-02 15:17:09 Female                   5&#39;3&quot;         NA</span>
<span class="co">#&gt; 7  2014-09-02 15:18:00   Male 5 feet and 8.11 inches         NA</span>
<span class="co">#&gt; 8  2014-09-02 15:19:48   Male                   5&#39;11         NA</span>
<span class="co">#&gt; 9  2014-09-04 00:46:45   Male                  5&#39;9&#39;&#39;         NA</span>
<span class="co">#&gt; 10 2014-09-04 10:29:44   Male                 5&#39;10&#39;&#39;         NA</span></code></pre></div>
<p>We immediately see what is happening. Some of the students did not report their heights in inches as requested. We could discard these data and continue. However, many of the entries follow patterns that, in principle, we can easily convert to inches. For example, in the output above, we see various cases that use the format <code>x'y''</code> with <code>x</code> and <code>y</code> representing feet and inches respectively. Each one of these cases can be read and converted to inches by a human, for example <code>5'4''</code> is <code>5*12 + 4 = 64</code>. So we could fix all the problematic entries <em>by hand</em>. However, humans are prone to making mistakes. Also, because we plan on continuing to collect data, it will be convenient to write code that automatically does this.</p>
<p>A first step in this type of task is to survey the problematic entries and try to define specific patterns followed by a large groups of entries. The larger these groups, the more entries we can fix with a single programmatic approach. We want to find patterns that can be accurately described with a rule, such as “a digit, followed by a feet symbol followed by one or two digits followed by an inches symbol”.</p>
<p>To look for such patterns, it helps to remove the entries that are consistent with being in inches and to view only the problematic entries. We thus write a function to automatically do this. We keep entries that either result in <code>NA</code>s when applying <code>as.numeric</code> or are outside a range of plausible heights. We permit a range that covers about 99.9999% of the adult population. We also use <code>suppressWarnings</code> to avoid the warning message we know <code>as.numeric</code> will gives us.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_inches &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">smallest =</span> <span class="dv">50</span>, <span class="dt">tallest =</span> <span class="dv">84</span>){
  inches &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">as.numeric</span>(x))
  ind &lt;-<span class="st"> </span><span class="kw">is.na</span>(inches) <span class="op">|</span><span class="st"> </span>inches <span class="op">&lt;</span><span class="st"> </span>smallest <span class="op">|</span><span class="st"> </span>inches <span class="op">&gt;</span><span class="st"> </span>tallest
  ind
}</code></pre></div>
<p>We apply this function and find that there are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">problems &lt;-<span class="st"> </span>reported_heights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">not_inches</span>(height)) <span class="op">%&gt;%</span>
<span class="st">  </span>.<span class="op">$</span>height
<span class="kw">length</span>(problems)
<span class="co">#&gt; [1] 292</span></code></pre></div>
<p>problematic entries!</p>
<p>We can now view all the cases by simply printing them. We don’t do that here because there are 297, but after surveying them carefully, we see that three patterns can be used to define three large groups within these exceptions.</p>
<ol style="list-style-type: decimal">
<li><p>A pattern of the form <code>x'y</code> or <code>x' y''</code> or <code>x'y\&quot;</code> with <code>x</code> and <code>y</code> representing feet and inches respectively. Here are ten examples:</p>
<pre><code>#&gt; 5&#39; 4&quot; 5&#39;7 5&#39;7&quot; 5&#39;3&quot; 5&#39;11 5&#39;9&#39;&#39; 5&#39;10&#39;&#39; 5&#39; 10 5&#39;5&quot; 5&#39;2&quot;</code></pre></li>
<li><p>A pattern of the form <code>x.y</code> or <code>x,y</code> with <code>x</code> feet and <code>y</code> inches. Here are ten examples:</p>
<pre><code>#&gt; 5.3 5.5 6.5 5.8 5.6 5,3 5.9 6,8 5.5 6.2</code></pre></li>
<li><p>Entries that were reported in centimeters rather than inches. Here are ten examples:</p>
<pre><code>#&gt; 150 175 177 178 163 175 178 165 165 180</code></pre></li>
</ol>
<p>Once we see these large groups following specific patterns, we can develop a plan of attack. Remember that there is rarely just one way to perform these tasks. Here we pick one that helps us teach several useful techniques. But surely there is a more efficient way of performing the task.</p>
<p>Plan of attack: we will convert entries fitting the first two patterns into a standardized one. We will then leverage the standardization to extract the feet and inches and convert to inches. We will then define a procedure for identifying entries that are in centimeters and convert them to inches. After applying these steps, we will then check again to see what entries were not fixed and see if we can tweak our approach to be more comprehensive.</p>
<p>At the end, we hope to have a script that makes web-based data collection methods robust to the most common user mistakes.</p>
<p>To achieve our goal, we will use a technique that enables us to accurately detect patterns and extract the parts we want: <em>regular expressions</em> (regex).</p>
</div>
<div id="regular-expressions" class="section level2">
<h2><span class="header-section-number">38.5</span> Regular expressions</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)</code></pre></div>
<p>A regular expression (regex) is way to describe specific patterns of characters of text. They can be used to determine if a given string matches the pattern. A set of rules has been defined to do this efficiently and precisely and here we show some examples. We can learn more about these rules by reading a detailed tutorial such as <a href="https://www.regular-expressions.info/tutorial.html">this one</a> or <a href="http://r4ds.had.co.nz/strings.html#matching-patterns-with-regular-expressions">this one</a>. This <a href="https://www.rstudio.com/wp-content/uploads/2016/09/RegExCheatsheet.pdf">cheat sheet</a> is also very useful.</p>
<p>The patterns supplied to the <strong>stringr</strong> functions can be a regex rather than a standard string. We will learn how this works through a series of examples.</p>
<div id="a-string" class="section level3">
<h3><span class="header-section-number">38.5.1</span> A string</h3>
<p>Technically any string is is a regex, perhaps the simplest example is a single character. So the comma <code>,</code> used here:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> &quot;,&quot;</span>
<span class="kw">str_detect</span>(murders_raw<span class="op">$</span>total, pattern) 
<span class="co">#&gt;  [1] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE FALSE</span>
<span class="co">#&gt; [12] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="co">#&gt; [23] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="co">#&gt; [34] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE</span>
<span class="co">#&gt; [45] FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></code></pre></div>
<p>is a simple example of searching with regex.</p>
<p>Above, we noted that an entry included a <code>cm</code>. This is also a simple example of a regex. We can show all the entries that used <code>cm</code> like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_subset</span>(reported_heights<span class="op">$</span>height, <span class="st">&quot;cm&quot;</span>)
<span class="co">#&gt; [1] &quot;165cm&quot;  &quot;170 cm&quot;</span></code></pre></div>
</div>
<div id="special-characters" class="section level3">
<h3><span class="header-section-number">38.5.2</span> Special characters</h3>
<p>Now let’s consider a slightly more complicated example. Which of the following strings:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;180 cm&quot;</span>, <span class="st">&quot;70 inches&quot;</span>)
no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;180&quot;</span>, <span class="st">&quot;70&#39;&#39;&quot;</span>)
s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)</code></pre></div>
<p>contain the pattern <code>cm</code> or <code>inches</code>? We could call <code>str_detect</code> twice:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_detect</span>(s, <span class="st">&quot;cm&quot;</span>) <span class="op">|</span><span class="st"> </span><span class="kw">str_detect</span>(s, <span class="st">&quot;inches&quot;</span>)
<span class="co">#&gt; [1]  TRUE  TRUE FALSE FALSE</span></code></pre></div>
<p>However, we don’t need to do this. The main feature that distinguishes the regex <em>language</em> from plain strings is that we can use special characters. These are characters with a meaning. We start by introducing <code>|</code> which means <em>or</em>. So if want to know if either <code>cm</code> or <code>inches</code> appears in the strings, we can use the regex <code>cm|inches</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_detect</span>(s, <span class="st">&quot;cm|inches&quot;</span>)
<span class="co">#&gt; [1]  TRUE  TRUE FALSE FALSE</span></code></pre></div>
<p>and obtain the correct answer.</p>
<p>Another special character that will be useful for identifying feet and inches values is <code>\d</code> which means any digit: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9. The backlash is used to distinguish it from the character <code>d</code>. In R, we have to <em>escape</em> the backslash <code>\</code> so we actually have to use <code>\\d</code> to represent digits. Here is an example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;5&#39;10&quot;</span>, <span class="st">&quot;5 feet&quot;</span>, <span class="st">&quot;4&#39;11&quot;</span>)
no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;Five&quot;</span>, <span class="st">&quot;six&quot;</span>)
s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)
pattern &lt;-<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">d&quot;</span>
<span class="kw">str_detect</span>(s, pattern)
<span class="co">#&gt; [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE</span></code></pre></div>
<p>We take this opportunity to introduce the <code>str_view</code> function, which is helpful for troubleshooting as it shows us the first match for each string:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(s, pattern)</code></pre></div>
<div id="htmlwidget-b32a10c19e2b0f1b612b" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-b32a10c19e2b0f1b612b">{"x":{"html":"<ul>\n  <li><span class='match'>5<\/span><\/li>\n  <li><span class='match'>6<\/span><\/li>\n  <li><span class='match'>5<\/span>'10<\/li>\n  <li><span class='match'>5<\/span> feet<\/li>\n  <li><span class='match'>4<\/span>'11<\/li>\n  <li><\/li>\n  <li>.<\/li>\n  <li>Five<\/li>\n  <li>six<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>and <code>str_view_all</code> shows us all the matches, so <code>3'2</code> has two matches and <code>5'10</code> has three.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view_all</span>(s, pattern)</code></pre></div>
<div id="htmlwidget-4c31412e7ac50786e15f" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-4c31412e7ac50786e15f">{"x":{"html":"<ul>\n  <li><span class='match'>5<\/span><\/li>\n  <li><span class='match'>6<\/span><\/li>\n  <li><span class='match'>5<\/span>'<span class='match'>1<\/span><span class='match'>0<\/span><\/li>\n  <li><span class='match'>5<\/span> feet<\/li>\n  <li><span class='match'>4<\/span>'<span class='match'>1<\/span><span class='match'>1<\/span><\/li>\n  <li><\/li>\n  <li>.<\/li>\n  <li>Five<\/li>\n  <li>six<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>There are many other special characters. We will learn some others below, but you can see most or all of them in the <a href="https://www.rstudio.com/wp-content/uploads/2016/09/RegExCheatsheet.pdf">cheat sheet</a> mentioned earlier.</p>
</div>
<div id="testing" class="section level3">
<h3><span class="header-section-number">38.5.3</span> Testing</h3>
<p>Throughout this section you will see that we create strings to test our regex. To do this, we define patterns that we know should match and also patterns that we know should not. We will call them <code>yes</code> and <code>no</code> respectively. This permits us to check for the two types of errors: failing to match and incorrectly matching.</p>
</div>
<div id="character-classes" class="section level3">
<h3><span class="header-section-number">38.5.4</span> Character classes</h3>
<p>Character classes are used to define a series of characters that can be matched. We define character classes with square brackets <code>[]</code>. So, for example, if we want the pattern to match only if we have a <code>5</code> or a <code>6</code>, we use the regex <code>[56]</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_view</span>(s, <span class="st">&quot;[56]&quot;</span>)</code></pre></div>
<div id="htmlwidget-0c23522721383921fb53" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-0c23522721383921fb53">{"x":{"html":"<ul>\n  <li><span class='match'>5<\/span><\/li>\n  <li><span class='match'>6<\/span><\/li>\n  <li><span class='match'>5<\/span>'10<\/li>\n  <li><span class='match'>5<\/span> feet<\/li>\n  <li>4'11<\/li>\n  <li><\/li>\n  <li>.<\/li>\n  <li>Five<\/li>\n  <li>six<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Suppose we want to match values between 4 and 7. A common way to define character classes is with ranges. So, for example, <code>[0-9]</code> is equivalent to <code>\\d</code>. The pattern we want is <code>[4-7]</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yes &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="dv">4</span><span class="op">:</span><span class="dv">7</span>)
no &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)
s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)
<span class="kw">str_detect</span>(s, <span class="st">&quot;[4-7]&quot;</span>)
<span class="co">#&gt; [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE</span></code></pre></div>
<p>However, it is important to know that in regex everything is a character; there are no numbers. So <code>4</code> is the character <code>4</code> not the number four. Notice, for example, that <code>[1-20]</code> does <strong>not</strong> mean 1 through 20, it means the characters 1 through 2 and the character 0. So <code>[1-20]</code> simply means the character class composed of 0, 1 and 2.</p>
<p>Keep in mind that characters do have an order and the digits do follow the numeric order. So 0 comes before 1 which comes before 2 and so on. For the same reason, we can define lowercase letters as <code>[a-z]</code>, uppercase letters as <code>[A-Z]</code>, and <code>[a-zA-z]</code> as both.</p>
</div>
<div id="anchors" class="section level3">
<h3><span class="header-section-number">38.5.5</span> Anchors</h3>
<p>What if we want a match when we have exactly 1 digit? This will be useful in our case study since feet are never more than 1 digit so a restriction will help us. One way to do this with regex is by using <em>anchors</em>, which let us define patterns that must start or end at a specific place. The two most common anchors are <code>^</code> and <code>$</code> which represent the beginning and end of a string respectively. So the pattern <code>^\\d$</code> is read as:</p>
<blockquote>
<blockquote>
<p>start of the string followed by one digit followed by end of string.</p>
</blockquote>
</blockquote>
<p>This pattern now only detects the strings with exactly one digit:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> &quot;^</span><span class="ch">\\</span><span class="st">d$&quot;</span>
yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;9&quot;</span>)
no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;12&quot;</span>, <span class="st">&quot;123&quot;</span>, <span class="st">&quot; 1&quot;</span>, <span class="st">&quot;a4&quot;</span>, <span class="st">&quot;b&quot;</span>)
s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)
<span class="kw">str_view</span>(s, pattern)</code></pre></div>
<div id="htmlwidget-81ae191e0cedac187e76" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-81ae191e0cedac187e76">{"x":{"html":"<ul>\n  <li><span class='match'>1<\/span><\/li>\n  <li><span class='match'>5<\/span><\/li>\n  <li><span class='match'>9<\/span><\/li>\n  <li>12<\/li>\n  <li>123<\/li>\n  <li> 1<\/li>\n  <li>a4<\/li>\n  <li>b<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>The <code>1</code> does not match because it does not start with the digit but rather with a space.</p>
</div>
<div id="quantifiers" class="section level3">
<h3><span class="header-section-number">38.5.6</span> Quantifiers</h3>
<p>For the inches part, we can have one or two digits. This can be specified in regex with <em>quantifiers</em>. This is done by following the pattern with curly brackets containing the number of times the previous entry can be repeated. We use an example to illustrate: the pattern for one or two digits is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> &quot;^</span><span class="ch">\\</span><span class="st">d{1,2}$&quot;</span>
yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;12&quot;</span>)
no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;123&quot;</span>, <span class="st">&quot;a4&quot;</span>, <span class="st">&quot;b&quot;</span>)
<span class="kw">str_view</span>(<span class="kw">c</span>(yes, no), pattern)</code></pre></div>
<div id="htmlwidget-60fd2dd011662431d7b8" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-60fd2dd011662431d7b8">{"x":{"html":"<ul>\n  <li><span class='match'>1<\/span><\/li>\n  <li><span class='match'>5<\/span><\/li>\n  <li><span class='match'>9<\/span><\/li>\n  <li><span class='match'>12<\/span><\/li>\n  <li>123<\/li>\n  <li>a4<\/li>\n  <li>b<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>In this case, <code>123</code> does <strong>not</strong> match, but <code>12</code> does. So to look for our feet and inches pattern, we can add the symbols for feet <code>'</code> and inches <code>&quot;</code> after the digits.</p>
<p>With what we have learned, we can now construct an example for the pattern <code>x'y\&quot;</code> with <code>x</code> feet and <code>y</code> inches.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> &quot;^[4-7]&#39;</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\&quot;</span><span class="st">$&quot;</span></code></pre></div>
<p>The pattern is now getting complex, but you can look at it carefully and break it down:</p>
<ul>
<li><code>^</code> = start of the string</li>
<li><code>[4-7]</code> = one digit, either 4,5,6 or 7</li>
<li><code>'</code> = feet symbol</li>
<li><code>\\d{1,2}</code> = one or two digits</li>
<li><code>\&quot;</code> = inches symbol</li>
<li><code>$</code> = end of the string</li>
</ul>
<p>Let’s test it out:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;7</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;6&#39;2</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,  <span class="st">&quot;5&#39;12</span><span class="ch">\&quot;</span><span class="st">&quot;</span>)
no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;6,2</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;6.2</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,<span class="st">&quot;I am 5&#39;11</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;3&#39;2</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;64&quot;</span>)
<span class="kw">str_detect</span>(yes, pattern)
<span class="co">#&gt; [1] TRUE TRUE TRUE</span>
<span class="kw">str_detect</span>(no, pattern)
<span class="co">#&gt; [1] FALSE FALSE FALSE FALSE FALSE</span></code></pre></div>
<p>For now, we are permitting the inches to be 12 or larger. We will add a restriction later as the regex for this is a bit more complex than we are ready to show.</p>
</div>
<div id="not" class="section level3">
<h3><span class="header-section-number">38.5.7</span> Not</h3>
<p>To specify patterns that we do <strong>not</strong> want to detect, we can use the <code>^</code> symbol but only <strong>inside</strong> square brackets. For example, if we want to detect digits that are preceeded by anything except a letter we can do the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> &quot;[^a-zA-Z]</span><span class="ch">\\</span><span class="st">d&quot;</span>
yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;.3&quot;</span>, <span class="st">&quot;+2&quot;</span>, <span class="st">&quot;-0&quot;</span>,<span class="st">&quot;*4&quot;</span>)
no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A3&quot;</span>, <span class="st">&quot;B2&quot;</span>, <span class="st">&quot;C0&quot;</span>, <span class="st">&quot;E4&quot;</span>)
<span class="kw">str_detect</span>(yes, pattern)
<span class="co">#&gt; [1] TRUE TRUE TRUE TRUE</span>
<span class="kw">str_detect</span>(no, pattern)
<span class="co">#&gt; [1] FALSE FALSE FALSE FALSE</span></code></pre></div>
<p>Another way to generate a pattern that searches for <em>everything except</em> is to use the upper case of the special character. For example <code>\\D</code> means anything other than a digit, <code>\\S</code> means anything except a space, and so on.</p>
</div>
<div id="search-and-replace-with-regex" class="section level3">
<h3><span class="header-section-number">38.5.8</span> Search and replace with regex</h3>
<p>Earlier we defined the object <code>problems</code> containing the strings that do not appear to be in inches. We can see that only:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> &quot;^[4-7]&#39;</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\&quot;</span><span class="st">$&quot;</span>
<span class="kw">sum</span>(<span class="kw">str_detect</span>(problems, pattern))
<span class="co">#&gt; [1] 14</span></code></pre></div>
<p>match the pattern we defined. To see why this is, we show some examples that expose why we don’t have more matches:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">problems[<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">15</span>)] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_view</span>(pattern)</code></pre></div>
<div id="htmlwidget-447e155af89faa4f67fe" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-447e155af89faa4f67fe">{"x":{"html":"<ul>\n  <li>5' 4\"<\/li>\n  <li><span class='match'>5'7\"<\/span><\/li>\n  <li><span class='match'>5'3\"<\/span><\/li>\n  <li>5 feet and 8.11 inches<\/li>\n  <li>5.5<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>An initial problem we see immediately is that some students wrote out the words “feet” and “inches”. We can see the entries that did this with the <code>str_subset</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_subset</span>(problems, <span class="st">&quot;inches&quot;</span>)
<span class="co">#&gt; [1] &quot;5 feet and 8.11 inches&quot; &quot;Five foot eight inches&quot;</span>
<span class="co">#&gt; [3] &quot;5 feet 7inches&quot;         &quot;5ft 9 inches&quot;          </span>
<span class="co">#&gt; [5] &quot;5 ft 9 inches&quot;          &quot;5 feet 6 inches&quot;</span></code></pre></div>
<p>We also see that some entries used two single quotes <code>''</code> instead of a double quote <code>&quot;&quot;</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_subset</span>(problems, <span class="st">&quot;&#39;&#39;&quot;</span>)
<span class="co">#&gt;  [1] &quot;5&#39;9&#39;&#39;&quot;   &quot;5&#39;10&#39;&#39;&quot;  &quot;5&#39;10&#39;&#39;&quot;  &quot;5&#39;3&#39;&#39;&quot;   &quot;5&#39;7&#39;&#39;&quot;   &quot;5&#39;6&#39;&#39;&quot;   &quot;5&#39;7.5&#39;&#39;&quot;</span>
<span class="co">#&gt;  [8] &quot;5&#39;7.5&#39;&#39;&quot; &quot;5&#39;10&#39;&#39;&quot;  &quot;5&#39;11&#39;&#39;&quot;  &quot;5&#39;10&#39;&#39;&quot;  &quot;5&#39;5&#39;&#39;&quot;</span></code></pre></div>
<p>To correct this, we can replace the different ways of representing inches and feet with a uniform symbol. We will use <code>'</code> for feet, whereas for inches we will simply not use a symbol since some entries were of the form <code>x'y</code>. Now, if we no longer use the inches symbol, we have to change our pattern accordingly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> &quot;^[4-7]&#39;</span><span class="ch">\\</span><span class="st">d{1,2}$&quot;</span></code></pre></div>
<p>If we do this replacement before the matching, we get many more matches:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">problems <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;feet|ft|foot&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># replace feet, ft, foot with &#39; </span>
<span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove all inches symbols</span>
<span class="st">  </span><span class="kw">str_detect</span>(pattern) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>sum
<span class="co">#&gt; [1] 48</span></code></pre></div>
<p>However, we still have many cases to go. Note that in the code above, we leveraged the <strong>stringr</strong> consistency and used the pipe.</p>
</div>
<div id="white-space-s" class="section level3">
<h3><span class="header-section-number">38.5.9</span> White space <code>\s</code></h3>
<p>Another problem we have are spaces. For example, our pattern does not match <code>5' 4&quot;</code> because there is a space between <code>'</code> and <code>4</code> which our pattern does not permit. Spaces are characters and R does not ignore them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(<span class="st">&quot;Hi&quot;</span>, <span class="st">&quot;Hi &quot;</span>)
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>In regex, <code>\s</code> represents white space. To find patterns like <code>5' 4</code>, we can change our pattern to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern_<span class="dv">2</span> &lt;-<span class="st"> &quot;^[4-7]&#39;</span><span class="ch">\\</span><span class="st">s</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\&quot;</span><span class="st">$&quot;</span>
<span class="kw">str_subset</span>(problems, pattern_<span class="dv">2</span>)
<span class="co">#&gt; [1] &quot;5&#39; 4\&quot;&quot;  &quot;5&#39; 11\&quot;&quot; &quot;5&#39; 7\&quot;&quot;</span></code></pre></div>
<p>So do we need more than one regex pattern? It turns out we can use a quantifier for this as well.</p>
</div>
<div id="quantifiers-1" class="section level3">
<h3><span class="header-section-number">38.5.10</span> Quantifiers: <code>*</code>, <code>?</code>, <code>+</code></h3>
<p>We want the pattern to permit spaces but not require them. Even if there are several spaces, like this <code>5'   4</code>, we still want it to match. There is a quantifier for exactly this purpose. In regex, the character <code>*</code> means zero or more instances of the previous character. Here is an example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;AB&quot;</span>, <span class="st">&quot;A1B&quot;</span>, <span class="st">&quot;A11B&quot;</span>, <span class="st">&quot;A111B&quot;</span>, <span class="st">&quot;A1111B&quot;</span>)
no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A2B&quot;</span>, <span class="st">&quot;A21B&quot;</span>)
<span class="kw">str_detect</span>(yes, <span class="st">&quot;A1*B&quot;</span>)
<span class="co">#&gt; [1] TRUE TRUE TRUE TRUE TRUE</span>
<span class="kw">str_detect</span>(no, <span class="st">&quot;A1*B&quot;</span>)
<span class="co">#&gt; [1] FALSE FALSE</span></code></pre></div>
<p>The above matches the first string which has zero 1s and all the strings with one or more 1. We can then improve our pattern by adding the <code>*</code> after the space character <code>\s</code>.</p>
<p>There are two other similar quantifiers. For none or once, we can use <code>?</code> and, for one or more, we can use <code>+</code>. You can see how they differ:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data.frame</span>(<span class="dt">string =</span> <span class="kw">c</span>(<span class="st">&quot;AB&quot;</span>, <span class="st">&quot;A1B&quot;</span>, <span class="st">&quot;A11B&quot;</span>, <span class="st">&quot;A111B&quot;</span>, <span class="st">&quot;A1111B&quot;</span>),
           <span class="dt">none_or_more =</span> <span class="kw">str_detect</span>(yes, <span class="st">&quot;A1*B&quot;</span>),
           <span class="dt">nore_or_once =</span> <span class="kw">str_detect</span>(yes, <span class="st">&quot;A1?B&quot;</span>),
           <span class="dt">once_or_more =</span> <span class="kw">str_detect</span>(yes, <span class="st">&quot;A1+B&quot;</span>))
<span class="co">#&gt;   string none_or_more nore_or_once once_or_more</span>
<span class="co">#&gt; 1     AB         TRUE         TRUE        FALSE</span>
<span class="co">#&gt; 2    A1B         TRUE         TRUE         TRUE</span>
<span class="co">#&gt; 3   A11B         TRUE        FALSE         TRUE</span>
<span class="co">#&gt; 4  A111B         TRUE        FALSE         TRUE</span>
<span class="co">#&gt; 5 A1111B         TRUE        FALSE         TRUE</span></code></pre></div>
<p>We will actually use all three in our reported heights example, and we will see these in a later section.</p>
<p>To improve our pattern, we can add <code>\\s*</code> in front of and after the feet symbol <code>'</code> to permit space between the feet symbol and the numbers. Now we match a few more entries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> &quot;^[4-7]</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">d{1,2}$&quot;</span>
problems <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;feet|ft|foot&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># replace feet, ft, foot with &#39; </span>
<span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove all inches symbols</span>
<span class="st">  </span><span class="kw">str_detect</span>(pattern) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>sum
<span class="co">#&gt; [1] 53</span></code></pre></div>
<p>We might be tempted to avoid doing this by removing all the spaces with <code>str_replace_all</code>. However, when doing such an operation we need to make sure that it does not have unintended effects. In our reported heights examples, this will be a problem because some entries are of the form <code>x y</code> with space separating the feet from the inches. If we remove all spaces, we will incorrectly turn <code>x y</code> into <code>xy</code> which implies that a <code>6 1</code> would become <code>61</code> instead of <code>73</code>.</p>
</div>
<div id="groups" class="section level3">
<h3><span class="header-section-number">38.5.11</span> Groups</h3>
<p>The second large group of problematic entries were of the form <code>x.y</code>, <code>x,y</code> and <code>x y</code>. We want to change all these to our common format <code>x'y</code>. But we can’t just do a search and replace because we would change values such as <code>70.5</code> into <code>70'5</code>. Our strategy will therefore be to search for a very specific pattern that assures us feet and inches are being provided and then, for those that match, replace appropriately.</p>
<p><em>Groups</em> are a powerful aspect of regex that permits the extraction values. Groups are defined using parentheses. They don’t affect the pattern matching per-se. Instead, it permits tools to identify specific parts of the pattern so we can extract them.</p>
<p>We want to change heights written like <code>5.6</code> to <code>5'6</code>.</p>
<p>To avoid changing patterns such as <code>70.2</code>, we will require that the first digit be between 4 and 7 <code>[4-7]</code> and that the second be none or more digits <code>\\d*</code>. Let’s start by defining a simple pattern that matches this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern_without_groups &lt;-<span class="st"> &quot;^[4-7],</span><span class="ch">\\</span><span class="st">d*$&quot;</span></code></pre></div>
<p>We want to extract the digits so we can then form the new version using a period. These are our two groups, so we encapsulate them with parentheses:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern_with_groups &lt;-<span class="st">  &quot;^([4-7]),(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span></code></pre></div>
<p>We encapsulate the part of the pattern that matches the parts we want. Adding groups does not affect the detection, since it only signals that we want to save what is captured by the groups:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5,9&quot;</span>, <span class="st">&quot;5,11&quot;</span>, <span class="st">&quot;6,&quot;</span>, <span class="st">&quot;6,1&quot;</span>)
no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;9&quot;</span>, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;2,8&quot;</span>, <span class="st">&quot;6.1.1&quot;</span>)
s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)
<span class="kw">str_detect</span>(s, pattern_without_groups)
<span class="co">#&gt; [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE</span>
<span class="kw">str_detect</span>(s, pattern_with_groups)
<span class="co">#&gt; [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE</span></code></pre></div>
<p>Once we define groups, we can use the function <code>str_match</code> to extract the values these groups define:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_match</span>(s, pattern_with_groups)
<span class="co">#&gt;      [,1]   [,2] [,3]</span>
<span class="co">#&gt; [1,] &quot;5,9&quot;  &quot;5&quot;  &quot;9&quot; </span>
<span class="co">#&gt; [2,] &quot;5,11&quot; &quot;5&quot;  &quot;11&quot;</span>
<span class="co">#&gt; [3,] &quot;6,&quot;   &quot;6&quot;  &quot;&quot;  </span>
<span class="co">#&gt; [4,] &quot;6,1&quot;  &quot;6&quot;  &quot;1&quot; </span>
<span class="co">#&gt; [5,] NA     NA   NA  </span>
<span class="co">#&gt; [6,] NA     NA   NA  </span>
<span class="co">#&gt; [7,] NA     NA   NA  </span>
<span class="co">#&gt; [8,] NA     NA   NA</span></code></pre></div>
<p>Notice that the second and third columns contains feet and inches respectively. The first column is the part of the string matching the pattern. If no match occurred, we see an <code>NA</code>.</p>
<p>Now we can understand the difference between the functions <code>str_extract</code> and <code>str_match</code>: <code>str_extract</code> extracts only strings that match a pattern, not the values defined by groups:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_extract</span>(s, pattern_with_groups)
<span class="co">#&gt; [1] &quot;5,9&quot;  &quot;5,11&quot; &quot;6,&quot;   &quot;6,1&quot;  NA     NA     NA     NA</span></code></pre></div>
</div>
<div id="search-and-replace-using-groups" class="section level3">
<h3><span class="header-section-number">38.5.12</span> Search and replace using groups</h3>
<p>Another powerful aspect of groups is that you can refer to the extracted values in a regex when searching and replacing.</p>
<p>The regex special character for the <code>i</code>-th groups is <code>\\i</code>. So <code>\\1</code> is the value extracted from the first group, <code>\\2</code> the value from the second and so on. As a simple example, note that the following code will replace a comma with period, but only if it is between two digits:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern_with_groups &lt;-<span class="st">  &quot;^([4-7]),(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>
yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5,9&quot;</span>, <span class="st">&quot;5,11&quot;</span>, <span class="st">&quot;6,&quot;</span>, <span class="st">&quot;6,1&quot;</span>)
no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;9&quot;</span>, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;2,8&quot;</span>, <span class="st">&quot;6.1.1&quot;</span>)
s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)
<span class="kw">str_replace</span>(s, pattern_with_groups, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>)
<span class="co">#&gt; [1] &quot;5&#39;9&quot;   &quot;5&#39;11&quot;  &quot;6&#39;&quot;    &quot;6&#39;1&quot;   &quot;5&#39;9&quot;   &quot;,&quot;     &quot;2,8&quot;   &quot;6.1.1&quot;</span></code></pre></div>
<p>We can use this to convert cases in our reported heights.</p>
<p>We are now ready to define a pattern that helps us convert all the <code>x.y</code>, <code>x,y</code> and <code>x y</code> to our preferred format. We need to adapt <code>pattern_with_groups</code> to be bit more flexible and capture all the cases.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern_with_groups &lt;-<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span></code></pre></div>
<p>Let’s break this one down: - <code>^</code> = start of the string - <code>[4-7]</code> = one digit, either 4,5,6 or 7 - <code>\\s*</code> = none or more white space - <code>[,\\.\\s+]</code> = feet symbol is either <code>,</code>, <code>.</code> or at least one space. - <code>\\s*</code> = none or more white space - <code>\\d*</code> = none or more digits - <code>$</code> = end of the string</p>
<p>We can see that it appears to be working:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_subset</span>(problems, pattern_with_groups) <span class="op">%&gt;%</span><span class="st"> </span>head
<span class="co">#&gt; [1] &quot;5.3&quot;  &quot;5.25&quot; &quot;5.5&quot;  &quot;6.5&quot;  &quot;5.8&quot;  &quot;5.6&quot;</span></code></pre></div>
<p>and will be able to perform the search and replace:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_subset</span>(problems, pattern_with_groups) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">str_replace</span>(pattern_with_groups, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>head
<span class="co">#&gt; [1] &quot;5&#39;3&quot;  &quot;5&#39;25&quot; &quot;5&#39;5&quot;  &quot;6&#39;5&quot;  &quot;5&#39;8&quot;  &quot;5&#39;6&quot;</span></code></pre></div>
<p>Again, we will deal with inches larger than twelve later.</p>
</div>
<div id="testing-and-improving" class="section level3">
<h3><span class="header-section-number">38.5.13</span> Testing and improving</h3>
<p>We have developed a powerful string processing technique that can help us catch many of the problematic entries. Now it’s time to test our approach, search for further problems, and tweak our approach for possible improvements. Let’s write a function that captures all the entries that can’t be converted into numbers remembering that some are in centimeters (we will deal with those later):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_inches_or_cm &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">smallest =</span> <span class="dv">50</span>, <span class="dt">tallest =</span> <span class="dv">84</span>){
  inches &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">as.numeric</span>(x))
  ind &lt;-<span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(inches) <span class="op">&amp;</span><span class="st"> </span>
<span class="st">    </span>((inches <span class="op">&gt;=</span><span class="st"> </span>smallest <span class="op">&amp;</span><span class="st"> </span>inches <span class="op">&lt;=</span><span class="st"> </span>tallest) <span class="op">|</span>
<span class="st">       </span>(inches<span class="op">/</span><span class="fl">2.54</span> <span class="op">&gt;=</span><span class="st"> </span>smallest <span class="op">&amp;</span><span class="st"> </span>inches<span class="op">/</span><span class="fl">2.54</span> <span class="op">&lt;=</span><span class="st"> </span>tallest))
  <span class="op">!</span>ind
}

problems &lt;-<span class="st"> </span>reported_heights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">not_inches_or_cm</span>(height)) <span class="op">%&gt;%</span>
<span class="st">  </span>.<span class="op">$</span>height
<span class="kw">length</span>(problems)
<span class="co">#&gt; [1] 200</span></code></pre></div>
<p>Let’s see how many of these fit our pattern after the processing steps we developed above:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">converted &lt;-<span class="st"> </span>problems <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;feet|foot|ft&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#convert feet symbols to &#39;</span>
<span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">#remove inches symbols</span>
<span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>) ##change format

pattern &lt;-<span class="st"> &quot;^[4-7]</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">d{1,2}$&quot;</span>
index &lt;-<span class="st"> </span><span class="kw">str_detect</span>(converted, pattern)
<span class="kw">mean</span>(index)
<span class="co">#&gt; [1] 0.615</span></code></pre></div>
<p>Note how we leveraged the pipe, one of the advantages of using <strong>stringr</strong>. This last piece of code shows that we have matched well over half of the strings. Let’s examine the remaining cases:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">converted[<span class="op">!</span>index]
<span class="co">#&gt;  [1] &quot;6&quot;             &quot;165cm&quot;         &quot;511&quot;           &quot;6&quot;            </span>
<span class="co">#&gt;  [5] &quot;2&quot;             &quot;&gt;9000&quot;         &quot;5 &#39; and 8.11 &quot; &quot;11111&quot;        </span>
<span class="co">#&gt;  [9] &quot;6&quot;             &quot;103.2&quot;         &quot;19&quot;            &quot;5&quot;            </span>
<span class="co">#&gt; [13] &quot;300&quot;           &quot;6&#39;&quot;            &quot;6&quot;             &quot;Five &#39; eight &quot;</span>
<span class="co">#&gt; [17] &quot;7&quot;             &quot;214&quot;           &quot;6&quot;             &quot;0.7&quot;          </span>
<span class="co">#&gt; [21] &quot;6&quot;             &quot;2&#39;33&quot;          &quot;612&quot;           &quot;1,70&quot;         </span>
<span class="co">#&gt; [25] &quot;87&quot;            &quot;5&#39;7.5&quot;         &quot;5&#39;7.5&quot;         &quot;111&quot;          </span>
<span class="co">#&gt; [29] &quot;5&#39; 7.78&quot;       &quot;12&quot;            &quot;6&quot;             &quot;yyy&quot;          </span>
<span class="co">#&gt; [33] &quot;89&quot;            &quot;34&quot;            &quot;25&quot;            &quot;6&quot;            </span>
<span class="co">#&gt; [37] &quot;6&quot;             &quot;22&quot;            &quot;684&quot;           &quot;6&quot;            </span>
<span class="co">#&gt; [41] &quot;1&quot;             &quot;1&quot;             &quot;6*12&quot;          &quot;87&quot;           </span>
<span class="co">#&gt; [45] &quot;6&quot;             &quot;1.6&quot;           &quot;120&quot;           &quot;120&quot;          </span>
<span class="co">#&gt; [49] &quot;23&quot;            &quot;1.7&quot;           &quot;6&quot;             &quot;5&quot;            </span>
<span class="co">#&gt; [53] &quot;69&quot;            &quot;5&#39; 9 &quot;         &quot;5 &#39; 9 &quot;        &quot;6&quot;            </span>
<span class="co">#&gt; [57] &quot;6&quot;             &quot;86&quot;            &quot;708,661&quot;       &quot;5 &#39; 6 &quot;       </span>
<span class="co">#&gt; [61] &quot;6&quot;             &quot;649,606&quot;       &quot;10000&quot;         &quot;1&quot;            </span>
<span class="co">#&gt; [65] &quot;728,346&quot;       &quot;0&quot;             &quot;6&quot;             &quot;6&quot;            </span>
<span class="co">#&gt; [69] &quot;6&quot;             &quot;100&quot;           &quot;88&quot;            &quot;6&quot;            </span>
<span class="co">#&gt; [73] &quot;170 cm&quot;        &quot;7,283,465&quot;     &quot;5&quot;             &quot;5&quot;            </span>
<span class="co">#&gt; [77] &quot;34&quot;</span></code></pre></div>
<p>Four clear patterns arise and some other minor problems:</p>
<ol style="list-style-type: decimal">
<li>Many students measuring exactly 5 or 6 feet did not enter any inches, for example <code>6'</code>, and our pattern requires that inches be included.</li>
<li>Some students measuring exactly 5 or 6 feet entered just that number.</li>
<li>Some of the inches were entered with decimal points. For example <code>5'7.5''</code>. Our pattern only looks for two digits.</li>
<li>Some entries have spaces at the end, for example <code>5 ' 9</code>.</li>
<li>Some entries are in meters and some of these use European decimals: <code>1.6</code>, <code>1,7</code>.</li>
<li>Two students added <code>cm</code>.</li>
<li>A student spelled out the numbers: <code>Five foot eight inches</code>.</li>
</ol>
<p>It is not necessarily clear that it is worth writing code to handle all these cases since they might be rare enough. However, some of them provide us with an opportunity to learn a few more regex techniques, so we will build a fix.</p>
</div>
<div id="using-groups-and-quantifiers" class="section level3">
<h3><span class="header-section-number">38.5.14</span> Using groups and quantifiers</h3>
<p>For case 1, if we add a <code>'0</code> to first zero, for example, convert all <code>6</code> to <code>6'0</code>, then our pattern will match. This can be done using groups:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;5&quot;</span>)
no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;&quot;</span>, <span class="st">&quot;5&#39;&#39;&quot;</span>, <span class="st">&quot;5&#39;4&quot;</span>)
s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)
<span class="kw">str_replace</span>(s, <span class="st">&quot;^([4-7])$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;0&quot;</span>)
<span class="co">#&gt; [1] &quot;5&#39;0&quot; &quot;6&#39;0&quot; &quot;5&#39;0&quot; &quot;5&#39;&quot;  &quot;5&#39;&#39;&quot; &quot;5&#39;4&quot;</span></code></pre></div>
<p>The pattern says it has to start (<code>^</code>) followed by a digit between 4 and 7 and end there (<code>$</code>). The parenthesis defines the group that we pass as <code>\\1</code> to generate the replacement regex string.</p>
<p>We can adapt this code slightly to handle the case 2 as well, which covers the entry <code>5'</code>. Note <code>5'</code> is left untouched. This is because the extra <code>'</code> makes the pattern not match since we have to end with a 5 or 6. We want to permit the 5 or 6 to be followed by 0 or 1 feet sign. So we can simply add <code>'{0,1}</code> after the <code>'</code> to do this. However, we can use the none or once special character <code>?</code>. As we saw above, this is different from <code>*</code> which is none or more. We now see that the fourth case is also converted:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_replace</span>(s, <span class="st">&quot;^([56])&#39;?$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;0&quot;</span>)
<span class="co">#&gt; [1] &quot;5&#39;0&quot; &quot;6&#39;0&quot; &quot;5&#39;0&quot; &quot;5&#39;0&quot; &quot;5&#39;&#39;&quot; &quot;5&#39;4&quot;</span></code></pre></div>
<p>Here we only permit 5 and 6, but not 4 and 7. This is because 5 and 6 feet tall is quite common, so we assume those that typed 5 or 6 really meant <code>60</code> or <code>72</code> inches. However, <code>4</code> and <code>7</code> feet tall are so rare that, although we accept <code>84</code> as a valid entry, we assume <code>7</code> was entered in error.</p>
<p>We can use quantifiers to deal with <strong>case 3</strong>. These entries are not matched because the inches include decimals and our pattern does not permit this. We need to allow the second group to include decimals not just digits. This means we must permit zero or one period <code>.</code> then zero or more digits. So we will be using both <code>?</code> and <code>*</code>. Also remember that, for this particular case, the period needs to be escaped since it is a special character (it means any character except line break). Here is a simple example of how we can use <code>*</code>.</p>
<p>So we can adapt our pattern, currently <code>^[4-7]\\s*'\\s*\\d{1,2}$</code> to permit a decimal at the end:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> &quot;^[4-7]</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.?</span><span class="ch">\\</span><span class="st">d*)$&quot;</span></code></pre></div>
<p>Case 4, meters using commas, we can approach similarly to how we converted the <code>x.y</code> to <code>x'y</code>. A difference is that we require that the first digit be 1 or 2:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1,7&quot;</span>, <span class="st">&quot;1, 8&quot;</span>, <span class="st">&quot;2, &quot;</span> )
no &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5,8&quot;</span>, <span class="st">&quot;5,3,2&quot;</span>, <span class="st">&quot;1.7&quot;</span>)
s &lt;-<span class="st"> </span><span class="kw">c</span>(yes, no)
<span class="kw">str_replace</span>(s, <span class="st">&quot;^([12])</span><span class="ch">\\</span><span class="st">s*,</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">2&quot;</span>)
<span class="co">#&gt; [1] &quot;1.7&quot;   &quot;1.8&quot;   &quot;2.&quot;    &quot;5,8&quot;   &quot;5,3,2&quot; &quot;1.7&quot;</span></code></pre></div>
<p>We will later check if the entries are meters using their numeric values.</p>
</div>
</div>
<div id="stringr-package-continued" class="section level2">
<h2><span class="header-section-number">38.6</span> Stringr package (continued)</h2>
<div id="trimming" class="section level3">
<h3><span class="header-section-number">38.6.1</span> Trimming</h3>
<p>In general, spaces at the start or end of the string are uninformative. These can be particularly deceptive because sometimes they can be hard to see:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> &quot;Hi &quot;</span>
<span class="kw">cat</span>(s)
<span class="co">#&gt; Hi</span>
<span class="kw">identical</span>(s, <span class="st">&quot;Hi&quot;</span>)
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>This is a general enough problem that there is a function dedicated to removing them: <code>str_trim</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_trim</span>(<span class="st">&quot;5 &#39; 9 &quot;</span>)
<span class="co">#&gt; [1] &quot;5 &#39; 9&quot;</span></code></pre></div>
</div>
<div id="to-uppercase-and-to-lowercase" class="section level3">
<h3><span class="header-section-number">38.6.2</span> To uppercase and to lowercase</h3>
<p>One of the entries writes out numbers as words <code>Five foot eight inches</code>. Although not efficient, we could add 13 extra <code>str_replace</code> calls to convert <code>zero</code> to <code>0</code>, <code>one</code> to <code>1</code>, and so on. To avoid having to write two separate operations for <code>Zero</code> and <code>zero</code>, <code>One</code> and <code>one</code>, etc., we can use the <code>str_to_lower</code> function to make all works lowercase first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Five feet eight inches&quot;</span>)
<span class="kw">str_to_lower</span>(s)
<span class="co">#&gt; [1] &quot;five feet eight inches&quot;</span></code></pre></div>
<p>We are now be ready to define a procedure that converts all the problematic cases to inches.</p>
</div>
</div>
<div id="case-study-2-reported-heights-continued" class="section level2">
<h2><span class="header-section-number">38.7</span> Case study 2: Reported heights (continued)</h2>
<p>We now put all this together into a function that takes a string vector and tries to convert as many strings as possible to one format. We write a function that puts together what we have done above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">convert_format &lt;-<span class="st"> </span><span class="cf">function</span>(s){
  s <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;feet|foot|ft&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#convert feet symbols to &#39;</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;inches|in|&#39;&#39;|</span><span class="ch">\&quot;</span><span class="st">|cm|and&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">#remove inches and other symbols</span>
<span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*[,</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s+]</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;</span><span class="ch">\\</span><span class="st">2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#change x.y, x,y x y</span>
<span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;^([56])&#39;?$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&#39;0&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#add 0 when to 5 or 6</span>
<span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;^([12])</span><span class="ch">\\</span><span class="st">s*,</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#change european decimal</span>
<span class="st">    </span><span class="kw">str_trim</span>() <span class="co">#remove extra space</span>
}</code></pre></div>
<p>We can also write a function that converts words to numbers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">words_to_numbers &lt;-<span class="st"> </span><span class="cf">function</span>(s){
  <span class="kw">str_to_lower</span>(s) <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;zero&quot;</span>, <span class="st">&quot;0&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;two&quot;</span>, <span class="st">&quot;2&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;three&quot;</span>, <span class="st">&quot;3&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;four&quot;</span>, <span class="st">&quot;4&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;five&quot;</span>, <span class="st">&quot;5&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;six&quot;</span>, <span class="st">&quot;6&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;seven&quot;</span>, <span class="st">&quot;7&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;eight&quot;</span>, <span class="st">&quot;8&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;nine&quot;</span>, <span class="st">&quot;9&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;ten&quot;</span>, <span class="st">&quot;10&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;eleven&quot;</span>, <span class="st">&quot;11&quot;</span>)
}</code></pre></div>
<p>Now we can see which problematic entries remain:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">converted &lt;-<span class="st"> </span>problems <span class="op">%&gt;%</span><span class="st"> </span>words_to_numbers <span class="op">%&gt;%</span><span class="st"> </span>convert_format
remaining_problems &lt;-<span class="st"> </span>converted[<span class="kw">not_inches_or_cm</span>(converted)]
pattern &lt;-<span class="st"> &quot;^[4-7]</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.?</span><span class="ch">\\</span><span class="st">d*$&quot;</span>
index &lt;-<span class="st"> </span><span class="kw">str_detect</span>(remaining_problems, pattern)
remaining_problems[<span class="op">!</span>index]
<span class="co">#&gt;  [1] &quot;511&quot;       &quot;2&quot;         &quot;&gt;9000&quot;     &quot;11111&quot;     &quot;103.2&quot;    </span>
<span class="co">#&gt;  [6] &quot;19&quot;        &quot;300&quot;       &quot;7&quot;         &quot;214&quot;       &quot;0.7&quot;      </span>
<span class="co">#&gt; [11] &quot;2&#39;33&quot;      &quot;612&quot;       &quot;1.70&quot;      &quot;87&quot;        &quot;111&quot;      </span>
<span class="co">#&gt; [16] &quot;12&quot;        &quot;yyy&quot;       &quot;89&quot;        &quot;34&quot;        &quot;25&quot;       </span>
<span class="co">#&gt; [21] &quot;22&quot;        &quot;684&quot;       &quot;1&quot;         &quot;1&quot;         &quot;6*12&quot;     </span>
<span class="co">#&gt; [26] &quot;87&quot;        &quot;1.6&quot;       &quot;120&quot;       &quot;120&quot;       &quot;23&quot;       </span>
<span class="co">#&gt; [31] &quot;1.7&quot;       &quot;86&quot;        &quot;708,661&quot;   &quot;649,606&quot;   &quot;10000&quot;    </span>
<span class="co">#&gt; [36] &quot;1&quot;         &quot;728,346&quot;   &quot;0&quot;         &quot;100&quot;       &quot;88&quot;       </span>
<span class="co">#&gt; [41] &quot;7,283,465&quot; &quot;34&quot;</span></code></pre></div>
<p>they all seem to be cases that are impossible to fix.</p>
</div>
<div id="separate-1" class="section level2">
<h2><span class="header-section-number">38.8</span> <code>separate</code></h2>
<p>In a previous section, we constructed a regex that lets us identify which elements of a character vector match the feet and inches pattern. However, we want to do more. We want to extract and save the feet and number values so that we can convert them to inches when appropriate.</p>
<p>If we have a simpler case like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;10&quot;</span>, <span class="st">&quot;6&#39;1&quot;</span>)
tab &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> s)</code></pre></div>
<p>we have already learned to use the separate function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;&#39;&quot;</span>)
<span class="co">#&gt;   feet inches</span>
<span class="co">#&gt; 1    5     10</span>
<span class="co">#&gt; 2    6      1</span></code></pre></div>
<p>The <code>extract</code> function from the <strong>tidyr</strong> package lets us use regex groups to extract the desired values. Above we showed how to use <code>separate</code> to split the data as desired. Here is the equivalent code using <code>extract</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">extract</span>(x, <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="dt">regex =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">d)&#39;(</span><span class="ch">\\</span><span class="st">d{1,2})&quot;</span>)
<span class="co">#&gt;   feet inches</span>
<span class="co">#&gt; 1    5     10</span>
<span class="co">#&gt; 2    6      1</span></code></pre></div>
<p>So why do we even need the new function <code>extract</code>? We have seen how small changes can throw off exact pattern matching. Groups in regex give us more flexibility. For example, if we define:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&#39;10&quot;</span>, <span class="st">&quot;6&#39;1</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,<span class="st">&quot;5&#39;8inches&quot;</span>)
tab &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> s)</code></pre></div>
<p>and we only want the numbers, <code>separate</code> fails:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>,<span class="st">&quot;inches&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;&#39;&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;right&quot;</span>)
<span class="co">#&gt;   feet  inches</span>
<span class="co">#&gt; 1    5      10</span>
<span class="co">#&gt; 2    6      1&quot;</span>
<span class="co">#&gt; 3    5 8inches</span></code></pre></div>
<p>However, we can use <code>extract</code>. The regex here is a bit more complicated since we have to permit <code>'</code> with spaces and <code>feet</code>. We also do not want the <code>&quot;</code> included in the value, so we do not include that in the group:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">extract</span>(x, <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="dt">regex =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">d)&#39;(</span><span class="ch">\\</span><span class="st">d{1,2})&quot;</span>)
<span class="co">#&gt;   feet inches</span>
<span class="co">#&gt; 1    5     10</span>
<span class="co">#&gt; 2    6      1</span>
<span class="co">#&gt; 3    5      8</span></code></pre></div>
</div>
<div id="case-study-2-reported-heights-continued-1" class="section level2">
<h2><span class="header-section-number">38.9</span> Case study 2: Reported heights (continued)</h2>
<p>We are now ready to put it all together and wrangle our reported heights data to try to recover as many heights as possible. The code is complex, but we will break it down into parts.</p>
<p>We start by cleaning up the <code>height</code> column so that the heights are closer to a feet’inches format. We added an original heights column so we can compare before and after.</p>
<p>Now we are ready to wrangle our reported heights dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> &quot;^([4-7])</span><span class="ch">\\</span><span class="st">s*&#39;</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">d+</span><span class="ch">\\</span><span class="st">.?</span><span class="ch">\\</span><span class="st">d*)$&quot;</span>

smallest &lt;-<span class="st"> </span><span class="dv">50</span>
tallest &lt;-<span class="st"> </span><span class="dv">84</span>
new_heights &lt;-<span class="st"> </span>reported_heights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">original =</span> height, 
         <span class="dt">height =</span> <span class="kw">words_to_numbers</span>(height) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">convert_format</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">extract</span>(height, <span class="kw">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="dt">regex =</span> pattern, <span class="dt">remove =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), as.numeric) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">guess =</span> <span class="dv">12</span><span class="op">*</span>feet <span class="op">+</span><span class="st"> </span>inches) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height =</span> <span class="kw">case_when</span>(
    <span class="op">!</span><span class="kw">is.na</span>(height) <span class="op">&amp;</span><span class="st"> </span><span class="kw">between</span>(height, smallest, tallest) <span class="op">~</span><span class="st"> </span>height,<span class="co">#inches </span>
    <span class="op">!</span><span class="kw">is.na</span>(height) <span class="op">&amp;</span><span class="st"> </span><span class="kw">between</span>(height<span class="op">/</span><span class="fl">2.54</span>, smallest, tallest) <span class="op">~</span><span class="st"> </span>height<span class="op">/</span><span class="fl">2.54</span>,<span class="co">#centimeters</span>
    <span class="op">!</span><span class="kw">is.na</span>(height) <span class="op">&amp;</span><span class="st"> </span><span class="kw">between</span>(height<span class="op">*</span><span class="dv">100</span><span class="op">/</span><span class="fl">2.54</span>, smallest, tallest) <span class="op">~</span><span class="st"> </span>height<span class="op">*</span><span class="dv">100</span><span class="op">/</span><span class="fl">2.54</span>,<span class="co">#meters</span>
    <span class="op">!</span><span class="kw">is.na</span>(guess) <span class="op">&amp;</span><span class="st"> </span>inches <span class="op">&lt;</span><span class="st"> </span><span class="dv">12</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">between</span>(guess, smallest, tallest) <span class="op">~</span><span class="st"> </span>guess,<span class="co">#feet&#39;inches</span>
    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="ot">NA</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>guess)</code></pre></div>
<p>We can check all the entries we converted by typing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_heights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">not_inches</span>(original)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(original, height) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(height) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">View</span>()</code></pre></div>
<p>A final observation is that if we look at the shortest students in our course:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_heights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(height) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n=</span><span class="dv">7</span>)
<span class="co">#&gt;            time_stamp    sex height feet inches original</span>
<span class="co">#&gt; 1 2017-07-04 01:30:25   Male   50.0   NA     NA       50</span>
<span class="co">#&gt; 2 2017-09-07 10:40:35   Male   50.0   NA     NA       50</span>
<span class="co">#&gt; 3 2014-09-02 15:18:30 Female   51.0   NA     NA       51</span>
<span class="co">#&gt; 4 2016-06-05 14:07:20 Female   52.0   NA     NA       52</span>
<span class="co">#&gt; 5 2016-06-05 14:07:38 Female   52.0   NA     NA       52</span>
<span class="co">#&gt; 6 2014-09-23 03:39:56 Female   53.0   NA     NA       53</span>
<span class="co">#&gt; 7 2015-01-07 08:57:29   Male   53.8   NA     NA    53.77</span></code></pre></div>
<p>We see heights of 53, 54, and 55. In the originals, we also have 51 and 52. These short heights are rare and it is likely that the students actually meant <code>5'1</code>, <code>5'2</code>, <code>5'3</code>, <code>5'4</code>, and <code>5'5</code>. Because we are not completely sure, we will leave them as reported.</p>
</div>
<div id="string-splitting" class="section level2">
<h2><span class="header-section-number">38.10</span> String splitting</h2>
<p>Another very common data wrangling operation is string splitting. To illustrate how this comes up, we start with an illustrative example. Suppose we did not have the function <code>read_csv</code> available to use. We instead have to read a csv file using the base R function <code>readLines</code> like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filename &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/murders.csv&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;dslabs&quot;</span>)
lines &lt;-<span class="st"> </span><span class="kw">readLines</span>(filename)</code></pre></div>
<p>This function reads-in the data line-by-line to create a vector of strings. In this case, one string for each row in the spreadsheet. The first six lines are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lines <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()
<span class="co">#&gt; [1] &quot;state,abb,region,population,total&quot; &quot;Alabama,AL,South,4779736,135&quot;     </span>
<span class="co">#&gt; [3] &quot;Alaska,AK,West,710231,19&quot;          &quot;Arizona,AZ,West,6392017,232&quot;      </span>
<span class="co">#&gt; [5] &quot;Arkansas,AR,South,2915918,93&quot;      &quot;California,CA,West,37253956,1257&quot;</span></code></pre></div>
<p>We want to extract the values that are separated by comma for each string in the vector. The command <code>str_split</code> does exactly this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">str_split</span>(lines, <span class="st">&quot;,&quot;</span>) 
x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] &quot;state&quot;      &quot;abb&quot;        &quot;region&quot;     &quot;population&quot; &quot;total&quot;     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] &quot;Alabama&quot; &quot;AL&quot;      &quot;South&quot;   &quot;4779736&quot; &quot;135&quot;    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] &quot;Alaska&quot; &quot;AK&quot;     &quot;West&quot;   &quot;710231&quot; &quot;19&quot;    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; [1] &quot;Arizona&quot; &quot;AZ&quot;      &quot;West&quot;    &quot;6392017&quot; &quot;232&quot;    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt; [1] &quot;Arkansas&quot; &quot;AR&quot;       &quot;South&quot;    &quot;2915918&quot;  &quot;93&quot;      </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[6]]</span>
<span class="co">#&gt; [1] &quot;California&quot; &quot;CA&quot;         &quot;West&quot;       &quot;37253956&quot;   &quot;1257&quot;</span></code></pre></div>
<p>Note that the first entry has the column names so we can separate that out:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">col_names &lt;-<span class="st"> </span>x[[<span class="dv">1</span>]]
x &lt;-<span class="st"> </span>x[<span class="op">-</span><span class="dv">1</span>]</code></pre></div>
<p>To convert our list into a data frame, we can use a shortcut provided by the <code>map</code> functions in the <strong>purrr</strong> package. The map function applies the same function to each element in a list. So if we want to extract the first entry of each element in <code>x</code>, we can write:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(purrr)
<span class="kw">map</span>(x, <span class="cf">function</span>(y) y[<span class="dv">1</span>]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] &quot;Alabama&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] &quot;Alaska&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] &quot;Arizona&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; [1] &quot;Arkansas&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt; [1] &quot;California&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[6]]</span>
<span class="co">#&gt; [1] &quot;Colorado&quot;</span></code></pre></div>
<p>However, because this is such a common task, purrr provides a shortcut. If the second argument receives an integer instead of a function, it assumes we want that entry:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(x, <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] &quot;Alabama&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] &quot;Alaska&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] &quot;Arizona&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; [1] &quot;Arkansas&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt; [1] &quot;California&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[6]]</span>
<span class="co">#&gt; [1] &quot;Colorado&quot;</span></code></pre></div>
<p>To force <code>map</code> to return a character vector instead of a list, we can use <code>map_chr</code>. Similarly <code>map_int</code> returns integers. So to create our data frame, we can use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">map_chr</span>(x, <span class="dv">1</span>),  
                  <span class="kw">map_chr</span>(x, <span class="dv">2</span>),
                  <span class="kw">map_chr</span>(x, <span class="dv">3</span>),
                  <span class="kw">map_chr</span>(x, <span class="dv">4</span>),
                  <span class="kw">map_chr</span>(x, <span class="dv">5</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate_all</span>(parse_guess) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setNames</span>(col_names)
dat <span class="op">%&gt;%</span><span class="st"> </span>head
<span class="co">#&gt;        state abb region population total</span>
<span class="co">#&gt; 1    Alabama  AL  South    4779736   135</span>
<span class="co">#&gt; 2     Alaska  AK   West     710231    19</span>
<span class="co">#&gt; 3    Arizona  AZ   West    6392017   232</span>
<span class="co">#&gt; 4   Arkansas  AR  South    2915918    93</span>
<span class="co">#&gt; 5 California  CA   West   37253956  1257</span>
<span class="co">#&gt; 6   Colorado  CO   West    5029196    65</span></code></pre></div>
<p>If you learn more about the <strong>purrr</strong> package, you will be able to write the code above more efficiently:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transpose</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map</span>( <span class="op">~</span><span class="st"> </span><span class="kw">parse_guess</span>(<span class="kw">unlist</span>(.))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setNames</span>(col_names) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as.data.frame</span>() </code></pre></div>
<p>It turns out that we can avoid all the work shown above after the call to <code>str_split</code>. Specifically, if we know that the data we are extracting can be represented as a table, we can use the argument <code>simplify=TRUE</code> and <code>str_split</code> return a matrix instead of a list:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">str_split</span>(lines, <span class="st">&quot;,&quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>) 
col_names &lt;-<span class="st"> </span>x[<span class="dv">1</span>,]
x &lt;-<span class="st"> </span>x[<span class="op">-</span><span class="dv">1</span>,]
x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_data_frame</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setNames</span>(col_names) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate_all</span>(parse_guess)
<span class="co">#&gt; # A tibble: 51 x 5</span>
<span class="co">#&gt;   state      abb   region population total</span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;       &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 Alabama    AL    South     4779736   135</span>
<span class="co">#&gt; 2 Alaska     AK    West       710231    19</span>
<span class="co">#&gt; 3 Arizona    AZ    West      6392017   232</span>
<span class="co">#&gt; 4 Arkansas   AR    South     2915918    93</span>
<span class="co">#&gt; 5 California CA    West     37253956  1257</span>
<span class="co">#&gt; 6 Colorado   CO    West      5029196    65</span>
<span class="co">#&gt; # ... with 45 more rows</span></code></pre></div>
</div>
<div id="case-study-3-extracting-tables-from-a-pdf" class="section level2">
<h2><span class="header-section-number">38.11</span> Case study 3: Extracting tables from a PDF</h2>
<p>One of the datasets provided in dslabs shows scientific funding rates by gender in the Netherlands:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dslabs)
<span class="kw">data</span>(<span class="st">&quot;research_funding_rates&quot;</span>)
research_funding_rates <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">&quot;discipline&quot;</span>, <span class="st">&quot;success_rates_men&quot;</span>, <span class="st">&quot;success_rates_women&quot;</span>)
<span class="co">#&gt;            discipline success_rates_men success_rates_women</span>
<span class="co">#&gt; 1   Chemical sciences              26.5                25.6</span>
<span class="co">#&gt; 2   Physical sciences              19.3                23.1</span>
<span class="co">#&gt; 3             Physics              26.9                22.2</span>
<span class="co">#&gt; 4          Humanities              14.3                19.3</span>
<span class="co">#&gt; 5  Technical sciences              15.9                21.0</span>
<span class="co">#&gt; 6   Interdisciplinary              11.4                21.8</span>
<span class="co">#&gt; 7 Earth/life sciences              24.4                14.3</span>
<span class="co">#&gt; 8     Social sciences              15.3                11.5</span>
<span class="co">#&gt; 9    Medical sciences              18.8                11.2</span></code></pre></div>
<p>The data comes from a <a href="http://www.pnas.org/content/112/40/12349.abstract">paper</a> published in the prestigious journal PNAS. However, the data is not provided in a spreadsheet, it is in a table in a PDF document:</p>
<p><img src="wrangling/img/pnas-table-s1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>(Source: <a href="http://www.pnas.org/content/112/40/12349">Romy van der Lee and Naomi Ellemers, PNAS 2015 112 (40) 12349-12353</a>)</p>
<p>We could extract the number by hand, but this could lead to human error. Instead, we can try to wrangle the data using R. We start by downloading the pdf document, then importing into R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;pdftools&quot;</span>)
temp_file &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
url &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;http://www.pnas.org/content/suppl/2015/09/16/&quot;</span>,
              <span class="st">&quot;1510159112.DCSupplemental/pnas.201510159SI.pdf&quot;</span>)
<span class="kw">download.file</span>(url, temp_file)
txt &lt;-<span class="st"> </span><span class="kw">pdf_text</span>(temp_file)
<span class="kw">file.remove</span>(temp_file)</code></pre></div>
<p>If we examine the object text, we notice that it is a character vector with an entry for each page. So we keep the page we want:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">raw_data_research_funding_rates &lt;-<span class="st"> </span>txt[<span class="dv">2</span>]</code></pre></div>
<p>The steps above can actually be skipped because we include this raw data in the <strong>dslabs</strong> package as well:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;raw_data_research_funding_rates&quot;</span>)</code></pre></div>
<p>Examining the object <code>raw_data_research_funding_rates</code> we see that it is a long string and each line on the page, including the table rows, are separated by the symbol for newline: <code>\n</code>. We therefore can create a list with the lines of the text as elements as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab &lt;-<span class="st"> </span><span class="kw">str_split</span>(raw_data_research_funding_rates, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre></div>
<p>Because we start off with just one element in the string, we end up with a list with just one entry.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab &lt;-<span class="st"> </span>tab[[<span class="dv">1</span>]]</code></pre></div>
<p>By examining <code>tab</code> we see that the information for the column names is the third and fourth entries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">the_names_<span class="dv">1</span> &lt;-<span class="st"> </span>tab[<span class="dv">3</span>]
the_names_<span class="dv">2</span> &lt;-<span class="st"> </span>tab[<span class="dv">4</span>]</code></pre></div>
<p>In this table, the column information is spread across two lines.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">the_names_<span class="dv">1</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_trim</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">cat</span>()
<span class="co">#&gt; Applications, n                    Awards, n                      Success rates, %</span></code></pre></div>
<p>We want to create one vector with one name for each column. Using some of the functions we have just learned, we do this. Let’s start with the first line shown above. We want to remove the leading space and anything following the comma. We use regex for the latter. Then we can obtain the elements by splitting strings separated by space. We want to split only when there are 2 or more spaces to avoid splitting <code>success rate</code>. So we use the regex <code>\\s{2,}</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">the_names_<span class="dv">1</span> &lt;-<span class="st"> </span>the_names_<span class="dv">1</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">str_trim</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">str_replace_all</span>(<span class="st">&quot;,</span><span class="ch">\\</span><span class="st">s.&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">str_split</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s{2,}&quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)
the_names_<span class="dv">1</span>
<span class="co">#&gt;      [,1]           [,2]     [,3]           </span>
<span class="co">#&gt; [1,] &quot;Applications&quot; &quot;Awards&quot; &quot;Success rates&quot;</span></code></pre></div>
<p>Now we will look at the second line:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">the_names_<span class="dv">2</span>  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace_all</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s+&quot;</span>,<span class="st">&quot;  &quot;</span>)
<span class="co">#&gt; [1] &quot;  Discipline  Total  Men  Women  Total  Men  Women  Total  Men  Women&quot;</span></code></pre></div>
<p>Here we want to trim the leading space and then split by space as we did for the first line:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">the_names_<span class="dv">2</span> &lt;-<span class="st"> </span>the_names_<span class="dv">2</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">str_trim</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">str_split</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s+&quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)
the_names_<span class="dv">2</span>
<span class="co">#&gt;      [,1]         [,2]    [,3]  [,4]    [,5]    [,6]  [,7]    [,8]   </span>
<span class="co">#&gt; [1,] &quot;Discipline&quot; &quot;Total&quot; &quot;Men&quot; &quot;Women&quot; &quot;Total&quot; &quot;Men&quot; &quot;Women&quot; &quot;Total&quot;</span>
<span class="co">#&gt;      [,9]  [,10]  </span>
<span class="co">#&gt; [1,] &quot;Men&quot; &quot;Women&quot;</span></code></pre></div>
<p>We can then join these to generate one name for each column:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tmp_names &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="kw">rep</span>(the_names_<span class="dv">1</span>, <span class="dt">each =</span> <span class="dv">3</span>), the_names_<span class="dv">2</span>[<span class="op">-</span><span class="dv">1</span>], <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)
the_names &lt;-<span class="st"> </span><span class="kw">c</span>(the_names_<span class="dv">2</span>[<span class="dv">1</span>], tmp_names) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">str_to_lower</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">str_replace_all</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s&quot;</span>, <span class="st">&quot;_&quot;</span>)
the_names
<span class="co">#&gt;  [1] &quot;discipline&quot;          &quot;applications_total&quot;  &quot;applications_men&quot;   </span>
<span class="co">#&gt;  [4] &quot;applications_women&quot;  &quot;awards_total&quot;        &quot;awards_men&quot;         </span>
<span class="co">#&gt;  [7] &quot;awards_women&quot;        &quot;success_rates_total&quot; &quot;success_rates_men&quot;  </span>
<span class="co">#&gt; [10] &quot;success_rates_women&quot;</span></code></pre></div>
<p>Now we are ready to get the actual data. By examining the <code>tab</code> object, we notice that the information is in lines 6 through 14. We can use <code>str_split</code> again to achieve our goal:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_research_funding_rates &lt;-<span class="st"> </span>tab[<span class="dv">6</span><span class="op">:</span><span class="dv">14</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>str_trim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">str_split</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s{2,}&quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data.frame</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setNames</span>(the_names) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate_at</span>(<span class="op">-</span><span class="dv">1</span>, parse_number)
new_research_funding_rates <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()
<span class="co">#&gt;           discipline applications_total applications_men</span>
<span class="co">#&gt; 1  Chemical sciences                122               83</span>
<span class="co">#&gt; 2  Physical sciences                174              135</span>
<span class="co">#&gt; 3            Physics                 76               67</span>
<span class="co">#&gt; 4         Humanities                396              230</span>
<span class="co">#&gt; 5 Technical sciences                251              189</span>
<span class="co">#&gt; 6  Interdisciplinary                183              105</span>
<span class="co">#&gt;   applications_women awards_total awards_men awards_women</span>
<span class="co">#&gt; 1                 39           32         22           10</span>
<span class="co">#&gt; 2                 39           35         26            9</span>
<span class="co">#&gt; 3                  9           20         18            2</span>
<span class="co">#&gt; 4                166           65         33           32</span>
<span class="co">#&gt; 5                 62           43         30           13</span>
<span class="co">#&gt; 6                 78           29         12           17</span>
<span class="co">#&gt;   success_rates_total success_rates_men success_rates_women</span>
<span class="co">#&gt; 1                26.2              26.5                25.6</span>
<span class="co">#&gt; 2                20.1              19.3                23.1</span>
<span class="co">#&gt; 3                26.3              26.9                22.2</span>
<span class="co">#&gt; 4                16.4              14.3                19.3</span>
<span class="co">#&gt; 5                17.1              15.9                21.0</span>
<span class="co">#&gt; 6                15.8              11.4                21.8</span></code></pre></div>
<p>We can see that the objects are identical:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(research_funding_rates, new_research_funding_rates)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
<div id="re-coding" class="section level2">
<h2><span class="header-section-number">38.12</span> Re-coding</h2>
<p>Another common operation involving strings is recoding the names of categorical variables. Let’s say you have really long names for your levels and you will be displaying them in plots, you might want to use shorter versions of these names. For example, in character vectors with country names, you might want to change “United States of America” to “USA” and “United Kingdom” to UK, and so on. We can do this with <code>case_when</code> although the tidyverse offers options that are specifically designed for this task: the <code>recode</code> function.</p>
<p>Here is an example that shows how to rename countries with long names:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dslabs)
<span class="kw">data</span>(<span class="st">&quot;gapminder&quot;</span>)</code></pre></div>
<p>Suppose we want to show life expectancy time series by country for the Caribbean:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(region<span class="op">==</span><span class="st">&quot;Caribbean&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, life_expectancy, <span class="dt">color =</span> country)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="book_files/figure-html/caribbean-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The plot is what we want, but much of the space is wasted to accommodate some of the long country names:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(region<span class="op">==</span><span class="st">&quot;Caribbean&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_length</span>(country) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">12</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>(country) 
<span class="co">#&gt;                          country</span>
<span class="co">#&gt; 1            Antigua and Barbuda</span>
<span class="co">#&gt; 2             Dominican Republic</span>
<span class="co">#&gt; 3 St. Vincent and the Grenadines</span>
<span class="co">#&gt; 4            Trinidad and Tobago</span></code></pre></div>
<p>We have four countries with names longer than 12 characters. These names appear once for each year in the Gapminder dataset. Once we pick nicknames, we need to change them all consistently. The <code>recode</code> function can be used to do this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(region<span class="op">==</span><span class="st">&quot;Caribbean&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">recode</span>(country, 
                          <span class="st">`</span><span class="dt">Antigua and Barbuda</span><span class="st">`</span> =<span class="st"> &quot;Barbuda&quot;</span>,
                          <span class="st">`</span><span class="dt">Dominican Republic</span><span class="st">`</span> =<span class="st"> &quot;DR&quot;</span>,
                          <span class="st">`</span><span class="dt">St. Vincent and the Grenadines</span><span class="st">`</span> =<span class="st"> &quot;St. Vincent&quot;</span>,
                          <span class="st">`</span><span class="dt">Trinidad and Tobago</span><span class="st">`</span> =<span class="st"> &quot;Trinidad&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, life_expectancy, <span class="dt">color =</span> country)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="book_files/figure-html/caribbean-with-nicknames-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>There are other similar functions in other R packages, such as <code>recode_factor</code> and <code>fct_recoder</code> in the <strong>forcats</strong> package.</p>
</div>
<div id="exercises-31" class="section level2 unnumbered">
<h2>Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>Complete all lessons and exercises in the <a href="https://regexone.com/" class="uri">https://regexone.com/</a> online interactive tutorial.</p></li>
<li><p>In the <code>extdata</code> directory of the <strong>dslabs</strong> package, you will find a PDF file containing daily mortality data for Puerto Rico from Jan 1, 2015 to May 31, 2018. You can find the file like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fn &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;RD-Mortality-Report_2015-18-180531.pdf&quot;</span>,
                  <span class="dt">package=</span><span class="st">&quot;dslabs&quot;</span>)</code></pre></div>
<p>Find and open the file or open it directly from RStudio. On a Mac, you can type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system2</span>(<span class="st">&quot;open&quot;</span>, <span class="dt">args =</span> fn)</code></pre></div>
<p>and on Windows, you can type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system</span>(<span class="st">&quot;cmd.exe&quot;</span>, <span class="dt">input =</span> <span class="kw">paste</span>(<span class="st">&quot;start&quot;</span>, fn))</code></pre></div>
<p>Which of the following best describes this file:</p>
<p>A. It is a table. Extracting the data will be easy.</p>
<p>B. It is a report written in prose. Extracting the data will be impossible.</p>
<p>C. It is a report combining graphs and tables. Extracting the data seems possible.</p>
<p>D. It shows graphs of the data. Extracting the data will be difficult.</p></li>
<li><p>We are going to create a tidy dataset with each row representing one observation. The variables in this dataset will be year, month, day and deaths. Start by installing and loading the <strong>pdftools</strong> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;pdftools&quot;</span>)
<span class="kw">library</span>(pdftools)</code></pre></div>
<p>Now read-in <code>fn</code> using the <code>pdf_text</code> function, store the results in an object called <code>txt</code>. Describe what you see in <code>txt</code>.</p>
<p>A. A table with the mortality data.</p>
<p>B. A character string of length 12. Each entry represents the text in each page. The mortality data is in there somewhere.</p>
<p>C. A character string with one entry containing all the information in the PDF file.</p>
<p>D. An html document.</p></li>
<li><p>Extract the ninth page of the PDF file from the object <code>txt</code>, then use the <code>str_split</code> from the <strong>stringr</strong> package so that you have each line in a different entry. Call this string vector <code>s</code>. Then look at the result and choose the one that best describes what you see.</p>
<p>A. It is an empty string.</p>
<p>B. I can see the figure shown in page 1.</p>
<p>C. It is a tidy table.</p>
<p>D. I can see the table! But there is a bunch of other stuff we need to get rid of.</p></li>
<li><p>What kind of object is <code>s</code> and how many entries does it have?</p></li>
<li><p>We see that the output is a list with one component. Redefine <code>s</code> to be the first entry of the list. What kind of object is <code>s</code> and how many entries does it have?</p></li>
<li><p>When inspecting the string we obtained above, we see a common problem: white space before and after the other characters. Trimming is a common first step in string processing. These extra spaces will eventually make splitting the strings hard so we start by removing them. We learned about the command <code>str_trim</code> that removes spaces at the start or end of the strings. Use this function to trim <code>s</code>.</p></li>
<li><p>We want to extract the numbers from the strings stored in <code>s</code>. However, there a lot of non-numeric characters that will get in the way. We can remove these, but before doing this we want to preserve the string with the column header, which includes the month abbreviation. Use the <code>str_which</code> function to find the rows with a header. Save these results to <code>header_index</code>. Hint: find the first string that matches the pattern <code>2015</code> using the <code>str_which</code> function.</p></li>
<li><p>Now we are going to define two objects: <code>month</code> will store the month and <code>header</code> will store the column names. Identify which row contains the header of the table. Save the content of the row into an object called <code>header</code>, then use <code>str_split</code> to help define the two objects we need. Hints: the separator here is one or more spaces. Also, consider using the <code>simplify</code> argument.</p></li>
<li><p>Notice that towards the end of the page you see a <em>totals</em> row followed by rows with other summary statistics. Create an object called <code>tail_index</code> with the index of the <em>totals</em> entry.</p></li>
<li><p>Because our PDF page includes graphs with numbers, some of our rows have just one number (from the y-axis of the plot). Use the <code>str_count</code> function to create an object <code>n</code> with the number of numbers in each each row. Hint: you can write a regex for number like this <code>\\d+</code>.</p></li>
<li><p>We are now ready to remove entries from rows that we know we don’t need. The entry <code>header_index</code> and everything before it should be removed. Entries for which <code>n</code> is 1 should also be removed, and the entry <code>tail_index</code> and everything that comes after it should be removed as well.</p></li>
<li><p>Now we are ready to remove all the non-numeric entries. Do this using regex and the <code>str_remove_all</code> function. Hint: in regex, using the <code>^</code> inside the <code>[]</code> means <em>not</em>, like the <code>!</code> means not in <code>!=</code>. To define the regex pattern to catch all non-numbers, you can type <code>[^\\d]</code>. But remember you also want to keep spaces.</p></li>
<li><p>To convert the strings into a table, use the <code>str_split_fixed</code> function. Convert <code>s</code> into a data matrix with just the day and death count data. Hints: note that the separator is one or more spaces. Make the argument <code>n</code> a value that limits the number of columns to the values in the 4 columns and the last column captures all the extra stuff. Then keep only the first four columns.</p></li>
<li><p>Now you are almost ready to finish. Add column names to the matrix, including one called <code>day</code>. Also, add a column with the month. Call the resulting object <code>dat</code>. Finally, make sure the day is an integer not a character. Hint: use only the first five columns.</p></li>
<li><p>Now finish it up by tidying <code>tab</code> with the gather function.</p></li>
<li><p>Make a plot of deaths versus day with color to denote year. Exclude 2018 since we have no data.</p></li>
<li><p>Now that we have wrangled this data step-by-step, put it all together in one R chunk, using the pipe as much as possible. Hint: first define the indexes, then write one line of code that does all the string processing.</p></li>
<li><p>Advanced: let’s return to the MLB Payroll example from the web scraping section. Use what you have learned in the web scraping and string processing chapters to extract the payroll for the New York Yankees, Boston Red Sox, and Oakland A’s and plot them as a function of time.</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="web-scraping.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="parsing-dates-and-times.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rafalab/dsbook/edit/master/wrangling/string-processing.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
